import{f as X,d as ee,r as w,h as te,l as f,q as ne,o as le,k as s,j as e,a as g,x as U,t as o,G as V,e as oe,H as se,g as ie,n as G,m,I as H,J as Y,K as J,L as T,N as $,p as re,M as ue,w as de,C as pe,c as ce}from"./index-Dtb2zBzF.js";import{u as ve,S as me}from"./index-47z7JLpT.js";import{A as fe}from"./add-F9i1CyRS.js";import{R as _e}from"./refresh-DSvM5u6N.js";import{P as ge}from"./pen-xs__ooeO.js";import{D as be}from"./delete-vzeeX1Ce.js";import{p as S}from"./product.service-CbQSGVkx.js";import{c as ye}from"./category.service-CXrW7khJ.js";import{b as we}from"./brand.service-Bue5MGkv.js";import{S as xe,E as he}from"./exit-CN4dtBQM.js";import{a as L,b as Z,c as Q}from"./NumberFormat-Dorb8or7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},Ue={class:"text-xl font-semibold"},Se={class:"flex gap-2"},ze={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},W={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(F,{emit:d}){const K=X(),{t:r,locale:R}=ee(),x=F,I=d,q=w(null),z=w(!1),P=w(null),A=w([]),M=w([]),n=w({title_uz:"",title_ru:"",title_ko:"",title_en:"",category_id:null,brand_id:null,unit:"piece",price:0,discount:0,description_uz:"",description_ru:"",description_ko:"",description_en:"",is_active:!0,top:!1,product_images:[]}),B=()=>{ye.all().then(u=>{A.value=u})},h=()=>{we.getBrandsByCategory(n.value.category_id).then(u=>{M.value=u})},p=u=>({required:!0,trigger:"blur",validator:(a,k)=>{if(!k)return new Error(r(u))}}),b={title_uz:p("input require"),title_ko:p("input require"),title_ru:p("input require"),title_en:p("input require"),category_id:p("choose require"),brand_id:p("choose require")};te(async()=>{if(B(),x.type==="update"&&x.id)try{const u=await S.getOne(x.id);n.value=u,h()}catch(u){console.error("Ma'lumot yuklashda xatolik:",u)}setTimeout(()=>{var u;(u=P.value)==null||u.focus()},100)});const O=async()=>{var u;try{if(await((u=q.value)==null?void 0:u.validate()),z.value=!0,x.type==="create"){const a=await S.create(n.value);I("create",a)}else if(x.type==="update"){n.value.product_images||(n.value.product_images=[]);const a=await S.update(x.id,n.value);I("update",a)}}catch(a){console.warn("Form not valid or failed",a)}finally{z.value=!1}},C=()=>I("close"),j=u=>{u&&(n.value.brand_id=null,n.value.category_id=u,h())},c=u=>{u.code==="Enter"&&O()};return(u,a)=>{const k=f("n-icon"),N=f("n-button"),t=f("n-input"),l=f("n-form-item"),v=f("n-select"),y=f("n-input-number"),E=f("n-space"),D=f("n-switch"),_=f("n-spin"),ae=f("n-form");return le(),ne(ae,{ref_key:"formRef",ref:q,model:n.value,rules:b},{default:s(()=>[e(_,{show:z.value},{default:s(()=>[g("div",ke,[g("p",Ue,U(o(r)("product"))+" "+U(x.type=="create"?o(r)("add").toLowerCase():o(r)("change").toLowerCase()),1),g("div",Se,[e(N,{onClick:O,type:"success",disabled:z.value,class:"min-w-[120px]"},{icon:s(()=>[e(k,null,{default:s(()=>[e(o(xe))]),_:1})]),default:s(()=>[V(" "+U(o(r)("save"))+" ",1),a[15]||(a[15]=g("span",{class:"text-xs ml-1"},"Enter",-1))]),_:1,__:[15]},8,["disabled"]),e(N,{onClick:C,type:"warning",class:"min-w-[120px]"},{icon:s(()=>[e(k,null,{default:s(()=>[e(o(he))]),_:1})]),default:s(()=>[V(" "+U(o(r)("exit"))+" ",1),a[16]||(a[16]=g("span",{class:"text-xs ml-1"},"Esc",-1))]),_:1,__:[16]})])]),g("div",ze,[e(l,{label:o(r)("name")+" UZB",path:"title_uz"},{default:s(()=>[e(t,{ref_key:"inputInstRef",ref:P,onKeydown:c,value:n.value.title_uz,"onUpdate:value":a[0]||(a[0]=i=>n.value.title_uz=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(l,{label:o(r)("name")+" KOR",path:"title_ko"},{default:s(()=>[e(t,{onKeydown:c,value:n.value.title_ko,"onUpdate:value":a[1]||(a[1]=i=>n.value.title_ko=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(l,{label:o(r)("name")+" RUS",path:"title_ru"},{default:s(()=>[e(t,{onKeydown:c,value:n.value.title_ru,"onUpdate:value":a[2]||(a[2]=i=>n.value.title_ru=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(l,{label:o(r)("name")+" ENG",path:"title_en"},{default:s(()=>[e(t,{onKeydown:c,value:n.value.title_en,"onUpdate:value":a[3]||(a[3]=i=>n.value.title_en=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(l,{label:o(r)("category"),path:"category_id"},{default:s(()=>[e(v,{options:A.value,fitlerable:"",clearable:"",onKeydown:c,value:n.value.category_id,"onUpdate:value":[a[4]||(a[4]=i=>n.value.category_id=i),j],"label-field":"title_"+o(R),"value-field":"id"},null,8,["options","value","label-field"])]),_:1},8,["label"]),e(l,{label:o(r)("brand"),path:"brand_id"},{default:s(()=>[e(v,{options:M.value,fitlerable:"",clearable:"",onKeydown:c,value:n.value.brand_id,"onUpdate:value":a[5]||(a[5]=i=>n.value.brand_id=i),"label-field":"title_"+o(R),"value-field":"id"},null,8,["options","value","label-field"])]),_:1},8,["label"]),e(E,null,{default:s(()=>[e(l,{label:o(r)("price"),path:"price"},{default:s(()=>[e(y,{onKeydown:c,value:n.value.price,"onUpdate:value":a[6]||(a[6]=i=>n.value.price=i),parse:o(Z),format:o(L),step:1e3,clearable:""},null,8,["value","parse","format"])]),_:1},8,["label"]),e(l,{label:o(r)("unit"),path:"unit"},{default:s(()=>[e(v,{style:{width:"150px"},options:o(K).unitOption,fitlerable:"",onKeydown:c,value:n.value.unit,"onUpdate:value":a[7]||(a[7]=i=>n.value.unit=i),"label-field":"title_"+o(R),"value-field":"element"},null,8,["options","value","label-field"])]),_:1},8,["label"])]),_:1}),e(E,null,{default:s(()=>[e(l,{label:o(r)("active"),path:"is_active"},{default:s(()=>[e(D,{onKeydown:c,value:n.value.is_active,"onUpdate:value":a[8]||(a[8]=i=>n.value.is_active=i)},null,8,["value"])]),_:1},8,["label"]),e(l,{label:o(r)("top"),path:"top"},{default:s(()=>[e(D,{onKeydown:c,value:n.value.top,"onUpdate:value":a[9]||(a[9]=i=>n.value.top=i)},null,8,["value"])]),_:1},8,["label"])]),_:1}),e(l,{label:o(r)("discount"),path:"discount"},{default:s(()=>[e(y,{onKeydown:c,value:n.value.discount,"onUpdate:value":a[10]||(a[10]=i=>n.value.discount=i),parse:o(Z),format:o(L),step:1e3,clearable:""},null,8,["value","parse","format"])]),_:1},8,["label"]),e(l),e(l,{label:o(r)("comment")+" UZB",path:"description_uz"},{default:s(()=>[e(t,{type:"textarea",onKeydown:c,value:n.value.description_uz,"onUpdate:value":a[11]||(a[11]=i=>n.value.description_uz=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(l,{label:o(r)("comment")+" KOR",path:"description_ko"},{default:s(()=>[e(t,{type:"textarea",onKeydown:c,value:n.value.description_ko,"onUpdate:value":a[12]||(a[12]=i=>n.value.description_ko=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(l,{label:o(r)("comment")+" RUS",path:"description_ru"},{default:s(()=>[e(t,{type:"textarea",onKeydown:c,value:n.value.description_ru,"onUpdate:value":a[13]||(a[13]=i=>n.value.description_ru=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(l,{label:o(r)("comment")+" ENG",path:"description_en"},{default:s(()=>[e(t,{type:"textarea",onKeydown:c,value:n.value.description_en,"onUpdate:value":a[14]||(a[14]=i=>n.value.description_en=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])])]),_:1},8,["show"])]),_:1},8,["model"])}}},Ce={class:"p-2 space-y-2"},Ke={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Re={class:"text-xl font-bold"},Ie={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},je={__name:"Index",setup(F){const{t:d,locale:K}=ee(),{insert:r,shift:R,r:x}=ve(),I=re(),q=oe(),z=se(),P=X(),A=G("fileUrl"),M=G("dayJS"),n=w([]),B=w(!1),h=w({text:""}),p=w({create:!1,update:!1,update_id:null}),b=t=>{B.value=!0,S.all(h.value).then(l=>{n.value=l,B.value=!1,t&&(p.value[t]=!1)})},O=ie(()=>[{title:"â„–",key:"id",align:"center",width:50,render:(t,l)=>l+1},{title:d("datetime"),key:"datetime",width:150,render(t){return M(t.datetime).format("YYYY-MM-DD HH:mm:ss")}},{title:d("category"),key:"name",render(t){var l,v,y;return m("div",{class:"flex items-center"},[(l=t.category)!=null&&l.image?m(H,{src:A+((v=t.category)==null?void 0:v.image),height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):m(Y,{size:"small",style:{marginRight:"8px"}}),m("span",{class:"font-semibold"},(y=t.category)==null?void 0:y["title_"+K.value])])}},{title:d("brand"),key:"brand.title_"+K.value},{title:d("name"),key:"title_"+K.value},{title:d("price"),align:"right",titleAlign:"left",render(t){return m("span",{class:"font-semibold"},Q(t.price))}},{title:d("discount"),align:"right",titleAlign:"left",render(t){return m("span",{class:"font-semibold"},Q(t.discount))}},{title:d("active"),align:"center",titleAlign:"left",width:100,render(t){return m(J,{size:"small",value:t.is_active,onUpdateValue:l=>{let v={is_active:!t.is_active,top:t.top};S.updateTools(t.id,v).then(()=>b())}})}},{title:d("top"),align:"center",titleAlign:"left",width:100,render(t){return m(J,{size:"small",value:t.top,onUpdateValue:l=>{let v={is_active:t.is_active,top:!t.top};console.log(v),S.updateTools(t.id,v).then(()=>b())}})}},{title:d("admin_one"),key:"name",render(t){var l,v,y;return m("div",{class:"flex items-center"},[(l=t.user)!=null&&l.image?m(H,{src:A+((v=t.user)==null?void 0:v.image),height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):m(Y,{size:"small",style:{marginRight:"8px"}}),m("span",{class:"font-semibold"},(y=t.user)==null?void 0:y.fullname)])}},{title:d("action"),key:"action",align:"center",fixed:"right",width:120,render(t){return[m(T,{size:"small",type:"success",onClick:l=>{p.value.update_id=t.id,p.value.update=!0},style:{marginRight:"8px"}},{icon:()=>m($,{component:ge,size:22})}),m(T,{size:"small",type:"warning",onClick:()=>{q.warning({title:d("warning"),content:d("delete_row"),positiveText:d("yes"),negativeText:d("no"),onPositiveClick:()=>{S.delete(t.id).then(()=>b()).catch(l=>{P.errorPage=l.data,I.push({name:"error page"})})},onNegativeClick:()=>z.success(d("cancel"))})}},{icon:()=>m($,{component:be,size:22})})]}}]),C=ue({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:t=>C.page=t,onUpdatePageSize:t=>{C.pageSize=t,C.page=1}}),j=t=>({style:"cursor: pointer;"}),c=()=>b(),u=()=>{h.value.text="",b()},a=()=>p.value.create=!0,k=t=>p.value[t]=!1,N=t=>b(t);return de(r,t=>t&&a()),pe(()=>{R.value&&x.value&&b()}),te(()=>b()),(t,l)=>{const v=f("n-input"),y=f("n-data-table"),E=f("n-card"),D=f("n-modal");return le(),ce("div",Ce,[g("div",Ke,[g("h2",Re,U(o(d)("products")),1),g("div",Ie,[e(v,{value:h.value.text,"onUpdate:value":l[0]||(l[0]=_=>h.value.text=_),onInput:c,placeholder:o(d)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:s(()=>[e(o($),null,{default:s(()=>[e(o(me))]),_:1})]),_:1},8,["value","placeholder"]),e(o(T),{type:"warning",onClick:u},{icon:s(()=>[e(o($),null,{default:s(()=>[e(o(_e))]),_:1})]),default:s(()=>[V(" "+U(o(d)("update"))+" ",1),l[7]||(l[7]=g("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),e(o(T),{type:"success",onClick:a},{icon:s(()=>[e(o($),null,{default:s(()=>[e(o(fe))]),_:1})]),default:s(()=>[V(" "+U(o(d)("add"))+" ",1),l[8]||(l[8]=g("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),e(y,{"row-props":j,pagination:C,loading:B.value,columns:O.value,data:n.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e(D,{"transform-origin":"center",show:p.value.create,"onUpdate:show":l[3]||(l[3]=_=>p.value.create=_)},{default:s(()=>[e(E,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:s(()=>[e(W,{onClose:l[1]||(l[1]=_=>k("create")),onCreate:l[2]||(l[2]=_=>N("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e(D,{"transform-origin":"center",show:p.value.update,"onUpdate:show":l[6]||(l[6]=_=>p.value.update=_)},{default:s(()=>[e(E,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:s(()=>[e(W,{type:"update",id:p.value.update_id,onClose:l[4]||(l[4]=_=>k("update")),onUpdate:l[5]||(l[5]=_=>N("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{je as default};
