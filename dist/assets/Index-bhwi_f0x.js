import{h as X,d as ee,r as w,j as te,k as _,o as ae,n as ne,m as s,l as e,a as g,t as U,p as o,G as j,e as oe,g as se,H as ie,i as re,I as ue,w as de,C as ce,c as pe,N as D,J as q,v as G,x as v,K as H,L as Y,M as J}from"./index-lszqCMqc.js";import{u as ve}from"./index-ZHZK-JzO.js";import{A as me}from"./add-bUp1q7DN.js";import{R as _e}from"./refresh-l-BsjCMQ.js";import{P as fe}from"./pen-dpI6UkSU.js";import{S as ge}from"./search-Jp_syMCz.js";import{D as be}from"./delete-KjMN84f2.js";import{p as z}from"./product.service-5HBX8LW8.js";import{c as ye}from"./category.service-sb-OWhd3.js";import{b as we}from"./brand.service-wv995vsz.js";import{S as xe,E as he}from"./exit--pM2v71d.js";import{a as L,b as Z,c as Q}from"./NumberFormat-N2x_sffK.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const ke={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},Ue={class:"text-xl font-semibold"},ze={class:"flex gap-2"},Se=g("span",{class:"text-xs ml-1"},"Enter",-1),Ce=g("span",{class:"text-xs ml-1"},"Esc",-1),Ke={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},W={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(F,{emit:d}){const K=X(),{t:r,locale:R}=ee(),x=F,I=d,P=w(null),S=w(!1),M=w(null),N=w([]),O=w([]),l=w({title_uz:"",title_ru:"",title_ko:"",title_en:"",category_id:null,brand_id:null,unit:"piece",price:0,discount:0,description_uz:"",description_ru:"",description_ko:"",description_en:"",is_active:!0,top:!1,product_images:[]}),A=()=>{ye.all().then(u=>{N.value=u})},h=()=>{we.getBrandsByCategory(l.value.category_id).then(u=>{O.value=u})},m=u=>({required:!0,trigger:"blur",validator:(n,k)=>{if(!k)return new Error(r(u==="image"?"require_image":"require_name"))}}),b={title_uz:m("title_uz"),title_ko:m("title_ko"),title_ru:m("title_ru"),title_en:m("title_en"),category_id:{required:!0,trigger:"blur",validator:(u,n)=>{if(!n)return new Error(r("require_category"))}}};te(async()=>{if(A(),x.type==="update"&&x.id)try{const u=await z.getOne(x.id);l.value=u,h()}catch(u){console.error("Ma'lumot yuklashda xatolik:",u)}setTimeout(()=>{var u;(u=M.value)==null||u.focus()},100)});const T=async()=>{var u;try{if(await((u=P.value)==null?void 0:u.validate()),S.value=!0,x.type==="create"){const n=await z.create(l.value);I("create",n)}else if(x.type==="update"){l.value.product_images||(l.value.product_images=[]);const n=await z.update(x.id,l.value);I("update",n)}}catch(n){console.warn("Form not valid or failed",n)}finally{S.value=!1}},C=()=>I("close"),V=u=>{u&&(l.value.brand_id=null,l.value.category_id=u,h())},c=u=>{u.code==="Enter"&&T()};return(u,n)=>{const k=_("n-icon"),B=_("n-button"),t=_("n-input"),a=_("n-form-item"),p=_("n-select"),y=_("n-input-number"),E=_("n-space"),$=_("n-switch"),f=_("n-spin"),le=_("n-form");return ae(),ne(le,{ref_key:"formRef",ref:P,model:l.value,rules:b},{default:s(()=>[e(f,{show:S.value},{default:s(()=>[g("div",ke,[g("p",Ue,U(o(r)("product"))+" "+U(x.type=="create"?o(r)("add").toLowerCase():o(r)("change").toLowerCase()),1),g("div",ze,[e(B,{onClick:T,type:"success",disabled:S.value,class:"min-w-[120px]"},{icon:s(()=>[e(k,null,{default:s(()=>[e(o(xe))]),_:1})]),default:s(()=>[j(" "+U(o(r)("save"))+" ",1),Se]),_:1},8,["disabled"]),e(B,{onClick:C,type:"warning",class:"min-w-[120px]"},{icon:s(()=>[e(k,null,{default:s(()=>[e(o(he))]),_:1})]),default:s(()=>[j(" "+U(o(r)("exit"))+" ",1),Ce]),_:1})])]),g("div",Ke,[e(a,{label:o(r)("name")+" UZB",path:"title_uz"},{default:s(()=>[e(t,{ref_key:"inputInstRef",ref:M,onKeydown:c,value:l.value.title_uz,"onUpdate:value":n[0]||(n[0]=i=>l.value.title_uz=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(a,{label:o(r)("name")+" KOR",path:"title_ko"},{default:s(()=>[e(t,{onKeydown:c,value:l.value.title_ko,"onUpdate:value":n[1]||(n[1]=i=>l.value.title_ko=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(a,{label:o(r)("name")+" RUS",path:"title_ru"},{default:s(()=>[e(t,{onKeydown:c,value:l.value.title_ru,"onUpdate:value":n[2]||(n[2]=i=>l.value.title_ru=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(a,{label:o(r)("name")+" ENG",path:"title_en"},{default:s(()=>[e(t,{onKeydown:c,value:l.value.title_en,"onUpdate:value":n[3]||(n[3]=i=>l.value.title_en=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(a,{label:o(r)("category"),path:"category_id"},{default:s(()=>[e(p,{options:N.value,fitlerable:"",clearable:"",onKeydown:c,value:l.value.category_id,"onUpdate:value":[n[4]||(n[4]=i=>l.value.category_id=i),V],"label-field":"title_"+o(R),"value-field":"id"},null,8,["options","value","label-field"])]),_:1},8,["label"]),e(a,{label:o(r)("brand"),path:"brand_id"},{default:s(()=>[e(p,{options:O.value,fitlerable:"",clearable:"",onKeydown:c,value:l.value.brand_id,"onUpdate:value":n[5]||(n[5]=i=>l.value.brand_id=i),"label-field":"title_"+o(R),"value-field":"id"},null,8,["options","value","label-field"])]),_:1},8,["label"]),e(E,null,{default:s(()=>[e(a,{label:o(r)("price"),path:"price"},{default:s(()=>[e(y,{onKeydown:c,value:l.value.price,"onUpdate:value":n[6]||(n[6]=i=>l.value.price=i),parse:o(L),format:o(Z),step:1e3,clearable:""},null,8,["value","parse","format"])]),_:1},8,["label"]),e(a,{label:o(r)("unit"),path:"unit"},{default:s(()=>[e(p,{style:{width:"150px"},options:o(K).unitOption,fitlerable:"",clearable:"",onKeydown:c,value:l.value.unit,"onUpdate:value":[n[7]||(n[7]=i=>l.value.unit=i),V],"label-field":"title_"+o(R),"value-field":"element"},null,8,["options","value","label-field"])]),_:1},8,["label"])]),_:1}),e(E,null,{default:s(()=>[e(a,{label:o(r)("active"),path:"is_active"},{default:s(()=>[e($,{onKeydown:c,value:l.value.is_active,"onUpdate:value":n[8]||(n[8]=i=>l.value.is_active=i)},null,8,["value"])]),_:1},8,["label"]),e(a,{label:o(r)("top"),path:"top"},{default:s(()=>[e($,{onKeydown:c,value:l.value.top,"onUpdate:value":n[9]||(n[9]=i=>l.value.top=i)},null,8,["value"])]),_:1},8,["label"])]),_:1}),e(a,{label:o(r)("discount"),path:"discount"},{default:s(()=>[e(y,{onKeydown:c,value:l.value.discount,"onUpdate:value":n[10]||(n[10]=i=>l.value.discount=i),parse:o(L),format:o(Z),step:1e3,clearable:""},null,8,["value","parse","format"])]),_:1},8,["label"]),e(a),e(a,{label:o(r)("comment")+" UZB",path:"description_uz"},{default:s(()=>[e(t,{type:"textarea",onKeydown:c,value:l.value.description_uz,"onUpdate:value":n[11]||(n[11]=i=>l.value.description_uz=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(a,{label:o(r)("comment")+" KOR",path:"description_ko"},{default:s(()=>[e(t,{type:"textarea",onKeydown:c,value:l.value.description_ko,"onUpdate:value":n[12]||(n[12]=i=>l.value.description_ko=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(a,{label:o(r)("comment")+" RUS",path:"description_ru"},{default:s(()=>[e(t,{type:"textarea",onKeydown:c,value:l.value.description_ru,"onUpdate:value":n[13]||(n[13]=i=>l.value.description_ru=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(a,{label:o(r)("comment")+" ENG",path:"description_en"},{default:s(()=>[e(t,{type:"textarea",onKeydown:c,value:l.value.description_en,"onUpdate:value":n[14]||(n[14]=i=>l.value.description_en=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])])]),_:1},8,["show"])]),_:1},8,["model"])}}},Re={class:"p-2 space-y-2"},Ie={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ne={class:"text-xl font-bold"},Ae={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Be=g("span",{class:"ml-1 text-xs"},"Shift+R",-1),Ee=g("span",{class:"ml-1 text-xs"},"Insert",-1),Je={__name:"Index",setup(F){const{t:d,locale:K}=ee(),{insert:r,shift:R,r:x}=ve(),I=oe(),P=se(),S=ie(),M=X(),N=G("fileUrl"),O=G("dayJS"),l=w([]),A=w(!1),h=w({text:""}),m=w({create:!1,update:!1,update_id:null}),b=t=>{A.value=!0,z.all(h.value).then(a=>{l.value=a,A.value=!1,t&&(m.value[t]=!1)})},T=re(()=>[{title:"â„–",key:"id",align:"center",width:50,render:(t,a)=>a+1},{title:d("datetime"),key:"datetime",width:150,render(t){return O(t.datetime).format("YYYY-MM-DD HH:mm:ss")}},{title:d("category"),key:"name",render(t){var a,p,y;return v("div",{class:"flex items-center"},[(a=t.category)!=null&&a.image?v(H,{src:N+((p=t.category)==null?void 0:p.image),height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):v(Y,{size:"small",style:{marginRight:"8px"}}),v("span",{class:"font-semibold"},(y=t.category)==null?void 0:y["title_"+K.value])])}},{title:d("brand"),key:"brand.title_"+K.value},{title:d("name"),key:"title_"+K.value},{title:d("price"),align:"right",titleAlign:"left",render(t){return v("span",{class:"font-semibold"},Q(t.price))}},{title:d("discount"),align:"right",titleAlign:"left",render(t){return v("span",{class:"font-semibold"},Q(t.discount))}},{title:d("active"),align:"center",titleAlign:"left",width:100,render(t){return v(J,{size:"small",value:t.is_active,onUpdateValue:a=>{let p={is_active:!t.is_active,top:t.top};z.updateTools(t.id,p).then(()=>b())}})}},{title:d("top"),align:"center",titleAlign:"left",width:100,render(t){return v(J,{size:"small",value:t.top,onUpdateValue:a=>{let p={is_active:t.is_active,top:!t.top};console.log(p),z.updateTools(t.id,p).then(()=>b())}})}},{title:d("admin_one"),key:"name",render(t){var a,p,y;return v("div",{class:"flex items-center"},[(a=t.user)!=null&&a.image?v(H,{src:N+((p=t.user)==null?void 0:p.image),height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):v(Y,{size:"small",style:{marginRight:"8px"}}),v("span",{class:"font-semibold"},(y=t.user)==null?void 0:y.fullname)])}},{title:d("action"),key:"action",align:"center",width:120,render(t){return[v(q,{size:"small",type:"success",onClick:a=>{m.value.update_id=t.id,m.value.update=!0},style:{marginRight:"8px"}},{icon:()=>v(D,{component:fe,size:22})}),v(q,{size:"small",type:"warning",onClick:()=>{P.warning({title:d("warning"),content:d("delete_row"),positiveText:d("yes"),negativeText:d("no"),onPositiveClick:()=>{z.delete(t.id).then(()=>b()).catch(a=>{M.errorPage=a.data,I.push({name:"error page"})})},onNegativeClick:()=>S.success(d("cancel"))})}},{icon:()=>v(D,{component:be,size:22})})]}}]),C=ue({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:t=>C.page=t,onUpdatePageSize:t=>{C.pageSize=t,C.page=1}}),V=t=>({style:"cursor: pointer;"}),c=()=>b(),u=()=>{h.value.text="",b()},n=()=>m.value.create=!0,k=t=>m.value[t]=!1,B=t=>b(t);return de(r,t=>t&&n()),ce(()=>{R.value&&x.value&&b()}),te(()=>b()),(t,a)=>{const p=_("n-input"),y=_("n-data-table"),E=_("n-card"),$=_("n-modal");return ae(),pe("div",Re,[g("div",Ie,[g("h2",Ne,U(o(d)("products")),1),g("div",Ae,[e(p,{value:h.value.text,"onUpdate:value":a[0]||(a[0]=f=>h.value.text=f),onInput:c,placeholder:o(d)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:s(()=>[e(o(D),null,{default:s(()=>[e(o(ge))]),_:1})]),_:1},8,["value","placeholder"]),e(o(q),{type:"warning",onClick:u},{icon:s(()=>[e(o(D),null,{default:s(()=>[e(o(_e))]),_:1})]),default:s(()=>[j(" "+U(o(d)("update"))+" ",1),Be]),_:1}),e(o(q),{type:"success",onClick:n},{icon:s(()=>[e(o(D),null,{default:s(()=>[e(o(me))]),_:1})]),default:s(()=>[j(" "+U(o(d)("add"))+" ",1),Ee]),_:1})])]),e(y,{"row-props":V,pagination:C,loading:A.value,columns:T.value,data:l.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e($,{"transform-origin":"center",show:m.value.create,"onUpdate:show":a[3]||(a[3]=f=>m.value.create=f)},{default:s(()=>[e(E,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:s(()=>[e(W,{onClose:a[1]||(a[1]=f=>k("create")),onCreate:a[2]||(a[2]=f=>B("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e($,{"transform-origin":"center",show:m.value.update,"onUpdate:show":a[6]||(a[6]=f=>m.value.update=f)},{default:s(()=>[e(E,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:s(()=>[e(W,{type:"update",id:m.value.update_id,onClose:a[4]||(a[4]=f=>k("update")),onUpdate:a[5]||(a[5]=f=>B("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Je as default};
