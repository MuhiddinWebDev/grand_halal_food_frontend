import{x as $,u as J,s as Y,r as k,i as Q,j as d,o as L,m as q,l as a,k as e,a as p,t as h,n as o,G as I,p as ee,d as te,f as ae,H as le,g as ne,h as oe,I as se,w as ie,C as re,c as ue,N as E,J as A,v as y,K as ce,L as de}from"./index-T3OpxodD.js";import{u as pe,S as me}from"./index-kVvJLiRa.js";import{S as _e,E as fe,A as ge,P as ve,D as he}from"./delete-4TfHpRPI.js";import{R as we}from"./refresh-rsWKEIMH.js";import{u as H}from"./upload.service-Q1vQpSqD.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const B="/offers";class xe{all(t){let i=t!=null&&t.text?"?text="+t.text:"";return $.get(B+"/all"+i).then(S=>S)}create(t){return $.post(B+"/create",t).then(i=>i)}update(t,i){return $.patch(B+`/update/${t}`,i).then(S=>S)}getOne(t){return $.get(B+`/getById/${t}`).then(i=>i)}delete(t){return $.delete(B+`/delete/${t}`).then(i=>i)}}const D=new xe,ye={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},ke={class:"text-xl font-semibold"},be={class:"flex gap-2"},Se=p("span",{class:"text-xs ml-1"},"Enter",-1),Ue=p("span",{class:"text-xs ml-1"},"Esc",-1),ze={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2"},Ce={class:"md:col-span-2"},Ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},Z={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(M,{emit:t}){const{t:i,locale:S}=J(),O=Y("fileUrl"),f=M,R=t,K=k(null),U=k(!1),P=k(null),r=k({title_uz:"",title_ru:"",title_ko:"",title_en:"",link:"",image:""}),g=s=>({required:!0,trigger:"blur",validator:(l,_)=>{if(!_)return new Error(i(s==="image"?"require_image":"require_name"))}}),z={title_uz:g("title_uz"),title_ko:g("title_ko"),title_ru:g("title_ru"),title_en:g("title_en"),image:g("image")};Q(async()=>{if(f.type==="update"&&f.id)try{const s=await D.getOne(f.id);r.value=s}catch(s){console.error("Ma'lumot yuklashda xatolik:",s)}setTimeout(()=>{var s;(s=P.value)==null||s.focus()},100)});const m=async()=>{var s;try{if(await((s=K.value)==null?void 0:s.validate()),U.value=!0,f.type==="create"){const l=await D.create(r.value);R("create",l)}else if(f.type==="update"){const l=await D.update(f.id,r.value);R("update",l)}}catch(l){console.warn("Form not valid or failed",l)}finally{U.value=!1}},w=()=>R("close"),F=async s=>{if(s)try{await H.delFile(s)}catch(l){console.warn("Faylni o‘chirishda xatolik:",l)}},C=async s=>{if(s.length>0){const l=new FormData;l.append("file",s[0].file);try{const _=await H.uploadFile(l);await F(r.value.image),r.value.image=_.file}catch(_){console.error("Yuklashda xatolik:",_)}}},T=()=>{F(r.value.image),r.value.image=""},b=s=>{s.code==="Enter"&&m()};return(s,l)=>{const _=d("n-icon"),N=d("n-button"),n=d("n-text"),u=d("n-p"),V=d("n-upload-dragger"),G=d("n-upload"),j=d("n-image"),x=d("n-input"),c=d("n-form-item"),W=d("n-spin"),X=d("n-form");return L(),q(X,{ref_key:"formRef",ref:K,model:r.value,rules:z},{default:a(()=>[e(W,{show:U.value},{default:a(()=>[p("div",ye,[p("p",ke,h(o(i)("offer"))+" "+h(f.type=="create"?o(i)("add").toLowerCase():o(i)("change").toLowerCase()),1),p("div",be,[e(N,{onClick:m,type:"success",disabled:U.value,class:"min-w-[120px]"},{icon:a(()=>[e(_,null,{default:a(()=>[e(o(_e))]),_:1})]),default:a(()=>[I(" "+h(o(i)("save"))+" ",1),Se]),_:1},8,["disabled"]),e(N,{onClick:w,type:"warning",class:"min-w-[120px]"},{icon:a(()=>[e(_,null,{default:a(()=>[e(o(fe))]),_:1})]),default:a(()=>[I(" "+h(o(i)("exit"))+" ",1),Ue]),_:1})])]),p("div",ze,[p("div",Ce,[e(G,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":C,onRemove:T},{default:a(()=>[e(V,{accept:"image/png, image/jpeg"},{default:a(()=>[e(n,{class:"text-base"},{default:a(()=>[I(h(s.$t("upload_image")),1)]),_:1}),e(u,{depth:"3",class:"mt-2"},{default:a(()=>[I(h(s.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})]),p("div",null,[r.value.image?(L(),q(j,{key:0,src:o(O)+r.value.image,width:"120",height:"80",class:"rounded"},null,8,["src"])):ee("",!0)])]),p("div",Ie,[e(c,{label:o(i)("title")+" UZB",path:"title_uz"},{default:a(()=>[e(x,{ref_key:"inputInstRef",ref:P,onKeydown:b,value:r.value.title_uz,"onUpdate:value":l[0]||(l[0]=v=>r.value.title_uz=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(c,{label:o(i)("title")+" KOR",path:"title_ko"},{default:a(()=>[e(x,{onKeydown:b,value:r.value.title_ko,"onUpdate:value":l[1]||(l[1]=v=>r.value.title_ko=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(c,{label:o(i)("title")+" RUS",path:"title_ru"},{default:a(()=>[e(x,{onKeydown:b,value:r.value.title_ru,"onUpdate:value":l[2]||(l[2]=v=>r.value.title_ru=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(c,{label:o(i)("title")+" ENG",path:"title_en"},{default:a(()=>[e(x,{onKeydown:b,value:r.value.title_en,"onUpdate:value":l[3]||(l[3]=v=>r.value.title_en=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])]),e(c,{label:o(i)("link"),path:"link"},{default:a(()=>[e(x,{onKeydown:b,value:r.value.link,"onUpdate:value":l[4]||(l[4]=v=>r.value.link=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["show"])]),_:1},8,["model"])}}},Re={class:"p-4 space-y-4"},Ne={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},$e={class:"text-xl font-bold"},Ee={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Be=p("span",{class:"ml-1 text-xs"},"Shift+R",-1),De=p("span",{class:"ml-1 text-xs"},"Insert",-1),Oe={__name:"Index",setup(M){const{t}=J(),{insert:i,shift:S,r:O}=pe(),f=te(),R=ae(),K=le(),U=ne(),P=Y("fileUrl"),r=k([]),g=k(!1),z=k({text:""}),m=k({create:!1,update:!1,update_id:null}),w=n=>{g.value=!0,D.all(z.value).then(u=>{r.value=u,g.value=!1,n&&(m.value[n]=!1)})},F=oe(()=>[{title:"№",key:"id",align:"center",width:50,render:(n,u)=>u+1},{title:t("title")+" UZB",key:"title_uz",render(n){return console.log(n.category),y("div",{class:"flex items-center"},[n.image?y(ce,{src:P+n.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):y(de,{size:"small",style:{marginRight:"8px"}}),y("span",{class:"font-semibold"},n.title_uz)])}},{title:t("title")+" KOR",key:"title_ko"},{title:t("title")+" RUS",key:"title_ru"},{title:t("title")+" ENG",key:"title_en"},{title:t("link"),key:"link"},{title:t("action"),key:"action",align:"center",width:120,render(n){return[y(A,{size:"small",type:"success",onClick:u=>{m.value.update_id=n.id,m.value.update=!0},style:{marginRight:"8px"}},{icon:()=>y(E,{component:ve,size:22})}),y(A,{size:"small",type:"warning",onClick:()=>{R.warning({title:t("warning"),content:t("delete_row"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{D.delete(n.id).then(()=>w()).catch(u=>{U.errorPage=u.data,f.push({name:"error page"})})},onNegativeClick:()=>K.success(t("cancel"))})}},{icon:()=>y(E,{component:he,size:22})})]}}]),C=se({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:n=>C.page=n,onUpdatePageSize:n=>{C.pageSize=n,C.page=1}}),T=n=>({style:"cursor: pointer;"}),b=()=>w(),s=()=>{z.value.text="",w()},l=()=>m.value.create=!0,_=n=>m.value[n]=!1,N=n=>w(n);return ie(i,n=>n&&l()),re(()=>{S.value&&O.value&&w()}),Q(()=>w()),(n,u)=>{const V=d("n-input"),G=d("n-data-table"),j=d("n-card"),x=d("n-modal");return L(),ue("div",Re,[p("div",Ne,[p("h2",$e,h(o(t)("offers")),1),p("div",Ee,[e(V,{value:z.value.text,"onUpdate:value":u[0]||(u[0]=c=>z.value.text=c),onInput:b,placeholder:o(t)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:a(()=>[e(o(E),null,{default:a(()=>[e(o(me))]),_:1})]),_:1},8,["value","placeholder"]),e(o(A),{type:"warning",onClick:s},{icon:a(()=>[e(o(E),null,{default:a(()=>[e(o(we))]),_:1})]),default:a(()=>[I(" "+h(o(t)("update"))+" ",1),Be]),_:1}),e(o(A),{type:"success",onClick:l},{icon:a(()=>[e(o(E),null,{default:a(()=>[e(o(ge))]),_:1})]),default:a(()=>[I(" "+h(o(t)("add"))+" ",1),De]),_:1})])]),e(G,{"row-props":T,pagination:C,loading:g.value,columns:F.value,data:r.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e(x,{"transform-origin":"center",show:m.value.create,"onUpdate:show":u[3]||(u[3]=c=>m.value.create=c)},{default:a(()=>[e(j,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:a(()=>[e(Z,{onClose:u[1]||(u[1]=c=>_("create")),onCreate:u[2]||(u[2]=c=>N("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e(x,{"transform-origin":"center",show:m.value.update,"onUpdate:show":u[6]||(u[6]=c=>m.value.update=c)},{default:a(()=>[e(j,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:a(()=>[e(Z,{type:"update",id:m.value.update_id,onClose:u[4]||(u[4]=c=>_("update")),onUpdate:u[5]||(u[5]=c=>N("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Oe as default};
