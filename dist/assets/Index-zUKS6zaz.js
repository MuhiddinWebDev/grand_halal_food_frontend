import{u as pe}from"./index-DTDr-_NB.js";import{A as te}from"./add-c61_CCwb.js";import{R as me}from"./refresh-CHlhbopm.js";import{S as _e}from"./search-DnXDH0b6.js";import{D as ae}from"./delete-PqNj2_rx.js";import{O as b,b as ne,H as le,r as v,g as oe,w as se,k as p,p as ge,o as M,j as s,i as e,a as i,v as _,s as l,G as U,c as K,R as fe,S as ve,d as he,f as X,m as ye,l as J,L as G,N as R,M as Z,B as xe}from"./index-Bw_DMt4G.js";import{p as re}from"./product.service-Dk06RwUl.js";import{S as be}from"./save-DP0lGshP.js";import{E as we}from"./exit-fcB5Trvy.js";import{a as ee}from"./NumberFormat-BDrUmd0_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const w="/stock-entries";class ke{all(n){return b.post(w+"/all",n).then(r=>r)}productResidual(n){return b.post(w+"/product-residual",n).then(r=>r)}create(n){return b.post(w+"/create",n).then(r=>r)}update(n,r){return b.patch(w+`/update/${n}`,r).then(z=>z)}getOne(n){return b.get(w+`/getById/${n}`).then(r=>r)}getBrandsByCategory(n){return b.get(w+`/getBrandsByCat/${n}`).then(r=>r)}delete(n){return b.delete(w+`/delete/${n}`).then(r=>r)}}const N=new ke,Se={class:"flex justify-between items-center mb-4"},ze={class:"text-xl font-semibold"},Ce={class:"flex gap-2"},qe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Pe={__name:"Form",emits:["create","close"],setup(Q,{emit:n}){const{t:r,locale:z}=ne(),B=n,C=le(),E=v(null),x=v(!1),q=v([]),c=v({comment:"",datetime:new Date().getTime(),entries:[{product_id:null,price:0,quantity:1,total:0}]});oe(async()=>{try{const u=await re.all();q.value=u}catch(u){console.error("Product load error:",u)}});const $=()=>c.value.entries.push({product_id:null,price:0,quantity:1,total:0}),j=u=>c.value.entries.splice(u,1),S=u=>{const d=c.value.entries[u];d.total=(d.price||0)*(d.quantity||0)},A=(u,d)=>{const f=q.value.find(o=>o.id===u);if(f){const o=c.value.entries[d];o.price=f.price,o.total=f.price*(o.quantity||0)}},y=async()=>{try{if(x.value=!0,console.log(c.value.entries),c.value.entries.some(d=>!d.product_id)){C.warning("Mahsulot tanlanmagan");return}const u=c.value.entries.map(d=>({product_id:d.product_id,quantity:d.quantity,type:"in",note:c.value.comment}));for(const d of u)await N.create(d);C.success("Saqlash muvaffaqiyatli"),B("create",u)}catch(u){console.error("Saqlashda xatolik",u),C.error("Saqlashda xatolik")}finally{x.value=!1}},m=()=>B("close");return se(()=>c.value.entries,()=>{c.value.entries.forEach(u=>{u.total=u.price*u.quantity})}),(u,d)=>{const f=p("n-icon"),o=p("n-button"),T=p("n-date-picker"),P=p("n-form-item"),I=p("n-input"),O=p("n-select"),F=p("n-input-number"),D=p("n-table"),H=p("n-spin"),L=p("n-form");return M(),ge(L,{ref_key:"formRef",ref:E,model:c.value},{default:s(()=>[e(H,{show:x.value},{default:s(()=>[i("div",Se,[i("p",ze,_(l(r)("sklad")),1),i("div",Ce,[e(o,{onClick:y,type:"success",disabled:x.value},{icon:s(()=>[e(f,null,{default:s(()=>[e(l(be))]),_:1})]),default:s(()=>[U(" "+_(l(r)("save")),1)]),_:1},8,["disabled"]),e(o,{onClick:m,type:"warning"},{icon:s(()=>[e(f,null,{default:s(()=>[e(l(we))]),_:1})]),default:s(()=>[U(" "+_(l(r)("exit")),1)]),_:1})])]),i("div",qe,[e(P,{label:l(r)("datetime")},{default:s(()=>[e(T,{value:c.value.datetime,disabled:!0},null,8,["value"])]),_:1},8,["label"]),e(P,{label:l(r)("comment")},{default:s(()=>[e(I,{value:c.value.comment,"onUpdate:value":d[0]||(d[0]=h=>c.value.comment=h),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(P,null,{default:s(()=>[e(o,{type:"success",onClick:$},{icon:s(()=>[e(f,null,{default:s(()=>[e(l(te))]),_:1})]),default:s(()=>[U(" "+_(l(r)("product")+" "+l(r)("add").toLocaleLowerCase()),1)]),_:1})]),_:1})]),e(D,{bordered:!0,size:"small"},{default:s(()=>[i("thead",null,[i("tr",null,[d[1]||(d[1]=i("th",null,"#",-1)),i("th",null,_(l(r)("product")),1),i("th",null,_(l(r)("price")),1),i("th",null,_(l(r)("quantity")),1),i("th",null,_(l(r)("total")),1),i("th",null,_(l(r)("action")),1)])]),i("tbody",null,[(M(!0),K(fe,null,ve(c.value.entries,(h,t)=>(M(),K("tr",{key:t},[i("td",null,_(t+1),1),i("td",null,[e(O,{style:{width:"200px"},options:q.value,"label-field":"title_"+l(z),"value-field":"id",value:h.product_id,"onUpdate:value":[a=>h.product_id=a,a=>A(a,t)]},null,8,["options","label-field","value","onUpdate:value"])]),i("td",null,_(l(ee)(h.price)),1),i("td",null,[e(F,{value:h.quantity,"onUpdate:value":[a=>h.quantity=a,a=>S(t)],min:1},null,8,["value","onUpdate:value"])]),i("td",null,_(l(ee)(h.total)),1),i("td",null,[e(o,{size:"small",type:"error",onClick:a=>j(t)},{icon:s(()=>[e(f,null,{default:s(()=>[e(l(ae))]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1},8,["show"])]),_:1},8,["model"])}}},Ie={class:"p-2 space-y-2 bg-white rounded-xl shadow-md overflow-x-auto"},Ue={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Be={class:"text-xl font-bold"},$e={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Ae={class:"flex justify-end"},De={class:"flex justify-end"},Ve={__name:"Index",setup(Q){const{t:n,locale:r}=ne(),{insert:z,shift:B,r:C}=pe(),E=he(),x=le(),q=ye("dayJS"),c=v([]),k=v(!1),$=v([]),j=v([]),S=v({type:"in",text:""}),A=v({product_id:null}),y=v({create:!1,update:!1,update_id:null}),m=()=>{k.value=!0;const t={...S.value,page:o.page,pageSize:o.pageSize};N.all(t).then(a=>{c.value=a.data,o.itemCount=a.total,k.value=!1,y.value.create=!1,y.value.update=!1})},u=()=>{N.productResidual(A.value).then(t=>{$.value=t})},d=()=>{re.all().then(t=>{j.value=t})},f=X(()=>[{title:"№",key:"id",align:"center",width:50,render:(t,a)=>a+1},{title:n("datetime"),key:"createdAt",width:150,render(t){return q(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:n("product"),key:"product_id",render(t){var a;return((a=t.product)==null?void 0:a.title_uz)||"-"}},{title:n("quantity"),key:"quantity",align:"center"},{title:n("comment"),key:"note"},{title:n("action"),key:"action",align:"center",fixed:"right",width:120,render(t){return[J(G,{size:"small",type:"warning",onClick:()=>{E.warning({title:n("warning"),content:n("delete_row"),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:()=>{N.delete(t.id).then(()=>m()).catch(()=>x.error(n("error")))},onNegativeClick:()=>x.success(n("cancel"))})}},{icon:()=>J(R,{component:ae})})]}}]),o=Z({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:t=>{o.page=t,m()},onUpdatePageSize:t=>{o.pageSize=t,o.page=1,m()}}),T=Z({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:t=>o.page=t,onUpdatePageSize:t=>{o.pageSize=t,o.page=1}}),P=X(()=>[{title:"№",key:"id",align:"center",width:50,render:(t,a)=>a+1},{title:n("product"),key:"product_id",render(t){return t.product["title_"+r.value]||"-"}},{title:n("limit"),align:"right",titleAlign:"left",width:200,render(t){const a=t.limit<=0?"text-red-500":"text-green-500";return J("span",{class:`font-semibold ${a}`},""+t.limit)}}]),I=()=>({style:"cursor: pointer;"}),O=()=>m(),F=()=>m(),D=()=>y.value.create=!0,H=t=>y.value[t]=!1,L=t=>m();se(z,t=>t&&D()),xe(()=>{B.value&&C.value&&m()}),oe(()=>{m(),u(),d()});const h=t=>{if(t=="limit"){A.value.product_id=null;return}S.value.type=t,m()};return(t,a)=>{const ie=p("n-input"),Y=p("n-data-table"),W=p("n-pagination"),V=p("n-tab-pane"),ue=p("n-tabs"),ce=p("n-card"),de=p("n-modal");return M(),K("div",Ie,[i("div",Ue,[i("h2",Be,_(l(n)("sklad")),1),i("div",$e,[e(ie,{value:S.value.text,"onUpdate:value":a[0]||(a[0]=g=>S.value.text=g),onInput:O,placeholder:l(n)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:s(()=>[e(l(R),null,{default:s(()=>[e(l(_e))]),_:1})]),_:1},8,["value","placeholder"]),e(l(G),{type:"warning",onClick:F},{icon:s(()=>[e(l(R),null,{default:s(()=>[e(l(me))]),_:1})]),default:s(()=>[U(" "+_(l(n)("update"))+" ",1),a[8]||(a[8]=i("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[8]}),e(l(G),{type:"success",onClick:D},{icon:s(()=>[e(l(R),null,{default:s(()=>[e(l(te))]),_:1})]),default:s(()=>[U(" "+_(l(n)("add"))+" ",1),a[9]||(a[9]=i("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[9]})])]),e(ue,{type:"line",animated:"","default-value":"in","onUpdate:value":h},{default:s(()=>[e(V,{name:"in",tab:l(n)("kirim")},{default:s(()=>[e(Y,{"row-props":I,loading:k.value,columns:f.value,data:c.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1100,"max-height":"calc(100vh - 315px)"},null,8,["loading","columns","data"]),i("div",Ae,[e(W,{page:o.page,"onUpdate:page":[a[1]||(a[1]=g=>o.page=g),m],"page-size":o.pageSize,"item-count":o.itemCount,"page-sizes":[10,15,20],"onUpdate:pageSize":a[2]||(a[2]=g=>{o.pageSize=g,o.page=1,m()})},null,8,["page","page-size","item-count"])])]),_:1},8,["tab"]),e(V,{name:"out",tab:l(n)("rasxod")},{default:s(()=>[e(Y,{"row-props":I,loading:k.value,columns:f.value,data:c.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1100,"max-height":"calc(100vh - 315px)"},null,8,["loading","columns","data"]),i("div",De,[e(W,{page:o.page,"onUpdate:page":[a[3]||(a[3]=g=>o.page=g),m],"page-size":o.pageSize,"item-count":o.itemCount,"page-sizes":[10,15,20],"onUpdate:pageSize":a[4]||(a[4]=g=>{o.pageSize=g,o.page=1,m()})},null,8,["page","page-size","item-count"])])]),_:1},8,["tab"]),e(V,{name:"limit",tab:l(n)("limit")},{default:s(()=>[e(Y,{"row-props":I,pagination:T,loading:k.value,columns:P.value,data:$.value,bordered:!0,"single-line":!1,size:"small","scroll-x":700,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"])]),_:1},8,["tab"])]),_:1}),e(de,{"transform-origin":"center",show:y.value.create,"onUpdate:show":a[7]||(a[7]=g=>y.value.create=g)},{default:s(()=>[e(ce,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:s(()=>[e(Pe,{onClose:a[5]||(a[5]=g=>H("create")),onCreate:a[6]||(a[6]=g=>L("create")),type:"create"})]),_:1})]),_:1},8,["show"])])}}};export{Ve as default};
