import{R as K}from"./refresh-DY6Q7-u-.js";import{D as W}from"./delete-DA5j-UsH.js";import{O as v,d as Z,f as tt,H as et,r as b,n as q,h as lt,w as at,c as _,a as t,j as u,s as nt,l as y,t as e,U as z,k as i,L as V,x as a,p as st,o as d,G as h,N as H,Q as N,R as O,q as L,V as ot}from"./index-DpTnkf6l.js";import{c as ut}from"./clients.service-DDcHmkts.js";import{c as S}from"./NumberFormat-Dorb8or7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const x="/order";class rt{all(l){return v.post(x+"/all",l).then(s=>s)}create(l){return v.post(x+"/",l).then(s=>s)}update(l,s){return v.patch(x+`/update${l}`,s).then(c=>c)}updateStatus(l,s){return v.patch(x+`/updateStatus/${l}`,s).then(c=>c)}getOne(l){return v.get(x+`/${l}`).then(s=>s)}delete(l){return v.delete(x+`/${l}`).then(s=>s)}}const U=new rt,it={class:"space-y-2 p-2"},dt={class:"flex justify-between flex-wrap items-center gap-2"},ct={class:"flex gap-2 items-center flex-wrap"},pt={class:"grid gap-2 grid-cols-[repeat(auto-fill,minmax(320px,1fr))] md:grid-cols-[repeat(auto-fill,minmax(620px,1fr))]"},mt=["href"],_t=["href"],ht=["href"],ft={class:"flex gap-2"},gt={key:1},vt={class:"mt-2 space-y-1"},yt={class:"font-semibold text-lg text-bold-700"},xt={style:{width:"50px","text-align":"center"}},bt={class:"text-right"},wt={class:"text-right"},kt={class:"text-right"},St={class:"flex justify-end gap-2 mt-4"},Mt={key:0,class:"flex flex-col items-center justify-center p-6 bg-gray-100 rounded-2xl border border-dashed border-gray-300 shadow-sm"},$t={class:"text-gray-600 text-lg font-medium"},Dt={__name:"Index",setup(R){const{t:l,locale:s}=Z(),c=tt();st();const B=et(),M=b([]),$=b(!1),C=q("dayJS"),T=q("fileUrl"),w=b("waiting"),j=b([]),g=b({range:[C().subtract(6,"day").startOf("day").valueOf(),C().endOf("day").valueOf()],status:"waiting"}),f=async()=>{$.value=!0;try{M.value=await U.all(g.value)}finally{$.value=!1}},Y=async()=>{try{j.value=await ut.all()}catch{}},G=async(m,o)=>{try{await U.updateStatus(m,{status:o}),B.success(l("updated status")),f()}catch{B.error("Xatolik yuz berdi")}},E=m=>{let o=c.orderStatus.find(k=>k["label_"+s.value]==m);g.value.status=o.value,w.value=m,f()};return lt(()=>{Y(),f()}),at(()=>s.value,m=>{c.orderStatus.length>0&&(w.value=c.orderStatus[0]["label_"+m])},{immediate:!0}),(m,o)=>{const k=y("n-date-picker"),F=y("n-image"),J=y("n-table"),A=y("n-scrollbar"),P=y("n-tab-pane"),Q=y("n-tabs");return d(),_("div",it,[t("div",dt,[t("div",ct,[o[3]||(o[3]=t("h2",{class:"text-2xl font-bold"},"Buyurtmalar",-1)),u(k,{style:{"min-width":"300px"},value:g.value.range,"onUpdate:value":[o[0]||(o[0]=p=>g.value.range=p),f],type:"daterange"},null,8,["value"]),t("div",null,[u(e(z),{options:j.value,value:g.value.client_id,"onUpdate:value":[o[1]||(o[1]=p=>g.value.client_id=p),f],placeholder:e(l)("client_one"),filterable:"",clearable:"","label-field":"fullname","value-field":"id"},null,8,["options","value","placeholder"])])]),u(e(V),{type:"warning",onClick:f},{icon:i(()=>[u(e(H),null,{default:i(()=>[u(e(K))]),_:1})]),default:i(()=>[h(" "+a(e(l)("update")),1)]),_:1})]),u(Q,{type:"line",animated:"",value:w.value,"onUpdate:value":[o[2]||(o[2]=p=>w.value=p),E]},{default:i(()=>[(d(!0),_(N,null,O(e(c).orderStatus,p=>(d(),L(P,{key:p.value,name:p["label_"+e(s)],tab:p["label_"+e(s)]},{default:i(()=>[t("div",pt,[(d(!0),_(N,null,O(M.value,n=>(d(),_("div",{key:n.id},[u(e(ot),{title:`${e(l)("order")} #${n.id} ${n.client.first_name} ${n.client.last_name}`,size:"medium"},{"header-extra":i(()=>[u(e(z),{style:{"min-width":"180px"},value:n.status,"onUpdate:value":[r=>n.status=r,r=>G(n.id,r)],options:e(c).orderStatus,"label-field":"label_"+e(s),size:"small"},null,8,["value","onUpdate:value","options","label-field"])]),default:i(()=>[t("p",null,[t("strong",null,a(e(l)("datetime"))+":",1),h(" "+a(e(C)(n.datetime).format("YYYY-MM-DD HH:mm:ss")),1)]),t("p",null,[t("strong",null,a(e(l)("phone"))+":",1),t("a",{href:"tel:"+n.client.phone_number,class:"text-blue-500"},a(n.client.phone_number),9,mt)]),t("p",null,[t("strong",null,a(e(l)("additional phone number"))+":",1),t("a",{href:"tel:"+n.phone2,class:"text-blue-500"},a(n.phone2),9,_t)]),t("p",null,[t("strong",null,a(e(l)("address"))+":",1),h(" "+a(n.address),1)]),t("p",null,[t("strong",null,a(e(l)("location"))+":",1),t("a",{class:"text-blue-500",href:`https://www.google.com/maps?q=${n.lat},${n.lon}`,target:"_blank",style:{"text-decoration":"none"}}," 📍 Google Map ",8,ht)]),t("p",null,[t("strong",null,a(e(l)("comment"))+":",1),h(" "+a(n.comment),1)]),t("p",null,[t("strong",null,a(e(l)("pay_type"))+":",1),h(" "+a(n.payment_type),1)]),t("p",null,[t("strong",null,a(e(l)("total")+" "+e(l)("summa").toLocaleLowerCase())+":",1),h(" "+a(e(S)(n.total_price)),1)]),t("p",null,[t("strong",null,a(e(l)("delivery_summa"))+":",1),h(" "+a(e(S)(n.delivery_summa)),1)]),t("div",ft,[t("strong",null,a(e(l)("payment image"))+":",1),n.payment_image?(d(),L(F,{key:0,width:"100",src:e(T)+n.payment_image},null,8,["src"])):(d(),_("span",gt,a(e(l)("image not found")),1))]),t("div",vt,[t("h2",yt,a(e(l)("products"))+":",1),u(A,{style:{"max-height":"300px","max-width":"800px"},"x-scrollable":""},{default:i(()=>[u(J,{size:"small",bordered:!0,"single-line":!1},{default:i(()=>[t("thead",null,[t("tr",null,[o[4]||(o[4]=t("th",{style:{width:"50px","text-align":"center"}},"№",-1)),t("th",null,a(e(l)("product")),1),t("th",null,a(e(l)("quantity")),1),t("th",null,a(e(l)("price")),1),t("th",null,a(e(l)("total")+" "+e(l)("summa")),1)])]),t("tbody",null,[(d(!0),_(N,null,O(n.products,(r,X)=>{var D,I;return d(),_("tr",{key:r.id},[t("td",xt,a(X+1),1),t("td",null,a((D=r.product)==null?void 0:D["title_"+e(s)]),1),t("td",bt,a(r.quantity)+" "+a(e(l)((I=r.product)==null?void 0:I.unit)),1),t("td",wt,a(e(S)(r.price)),1),t("td",kt,a(e(S)(r.price*r.quantity)),1)])}),128))])]),_:2},1024)]),_:2},1024)]),t("div",St,[u(e(V),{size:"small",type:"error",onClick:r=>e(U).delete(n.id).then(f)},{icon:i(()=>[u(e(H),null,{default:i(()=>[u(e(W))]),_:1})]),default:i(()=>[h(" "+a(e(l)("delete")),1)]),_:2},1032,["onClick"])])]),_:2},1032,["title"])]))),128))])]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),!$.value&&M.value.length===0?(d(),_("div",Mt,[o[5]||(o[5]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3h18M3 7h18M5 11h14M7 15h10M9 19h6"})],-1)),t("p",$t,a(e(l)("order not available")),1)])):nt("",!0)])}}};export{Dt as default};
