import{b as K,r as C,g as P,c as r,a as t,i as c,v as s,s as e,j as h,n as W,k as m,h as X,m as Z,o as _,G as D,q as j,R as F,S as T}from"./index-C64ZonsX.js";import{E as tt}from"./eye-Dda92Wi_.js";import{E as st}from"./exit-BZ-cbgC6.js";import{r as et}from"./report.service-fJ3b0ZKN.js";import{p as ot}from"./product.service-D9ltv91d.js";import{c as l}from"./NumberFormat-BDrUmd0_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const at={class:"p-4"},lt={class:"bg-white rounded-lg shadow-md"},dt={class:"flex justify-between items-center p-4 bg-gray-100 rounded-t-lg"},nt={class:"text-xl font-bold"},ct={class:"flex flex-wrap gap-4 p-2"},it={class:"w-[400px] sm:w-[300px]"},rt={class:"w-full sm:w-64"},_t={class:"w-full sm:w-auto"},pt={class:"p-4"},ut={class:"md:hidden space-y-3"},ht=["onClick"],mt={class:"flex items-start justify-between gap-2"},xt={class:"flex items-center gap-2"},vt={class:"text-xs text-slate-500"},ft={class:"text-[11px] px-2 py-0.5 rounded bg-slate-100 text-slate-700"},gt={class:"text-xs text-slate-500"},bt={class:"mt-1"},yt={class:"text-slate-500 text-xs"},wt=["title"],kt={class:"mt-2 grid grid-cols-2 gap-2"},Ct={class:"text-slate-500 text-[11px]"},Dt={class:"font-semibold"},jt={class:"text-right"},Lt={class:"text-slate-500 text-[11px]"},St={class:"font-semibold"},Yt={class:"text-slate-500 text-[11px]"},Et={class:"font-semibold"},It={class:"text-right"},Mt={class:"text-slate-500 text-[11px]"},Rt={class:"font-semibold"},Ht={class:"text-slate-500 text-[11px]"},Bt={class:"font-semibold"},Nt={class:"text-right"},Vt={class:"text-slate-500 text-[11px]"},Ft={class:"font-semibold"},Tt={class:"mt-2 flex items-center justify-between"},$t={class:"text-[11px] text-slate-500"},qt={class:"text-xs font-medium text-slate-700 text-right truncate max-w-[65%]"},Jt={key:0},Ot={class:"rounded-lg border p-3 bg-gray-50 sticky bottom-5"},Ut={class:"flex justify-between text-sm"},zt={class:"font-semibold"},Gt={class:"flex justify-between text-sm mt-1"},Qt={class:"font-semibold"},At={class:"flex justify-between text-sm mt-1"},Kt={class:"font-semibold"},Pt={class:"flex justify-between text-sm mt-1"},Wt={class:"font-semibold"},Xt={class:"flex justify-between text-sm mt-1"},Zt={class:"font-semibold"},ts={key:0,class:"rounded-lg border p-6 bg-white"},ss={class:"hidden md:block"},es={class:"overflow-x-auto"},os={class:"min-w-[1100px] w-full bg-white shadow-md rounded-lg overflow-hidden border table-auto"},as={class:"bg-gray-200 text-left border"},ls={class:"px-4 py-2 text-sm"},ds={class:"px-4 py-2 text-sm w-[130px]"},ns={class:"px-4 py-2 text-sm"},cs={class:"px-4 py-2 text-sm"},is={class:"px-4 py-2 text-sm"},rs={class:"px-4 py-2 text-sm"},_s={class:"px-4 py-2 text-sm"},ps={class:"px-4 py-2 text-sm"},us={class:"px-4 py-2 text-sm"},hs={class:"px-4 py-2 text-sm"},ms=["onDblclick"],xs={class:"px-4 py-2 border"},vs={class:"px-4 py-2 border"},fs={class:"px-4 py-2 border"},gs=["title"],bs={class:"px-4 py-2 text-right border"},ys={class:"px-4 py-2 text-right border"},ws={class:"px-4 py-2 text-right border"},ks={class:"px-4 py-2 text-right border"},Cs={class:"px-4 py-2 text-right border"},Ds={class:"px-4 py-2 text-right border"},js={class:"px-4 py-2 text-center border"},Ls={key:0},Ss={key:0},Ys={colspan:"11",class:"px-4 py-6 text-center text-slate-500"},Es={class:"bg-gray-100"},Is={colspan:"2",class:"px-4 py-2 text-center font-semibold border"},Ms={class:"px-4 py-2 text-right border"},Rs={colspan:"4",class:"px-4 py-2 text-right border"},Hs={class:"px-4 py-2 text-right border"},Bs={class:"px-4 py-2 text-right border"},Ns={class:"px-4 py-2 text-right border"},zs={__name:"most_profitable_sverka",setup(Vs){const{t:a,locale:x}=K(),$=W(),q=X(),S=Z("dayJS"),Y=C([]),L=new Date,J=new Date(L.getFullYear(),L.getMonth(),1);let v=C(!1),E=C(!0);const d=C({data:[],total_product_count:0,total_discount_summa:0,total_profit_summa:0,total_delivery_summa:0}),p=C({range:[J.getTime(),L.getTime()],product_id:null}),O=async()=>{try{Y.value=await ot.all()}catch(n){console.log(n)}},U=()=>{let n=q.query;n!=null&&n.action&&(p.value.product_id=n.product_id?parseInt(n.product_id):null,p.value.range=n.range?[parseInt(n.range[0]),parseInt(n.range[1])]:null,I())};P(()=>{U(),O()});const I=()=>{v.value=!0,E.value=!0,et.mostSoldSverka(p.value).then(n=>{d.value=n,v.value=!1,n.data&&n.data.length>0&&(E.value=!1)})};return(n,i)=>{const M=m("n-icon"),R=m("n-button"),z=m("n-date-picker"),G=m("n-select"),H=m("n-empty"),Q=m("n-spin");return _(),r("div",at,[t("div",lt,[t("div",dt,[t("h2",nt,s(e(a)("most profitable sverka")),1),c(R,{onClick:i[0]||(i[0]=u=>e($).go(-1)),class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700"},{icon:h(()=>[c(M,{size:"28"},{default:h(()=>[c(e(st))]),_:1})]),default:h(()=>[D(" "+s(e(a)("exit")),1)]),_:1})]),t("div",ct,[t("div",it,[c(z,{value:p.value.range,"onUpdate:value":i[1]||(i[1]=u=>p.value.range=u),type:"datetimerange",clearable:"",class:"w-full sm:w-[300px]"},null,8,["value"])]),t("div",rt,[c(G,{options:Y.value,value:p.value.product_id,"onUpdate:value":i[2]||(i[2]=u=>p.value.product_id=u),"value-field":"id","label-field":"title_"+e(x),placeholder:e(a)("product"),filterable:"",clearable:"",class:"w-full"},null,8,["options","value","label-field","placeholder"])]),t("div",_t,[c(R,{type:"success",onClick:I,class:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-700 w-full sm:w-auto"},{icon:h(()=>[c(M,null,{default:h(()=>[c(e(tt))]),_:1})]),default:h(()=>[D(" "+s(e(a)("see")),1)]),_:1})])]),t("div",pt,[c(Q,{show:e(v),class:"w-full"},{default:h(()=>{var u,B,N,V;return[t("div",ut,[(_(!0),r(F,null,T(d.value.data,(o,f)=>{var g,b,y,w,k;return _(),r("div",{key:f,class:"rounded-lg border p-3 shadow-sm bg-white active:scale-[0.99] transition cursor-pointer",onClick:A=>n.tableRowClick(o)},[t("div",mt,[t("div",xt,[t("span",vt,"#"+s(f+1),1),t("span",ft," #"+s(o.order_id),1)]),t("div",gt,s(e(S)(o.datetime).format("DD-MM-YYYY HH:mm")),1)]),t("div",bt,[t("div",yt,s(e(a)("product")),1),t("div",{class:"font-medium truncate",title:(g=o.product)==null?void 0:g["title_"+e(x)]},s(((b=o.product)==null?void 0:b["title_"+e(x)])||"—"),9,wt)]),t("div",kt,[t("div",null,[t("div",Ct,s(e(a)("selling price")),1),t("div",Dt,s(e(l)(o.price||0)),1)]),t("div",jt,[t("div",Lt,s(e(a)("get price")),1),t("div",St,s(e(l)(o.get_price||0)),1)]),t("div",null,[t("div",Yt,s(e(a)("discount")),1),t("div",Et,s(e(l)(o.discount_summa||0)),1)]),t("div",It,[t("div",Mt,s(e(a)("profit")),1),t("div",Rt,s(e(l)((o.price||0)-(o.get_price||0)-(o.discount_summa||0))),1)]),t("div",null,[t("div",Ht,s(e(a)("delivery_summa")),1),t("div",Bt,s(e(l)(o.delivery_summa||0)),1)]),t("div",Nt,[t("div",Vt,s(e(a)("total"))+" "+s(e(a)("summa").toLocaleLowerCase()),1),t("div",Ft,s(e(l)((o.price||0)-(o.get_price||0)-(o.discount_summa||0)+(o.delivery_summa||0))),1)])]),t("div",Tt,[t("div",$t,s(e(a)("admin_one")),1),t("div",qt,[D(s(((y=o.user)==null?void 0:y.fullname)||"—")+" ",1),(w=o.user)!=null&&w.phone?(_(),r("span",Jt,"| "+s((k=o.user)==null?void 0:k.phone),1)):j("",!0)])])],8,ht)}),128)),t("div",Ot,[t("div",Ut,[t("span",null,s(e(a)("total")),1),t("span",zt,s(((u=d.value.data)==null?void 0:u.length)||0),1)]),t("div",Gt,[t("span",null,s(e(a)("discount")),1),t("span",Qt,s(e(l)(d.value.total_discount_summa||0)),1)]),t("div",At,[t("span",null,s(e(a)("profit")),1),t("span",Kt,s(e(l)(d.value.total_profit_summa||0)),1)]),t("div",Pt,[t("span",null,s(e(a)("delivery_summa")),1),t("span",Wt,s(e(l)(d.value.total_delivery_summa||0)),1)]),t("div",Xt,[t("span",null,s(e(a)("total"))+" "+s(e(a)("summa").toLocaleLowerCase()),1),t("span",Zt,s(e(l)((d.value.total_profit_summa||0)+(d.value.total_delivery_summa||0))),1)])]),!((B=d.value.data)!=null&&B.length)&&!e(v)?(_(),r("div",ts,[c(H)])):j("",!0)]),t("div",ss,[t("div",es,[t("table",os,[t("thead",null,[t("tr",as,[i[3]||(i[3]=t("th",{class:"px-4 py-2 text-sm w-10"},"#",-1)),t("th",ls,s(e(a)("datetime")),1),t("th",ds,s(e(a)("order"))+" "+s(e(a)("count").toLocaleLowerCase()),1),t("th",ns,s(e(a)("product")),1),t("th",cs,s(e(a)("selling price")),1),t("th",is,s(e(a)("get price")),1),t("th",rs,s(e(a)("discount")),1),t("th",_s,s(e(a)("profit")),1),t("th",ps,s(e(a)("delivery_summa")),1),t("th",us,s(e(a)("total"))+" "+s(e(a)("summa").toLocaleLowerCase()),1),t("th",hs,s(e(a)("admin_one")),1)])]),t("tbody",null,[(_(!0),r(F,null,T(d.value.data,(o,f)=>{var g,b,y,w,k;return _(),r("tr",{key:f,class:"border hover:bg-gray-50 cursor-pointer",onDblclick:A=>n.tableRowClick(o)},[t("td",xs,s(f+1),1),t("td",vs,s(e(S)(o.datetime).format("DD-MM-YYYY HH:mm")),1),t("td",fs,"#"+s(o.order_id),1),t("td",{class:"px-4 py-2 border max-w-[360px] truncate",title:(g=o.product)==null?void 0:g["title_"+e(x)]},s((b=o.product)==null?void 0:b["title_"+e(x)]),9,gs),t("td",bs,s(e(l)(o.price)),1),t("td",ys,s(e(l)(o.get_price)),1),t("td",ws,s(e(l)(o.discount_summa)),1),t("td",ks,s(e(l)(o.price-o.get_price-o.discount_summa)),1),t("td",Cs,s(e(l)(o.delivery_summa)),1),t("td",Ds,s(e(l)(o.price-o.get_price-o.discount_summa+o.delivery_summa)),1),t("td",js,[D(s(((y=o.user)==null?void 0:y.fullname)||"—")+" ",1),(w=o.user)!=null&&w.phone?(_(),r("span",Ls,"|| "+s((k=o.user)==null?void 0:k.phone),1)):j("",!0)])],40,ms)}),128)),!((N=d.value.data)!=null&&N.length)&&!e(v)?(_(),r("tr",Ss,[t("td",Ys,[c(H)])])):j("",!0),t("tr",Es,[t("td",Is,s(e(a)("total")),1),t("td",Ms,s(((V=d.value.data)==null?void 0:V.length)||0),1),t("td",Rs,s(e(l)(d.value.total_discount_summa||0)),1),t("td",Hs,s(e(l)(d.value.total_profit_summa||0)),1),t("td",Bs,s(e(l)(d.value.total_delivery_summa||0)),1),t("td",Ns,s(e(l)((d.value.total_profit_summa||0)+(d.value.total_delivery_summa||0))),1),i[4]||(i[4]=t("td",{class:"border"},null,-1))])])])])])]}),_:1},8,["show"])])])])}}};export{zs as default};
