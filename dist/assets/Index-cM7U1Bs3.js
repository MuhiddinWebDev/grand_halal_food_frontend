import{y as U,d as J,n as Y,r as y,h as Q,l as c,q as G,o as L,k as n,j as e,a as p,x as v,t as u,I,s as ee,e as te,J as ae,f as le,g as ne,m as _,K as oe,L as se,O as D,N as C,P as ie,w as re,D as ue,c as de,p as ce}from"./index-FS3_M0KW.js";import{u as pe}from"./index-B3DjrZNR.js";import{A as me}from"./add-DknSKLb-.js";import{R as _e}from"./refresh-BKpmACs9.js";import{P as fe}from"./pen-VOyeA0x0.js";import{S as ge}from"./search-BJgvT6A2.js";import{T as ve}from"./tour-BAD8cXQw.js";import{D as xe}from"./delete-BGCVjkDP.js";import{u as Z}from"./upload.service-CO8PmCkp.js";import{S as we,E as ye}from"./exit-BJmNZds4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const S="/offers";class he{all(a){let s=a!=null&&a.text?"?text="+a.text:"";return U.get(S+"/all"+s).then(k=>k)}create(a){return U.post(S+"/create",a).then(s=>s)}update(a,s){return U.patch(S+`/update/${a}`,s).then(k=>k)}getOne(a){return U.get(S+`/getById/${a}`).then(s=>s)}sendOfferToMobile(a){return U.get(S+`/send-mobile/${a}`).then(s=>s)}delete(a){return U.delete(S+`/delete/${a}`).then(s=>s)}}const R=new he,ke={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},be={class:"text-xl font-semibold"},ze={class:"flex gap-2"},Ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2"},Ce={class:"md:col-span-2"},Se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},H={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(F,{emit:a}){const{t:s,locale:k}=J(),M=Y("fileUrl"),f=F,N=a,B=y(null),h=y(!1),b=y(null),i=y({title_uz:"",title_ru:"",title_ko:"",title_en:"",link:"",image:""}),d=r=>({required:!0,trigger:"blur",validator:(l,t)=>{if(!t)return new Error(s(r==="image"?"require_image":"require_name"))}}),x={title_uz:d("title_uz"),title_ko:d("title_ko"),title_ru:d("title_ru"),title_en:d("title_en"),image:d("image")};Q(async()=>{if(f.type==="update"&&f.id)try{const r=await R.getOne(f.id);i.value=r}catch(r){console.error("Ma'lumot yuklashda xatolik:",r)}setTimeout(()=>{var r;(r=b.value)==null||r.focus()},100)});const K=async()=>{var r;try{if(await((r=B.value)==null?void 0:r.validate()),h.value=!0,f.type==="create"){const l=await R.create(i.value);N("create",l)}else if(f.type==="update"){const l=await R.update(f.id,i.value);N("update",l)}}catch(l){console.warn("Form not valid or failed",l)}finally{h.value=!1}},z=()=>N("close"),T=async r=>{if(r)try{await Z.delFile(r)}catch(l){console.warn("Faylni o‘chirishda xatolik:",l)}},j=async r=>{if(r.length>0){const l=new FormData;l.append("file",r[0].file);try{const t=await Z.uploadFile(l);await T(i.value.image),i.value.image=t.file}catch(t){console.error("Yuklashda xatolik:",t)}}},A=()=>{T(i.value.image),i.value.image=""},w=r=>{r.code==="Enter"&&K()};return(r,l)=>{const t=c("n-icon"),o=c("n-button"),V=c("n-text"),q=c("n-p"),O=c("n-upload-dragger"),P=c("n-upload"),m=c("n-image"),$=c("n-input"),E=c("n-form-item"),W=c("n-spin"),X=c("n-form");return L(),G(X,{ref_key:"formRef",ref:B,model:i.value,rules:x},{default:n(()=>[e(W,{show:h.value},{default:n(()=>[p("div",ke,[p("p",be,v(u(s)("offer"))+" "+v(f.type=="create"?u(s)("add").toLowerCase():u(s)("change").toLowerCase()),1),p("div",ze,[e(o,{onClick:K,type:"success",disabled:h.value,class:"min-w-[120px]"},{icon:n(()=>[e(t,null,{default:n(()=>[e(u(we))]),_:1})]),default:n(()=>[I(" "+v(u(s)("save"))+" ",1),l[5]||(l[5]=p("span",{class:"text-xs ml-1"},"Enter",-1))]),_:1,__:[5]},8,["disabled"]),e(o,{onClick:z,type:"warning",class:"min-w-[120px]"},{icon:n(()=>[e(t,null,{default:n(()=>[e(u(ye))]),_:1})]),default:n(()=>[I(" "+v(u(s)("exit"))+" ",1),l[6]||(l[6]=p("span",{class:"text-xs ml-1"},"Esc",-1))]),_:1,__:[6]})])]),p("div",Ue,[p("div",Ce,[e(P,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":j,onRemove:A},{default:n(()=>[e(O,{accept:"image/png, image/jpeg"},{default:n(()=>[e(V,{class:"text-base"},{default:n(()=>[I(v(r.$t("upload_image")),1)]),_:1}),e(q,{depth:"3",class:"mt-2"},{default:n(()=>[I(v(r.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})]),p("div",null,[i.value.image?(L(),G(m,{key:0,src:u(M)+i.value.image,width:"120",height:"80",class:"rounded"},null,8,["src"])):ee("",!0)])]),p("div",Se,[e(E,{label:u(s)("title")+" UZB",path:"title_uz"},{default:n(()=>[e($,{ref_key:"inputInstRef",ref:b,onKeydown:w,value:i.value.title_uz,"onUpdate:value":l[0]||(l[0]=g=>i.value.title_uz=g),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(E,{label:u(s)("title")+" KOR",path:"title_ko"},{default:n(()=>[e($,{onKeydown:w,value:i.value.title_ko,"onUpdate:value":l[1]||(l[1]=g=>i.value.title_ko=g),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(E,{label:u(s)("title")+" RUS",path:"title_ru"},{default:n(()=>[e($,{onKeydown:w,value:i.value.title_ru,"onUpdate:value":l[2]||(l[2]=g=>i.value.title_ru=g),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(E,{label:u(s)("title")+" ENG",path:"title_en"},{default:n(()=>[e($,{onKeydown:w,value:i.value.title_en,"onUpdate:value":l[3]||(l[3]=g=>i.value.title_en=g),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])]),e(E,{label:u(s)("link"),path:"link"},{default:n(()=>[e($,{onKeydown:w,value:i.value.link,"onUpdate:value":l[4]||(l[4]=g=>i.value.link=g),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["show"])]),_:1},8,["model"])}}},Ie={class:"p-2 space-y-2 bg-white rounded-xl shadow-md overflow-x-auto"},Re={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ne={class:"text-xl font-bold"},$e={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Ve={__name:"Index",setup(F){const{t:a}=J(),{insert:s,shift:k,r:M}=pe();ce();const f=te(),N=ae();le();const B=Y("fileUrl"),h=y([]),b=y(!1),i=y({text:""}),d=y({create:!1,update:!1,update_id:null}),x=t=>{b.value=!0,R.all(i.value).then(o=>{h.value=o,b.value=!1,t&&(d.value[t]=!1)})},K=ne(()=>[{title:"№",key:"id",align:"center",width:50,render:(t,o)=>o+1},{title:a("title")+" UZB",key:"title_uz",render(t){return console.log(t.category),_("div",{class:"flex items-center"},[t.image?_(oe,{src:B+t.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):_(se,{size:"small",style:{marginRight:"8px"}}),_("span",{class:"font-semibold"},t.title_uz)])}},{title:a("title")+" KOR",key:"title_ko"},{title:a("title")+" RUS",key:"title_ru"},{title:a("title")+" ENG",key:"title_en"},{title:a("link"),key:"link"},{title:a("action"),key:"action",align:"center",fixed:"right",width:160,render(t){return[_(D,{size:"small",type:"info",onClick:o=>{R.sendOfferToMobile(t.id).then(()=>{})},style:{marginRight:"8px"}},{icon:()=>_(C,{component:ve,size:22})}),_(D,{size:"small",type:"success",onClick:o=>{d.value.update_id=t.id,d.value.update=!0},style:{marginRight:"8px"}},{icon:()=>_(C,{component:fe,size:22})}),_(D,{size:"small",type:"warning",onClick:()=>{f.warning({title:a("warning"),content:a("delete_row"),positiveText:a("yes"),negativeText:a("no"),onPositiveClick:()=>{R.delete(t.id).then(()=>x())},onNegativeClick:()=>N.success(a("cancel"))})}},{icon:()=>_(C,{component:xe,size:22})})]}}]),z=ie({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:t=>z.page=t,onUpdatePageSize:t=>{z.pageSize=t,z.page=1}}),T=t=>({style:"cursor: pointer;"}),j=()=>x(),A=()=>{i.value.text="",x()},w=()=>d.value.create=!0,r=t=>d.value[t]=!1,l=t=>x(t);return re(s,t=>t&&w()),ue(()=>{k.value&&M.value&&x()}),Q(()=>x()),(t,o)=>{const V=c("n-input"),q=c("n-data-table"),O=c("n-card"),P=c("n-modal");return L(),de("div",Ie,[p("div",Re,[p("h2",Ne,v(u(a)("offers")),1),p("div",$e,[e(V,{value:i.value.text,"onUpdate:value":o[0]||(o[0]=m=>i.value.text=m),onInput:j,placeholder:u(a)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:n(()=>[e(u(C),null,{default:n(()=>[e(u(ge))]),_:1})]),_:1},8,["value","placeholder"]),e(u(D),{type:"warning",onClick:A},{icon:n(()=>[e(u(C),null,{default:n(()=>[e(u(_e))]),_:1})]),default:n(()=>[I(" "+v(u(a)("update"))+" ",1),o[7]||(o[7]=p("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),e(u(D),{type:"success",onClick:w},{icon:n(()=>[e(u(C),null,{default:n(()=>[e(u(me))]),_:1})]),default:n(()=>[I(" "+v(u(a)("add"))+" ",1),o[8]||(o[8]=p("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),e(q,{"row-props":T,pagination:z,loading:b.value,columns:K.value,data:h.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e(P,{"transform-origin":"center",show:d.value.create,"onUpdate:show":o[3]||(o[3]=m=>d.value.create=m)},{default:n(()=>[e(O,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:n(()=>[e(H,{onClose:o[1]||(o[1]=m=>r("create")),onCreate:o[2]||(o[2]=m=>l("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e(P,{"transform-origin":"center",show:d.value.update,"onUpdate:show":o[6]||(o[6]=m=>d.value.update=m)},{default:n(()=>[e(O,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:n(()=>[e(H,{type:"update",id:d.value.update_id,onClose:o[4]||(o[4]=m=>r("update")),onUpdate:o[5]||(o[5]=m=>l("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Ve as default};
