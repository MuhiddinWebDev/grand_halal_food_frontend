import{R as rt}from"./refresh-C64adBlx.js";import{D as it}from"./delete-BDP5JkF-.js";import{y as m,d as ut,f as ct,J as dt,r as b,n as Y,h as pt,w as _t,c as g,a as t,j as u,s as ht,x as a,t as s,l as w,T as H,k as c,O as J,p as mt,o as d,I as p,N as A,R as $,S as j,q as E,U as gt}from"./index-DWxUX1dU.js";import{c as vt}from"./clients.service-C2tAcr8F.js";import{c as M}from"./NumberFormat-BDrUmd0_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const v="/order";class ft{all(e){return m.post(v+"/all",e).then(o=>o)}statusOption(){return m.get(v+"/status").then(e=>e)}create(e){return m.post(v+"/",e).then(o=>o)}update(e,o){return m.patch(v+`/update${e}`,o).then(f=>f)}updateStatus(e,o){return m.patch(v+`/updateStatus/${e}`,o).then(f=>f)}updatePaid(e){return m.patch(v+`/paid/${e}`).then(o=>o)}getOne(e){return m.get(v+`/${e}`).then(o=>o)}delete(e){return m.delete(v+`/delete/${e}`).then(o=>o)}}const S=new ft,yt={class:"space-y-2 p-2"},bt={class:"flex justify-between flex-wrap items-center gap-2"},xt={class:"flex gap-2 items-center flex-wrap"},wt={class:"text-2xl font-bold"},kt={class:"grid gap-2 grid-cols-[repeat(auto-fill,minmax(320px,1fr))] md:grid-cols-[repeat(auto-fill,minmax(620px,1fr))]"},St={class:"flex justify-between items-center mb-2"},Ot={class:"text-lg font-semibold text-gray-800"},Mt={class:"text-sm space-y-1 text-gray-700"},Ct=["href"],Ut=["href"],Nt=["href"],$t={class:"flex items-center gap-2"},jt={key:1,class:"text-gray-400 italic"},It={class:"flex items-center gap-3 mt-2"},Bt={class:"text-sm"},Dt={class:"mt-4 space-y-1"},qt={class:"font-semibold text-base"},zt={class:"min-w-full text-sm border border-gray-200 rounded overflow-hidden"},Tt={class:"bg-gray-100"},Pt={class:"p-2 text-left"},Rt={class:"p-2 text-right"},Vt={class:"p-2 text-right"},Yt={class:"p-2 text-right"},Ht={class:"p-2 text-center"},Jt={class:"p-2"},At={class:"p-2 text-right"},Et={class:"p-2 text-right"},Ft={class:"p-2 text-right"},Gt={class:"flex justify-end mt-4"},Lt={key:0,class:"flex flex-col items-center justify-center p-6 bg-gray-100 rounded-2xl border border-dashed border-gray-300 shadow-sm"},Xt={class:"text-gray-600 text-lg font-medium"},ae={__name:"Index",setup(F){const{t:e,locale:o}=ut();ct(),mt();const f=dt(),C=b([]),U=b(!1),N=Y("dayJS"),G=Y("fileUrl"),k=b("waiting"),I=b([]),y=b([]),B=b({}),x=b({range:[N().subtract(6,"day").startOf("day").valueOf(),N().endOf("day").valueOf()],status:"waiting"}),_=async()=>{U.value=!0;try{C.value=await S.all(x.value)}finally{U.value=!1}},L=async()=>{try{I.value=await vt.all()}catch{}},X=async()=>{var r;try{let n=await S.statusOption();B.value=n,y.value=n[o.value],((r=y.value)==null?void 0:r.length)>0&&(k.value=y.value[0].label,D(k.value))}catch(n){console.error(n)}},K=async(r,n)=>{try{await S.updateStatus(r,{status:n}),f.success(e("updated status")),_()}catch{f.error("Xatolik yuz berdi")}},Q=async r=>{try{await S.updatePaid(r),_()}catch{f.error("Xatolik yuz berdi")}},D=r=>{let n=y.value.find(O=>O.label==r);x.value.status=n.value,k.value=r,_()},W=r=>{console.log(r),S.delete(r).then(n=>{console.log(n),_()})};return pt(()=>{L(),_(),X()}),_t(()=>o.value,r=>{y.value=B.value[r]},{immediate:!0}),(r,n)=>{const O=w("n-date-picker"),Z=w("n-image"),tt=w("n-switch"),et=w("n-scrollbar"),at=w("n-tab-pane"),st=w("n-tabs");return d(),g("div",yt,[t("div",bt,[t("div",xt,[t("h2",wt,a(s(e)("orders")),1),u(O,{style:{"min-width":"300px"},value:x.value.range,"onUpdate:value":[n[0]||(n[0]=h=>x.value.range=h),_],type:"daterange"},null,8,["value"]),t("div",null,[u(s(H),{options:I.value,value:x.value.client_id,"onUpdate:value":[n[1]||(n[1]=h=>x.value.client_id=h),_],placeholder:s(e)("client_one"),filterable:"",clearable:"","label-field":"fullname","value-field":"id"},null,8,["options","value","placeholder"])])]),u(s(J),{type:"warning",onClick:_},{icon:c(()=>[u(s(A),null,{default:c(()=>[u(s(rt))]),_:1})]),default:c(()=>[p(" "+a(s(e)("update")),1)]),_:1})]),u(st,{type:"line",animated:"",value:k.value,"onUpdate:value":[n[2]||(n[2]=h=>k.value=h),D]},{default:c(()=>[(d(!0),g($,null,j(y.value,(h,lt)=>(d(),E(at,{key:lt,name:h.label,tab:h.label},{default:c(()=>[t("div",kt,[(d(!0),g($,null,j(C.value,(l,nt)=>{var q,z,T,P;return d(),g("div",{key:l.id,class:gt(["rounded-xl border-2 p-4 mb-6 transition-all duration-200 shadow-sm hover:shadow-md",l.paid?"border-green-400 bg-green-50":"border-red-300 bg-red-50 hover:bg-red-100"])},[t("div",St,[t("h2",Ot,a(s(e)("order"))+" #"+a(nt+1)+" "+a(((q=l.client)==null?void 0:q.first_name)||"")+" "+a(((z=l.client)==null?void 0:z.last_name)||""),1),u(s(H),{style:{"max-width":"200px"},value:l.status,"onUpdate:value":[i=>l.status=i,i=>K(l.id,i)],options:y.value,"label-field":"label",size:"small"},null,8,["value","onUpdate:value","options"])]),t("div",Mt,[t("p",null,[t("strong",null,a(s(e)("datetime"))+":",1),p(" "+a(s(N)(l.datetime).format("YYYY-MM-DD HH:mm:ss")),1)]),t("p",null,[t("strong",null,a(s(e)("phone"))+":",1),t("a",{href:"tel:"+((T=l.client)==null?void 0:T.phone_number),class:"text-blue-500 underline"},a((P=l.client)==null?void 0:P.phone_number),9,Ct)]),t("p",null,[t("strong",null,a(s(e)("additional phone number"))+":",1),t("a",{href:"tel:"+l.phone2,class:"text-blue-500 underline"},a(l.phone2),9,Ut)]),t("p",null,[t("strong",null,a(s(e)("address"))+":",1),p(" "+a(l.address),1)]),t("p",null,[t("strong",null,a(s(e)("location"))+":",1),t("a",{class:"text-blue-500 underline",href:`https://www.google.com/maps?q=${l.lat},${l.lon}`,target:"_blank"}," 📍 Google Map ",8,Nt)]),t("p",null,[t("strong",null,a(s(e)("comment"))+":",1),p(" "+a(l.comment),1)]),t("p",null,[t("strong",null,a(s(e)("pay_type"))+":",1),p(" "+a(l.payment_type),1)]),t("p",null,[t("strong",null,a(s(e)("total"))+" "+a(s(e)("summa").toLowerCase())+":",1),p(" "+a(s(M)(l.total_price)),1)]),t("p",null,[t("strong",null,a(s(e)("delivery_summa"))+":",1),p(" "+a(s(M)(l.delivery_summa)),1)]),t("div",$t,[t("strong",null,a(s(e)("payment image"))+":",1),l.payment_image?(d(),E(Z,{key:0,width:"100",src:s(G)+l.payment_image},null,8,["src"])):(d(),g("span",jt,a(s(e)("image not found")),1))]),t("div",It,[t("strong",Bt,a(s(e)("payment"))+":",1),u(tt,{value:l.paid,"onUpdate:value":i=>Q(l.id)},{checked:c(()=>[p(a(s(e)("paid")),1)]),unchecked:c(()=>[p(a(s(e)("unpaid")),1)]),_:2},1032,["value","onUpdate:value"])])]),t("div",Dt,[t("h3",qt,a(s(e)("products"))+":",1),u(et,{style:{"max-height":"300px","max-width":"100%"}},{default:c(()=>[t("table",zt,[t("thead",Tt,[t("tr",null,[n[3]||(n[3]=t("th",{class:"p-2 text-center w-10"},"№",-1)),t("th",Pt,a(s(e)("product")),1),t("th",Rt,a(s(e)("quantity")),1),t("th",Vt,a(s(e)("price")),1),t("th",Yt,a(s(e)("total"))+" "+a(s(e)("summa")),1)])]),t("tbody",null,[(d(!0),g($,null,j(l.products,(i,ot)=>{var R,V;return d(),g("tr",{key:i.id,class:"hover:bg-gray-50"},[t("td",Ht,a(ot+1),1),t("td",Jt,a((R=i.product)==null?void 0:R["title_"+s(o)]),1),t("td",At,a(i.quantity)+" "+a(s(e)((V=i.product)==null?void 0:V.unit)),1),t("td",Et,a(s(M)(i.price)),1),t("td",Ft,a(s(M)(i.price*i.quantity)),1)])}),128))])])]),_:2},1024)]),t("div",Gt,[u(s(J),{size:"small",type:"error",onClick:i=>W(l.id)},{icon:c(()=>[u(s(A),null,{default:c(()=>[u(s(it))]),_:1})]),default:c(()=>[p(" "+a(s(e)("delete")),1)]),_:2},1032,["onClick"])])],2)}),128))])]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),!U.value&&C.value.length===0?(d(),g("div",Lt,[n[4]||(n[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3h18M3 7h18M5 11h14M7 15h10M9 19h6"})],-1)),t("p",Xt,a(s(e)("order not available")),1)])):ht("",!0)])}}};export{ae as default};
