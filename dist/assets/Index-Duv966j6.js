import{O as C,d as G,H as K,r as v,h as J,w as W,l as p,q as te,o as D,k as l,j as n,a as s,x as d,t as a,G as $,c as j,P as ne,Q as ae,e as le,g as oe,m as H,L as O,N as A,M as se,C as re,p as ce}from"./index-AFM4ajz-.js";import{u as ue,S as ie}from"./index-CevdRaQE.js";import{A as X}from"./add-DxIIQG7R.js";import{R as de}from"./refresh-DXOwnIIO.js";import{D as Y}from"./delete-BSde0mvZ.js";import{p as pe}from"./product.service-BzPssigS.js";import{S as me,E as _e}from"./exit-BsG4ondb.js";import{a as Q}from"./NumberFormat-Dorb8or7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const S="/stock-entries";class fe{all(e){let o=e!=null&&e.text?"?text="+e.text:"";return C.get(S+"/all"+o).then(g=>g)}create(e){return C.post(S+"/create",e).then(o=>o)}update(e,o){return C.patch(S+`/update/${e}`,o).then(g=>g)}getOne(e){return C.get(S+`/getById/${e}`).then(o=>o)}getBrandsByCategory(e){return C.get(S+`/getBrandsByCat/${e}`).then(o=>o)}delete(e){return C.delete(S+`/delete/${e}`).then(o=>o)}}const F=new fe,ve={class:"flex justify-between items-center mb-4"},ge={class:"text-xl font-semibold"},ye={class:"flex gap-2"},he={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xe={__name:"Form",emits:["create","close"],setup(V,{emit:e}){const{t:o,locale:g}=G(),P=e,q=K(),z=v(null),y=v(!1),h=v([]),u=v({comment:"",datetime:new Date().getTime(),entries:[]});J(async()=>{try{const r=await pe.all();h.value=r}catch(r){console.error("Product load error:",r)}});const _=()=>u.value.entries.push({product_id:null,price:0,quantity:1,total:0}),N=r=>u.value.entries.splice(r,1),k=r=>{const i=u.value.entries[r];i.total=(i.price||0)*(i.quantity||0)},U=(r,i)=>{const m=h.value.find(t=>t.id===r);if(m){const t=u.value.entries[i];t.price=m.price,t.total=m.price*(t.quantity||0)}},E=async()=>{try{if(y.value=!0,u.value.entries.length===0)return q.warning("Mahsulot tanlanmagan");const r=u.value.entries.map(i=>({product_id:i.product_id,quantity:i.quantity,type:"in",note:u.value.comment}));for(const i of r)await F.create(i);q.success("Saqlash muvaffaqiyatli"),P("create",r)}catch(r){console.error("Saqlashda xatolik",r),q.error("Saqlashda xatolik")}finally{y.value=!1}},M=()=>P("close");return W(()=>u.value.entries,()=>{u.value.entries.forEach(r=>{r.total=r.price*r.quantity})}),(r,i)=>{const m=p("n-icon"),t=p("n-button"),c=p("n-date-picker"),I=p("n-form-item"),R=p("n-input"),L=p("n-select"),T=p("n-input-number"),x=p("n-table"),Z=p("n-spin"),ee=p("n-form");return D(),te(ee,{ref_key:"formRef",ref:z,model:u.value},{default:l(()=>[n(Z,{show:y.value},{default:l(()=>[s("div",ve,[s("p",ge,d(a(o)("prixod")),1),s("div",ye,[n(t,{onClick:E,type:"success",disabled:y.value},{icon:l(()=>[n(m,null,{default:l(()=>[n(a(me))]),_:1})]),default:l(()=>[$(" "+d(a(o)("save")),1)]),_:1},8,["disabled"]),n(t,{onClick:M,type:"warning"},{icon:l(()=>[n(m,null,{default:l(()=>[n(a(_e))]),_:1})]),default:l(()=>[$(" "+d(a(o)("exit")),1)]),_:1})])]),s("div",he,[n(I,{label:a(o)("datetime")},{default:l(()=>[n(c,{value:u.value.datetime,disabled:!0},null,8,["value"])]),_:1},8,["label"]),n(I,{label:a(o)("comment")},{default:l(()=>[n(R,{value:u.value.comment,"onUpdate:value":i[0]||(i[0]=f=>u.value.comment=f),clearable:""},null,8,["value"])]),_:1},8,["label"]),n(I,null,{default:l(()=>[n(t,{type:"success",onClick:_},{icon:l(()=>[n(m,null,{default:l(()=>[n(a(X))]),_:1})]),default:l(()=>[$(" "+d(a(o)("product")+" "+a(o)("add").toLocaleLowerCase()),1)]),_:1})]),_:1})]),n(x,{bordered:!0,size:"small"},{default:l(()=>[s("thead",null,[s("tr",null,[i[1]||(i[1]=s("th",null,"#",-1)),s("th",null,d(a(o)("product")),1),s("th",null,d(a(o)("price")),1),s("th",null,d(a(o)("quantity")),1),s("th",null,d(a(o)("total")),1),s("th",null,d(a(o)("action")),1)])]),s("tbody",null,[(D(!0),j(ne,null,ae(u.value.entries,(f,B)=>(D(),j("tr",{key:B},[s("td",null,d(B+1),1),s("td",null,[n(L,{style:{width:"200px"},options:h.value,"label-field":"title_"+a(g),"value-field":"id",value:f.product_id,"onUpdate:value":[w=>f.product_id=w,w=>U(w,B)]},null,8,["options","label-field","value","onUpdate:value"])]),s("td",null,d(a(Q)(f.price)),1),s("td",null,[n(T,{value:f.quantity,"onUpdate:value":[w=>f.quantity=w,w=>k(B)],min:1},null,8,["value","onUpdate:value"])]),s("td",null,d(a(Q)(f.total)),1),s("td",null,[n(t,{size:"small",type:"error",onClick:w=>N(B)},{icon:l(()=>[n(m,null,{default:l(()=>[n(a(Y))]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1},8,["show"])]),_:1},8,["model"])}}},we={class:"p-2 space-y-2"},be={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},ke={class:"text-xl font-bold"},Ce={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Ne={__name:"Index",setup(V){const{t:e}=G(),{insert:o,shift:g,r:P}=ue();ce();const q=le(),z=K(),y=v([]),h=v(!1),u=v({text:""}),b=v({create:!1,update:!1,update_id:null}),_=t=>{h.value=!0,F.all().then(c=>{y.value=c,h.value=!1,t&&(b.value[t]=!1)})},N=oe(()=>[{title:"â„–",key:"id",align:"center",width:50,render:(t,c)=>c+1},{title:e("product"),key:"product_id",render(t){var c;return((c=t.product)==null?void 0:c.title_uz)||"-"}},{title:e("quantity"),key:"quantity",align:"center"},{title:e("type"),key:"type",align:"center",render(t){return t.type==="in"?e("kirim"):e("chiqim")}},{title:e("comment"),key:"note"},{title:e("datetime"),key:"createdAt",render(t){return console.log(t.createdAt),new Date(t.createdAt).toLocaleString()}},{title:e("action"),key:"action",align:"center",fixed:"right",width:120,render(t){return[H(O,{size:"small",type:"warning",onClick:()=>{q.warning({title:e("warning"),content:e("delete_row"),positiveText:e("yes"),negativeText:e("no"),onPositiveClick:()=>{F.delete(t.id).then(()=>_()).catch(()=>z.error(e("error")))},onNegativeClick:()=>z.success(e("cancel"))})}},{icon:()=>H(A,{component:Y})})]}}]),k=se({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:t=>k.page=t,onUpdatePageSize:t=>{k.pageSize=t,k.page=1}}),U=()=>({style:"cursor: pointer;"}),E=()=>_(),M=()=>_(),r=()=>b.value.create=!0,i=t=>b.value[t]=!1,m=t=>_(t);return W(o,t=>t&&r()),re(()=>{g.value&&P.value&&_()}),J(()=>_()),(t,c)=>{const I=p("n-input"),R=p("n-data-table"),L=p("n-card"),T=p("n-modal");return D(),j("div",we,[s("div",be,[s("h2",ke,d(a(e)("prixod")),1),s("div",Ce,[n(I,{value:u.value.text,"onUpdate:value":c[0]||(c[0]=x=>u.value.text=x),onInput:E,placeholder:a(e)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:l(()=>[n(a(A),null,{default:l(()=>[n(a(ie))]),_:1})]),_:1},8,["value","placeholder"]),n(a(O),{type:"warning",onClick:M},{icon:l(()=>[n(a(A),null,{default:l(()=>[n(a(de))]),_:1})]),default:l(()=>[$(" "+d(a(e)("update"))+" ",1),c[4]||(c[4]=s("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[4]}),n(a(O),{type:"success",onClick:r},{icon:l(()=>[n(a(A),null,{default:l(()=>[n(a(X))]),_:1})]),default:l(()=>[$(" "+d(a(e)("add"))+" ",1),c[5]||(c[5]=s("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[5]})])]),n(R,{"row-props":U,pagination:k,loading:h.value,columns:N.value,data:y.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1100,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),n(T,{"transform-origin":"center",show:b.value.create,"onUpdate:show":c[3]||(c[3]=x=>b.value.create=x)},{default:l(()=>[n(L,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:l(()=>[n(xe,{onClose:c[1]||(c[1]=x=>i("create")),onCreate:c[2]||(c[2]=x=>m("create")),type:"create"})]),_:1})]),_:1},8,["show"])])}}};export{Ne as default};
