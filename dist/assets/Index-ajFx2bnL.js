import{O as C,d as G,H as J,r as v,j as K,w as W,k as p,o as D,n as te,m as o,l as n,a as s,t as d,p as a,G as B,c as j,P as ne,Q as ae,e as oe,g as le,i as se,I as re,C as ce,N as A,J as O,x as H}from"./index-lszqCMqc.js";import{u as ie}from"./index-ZHZK-JzO.js";import{A as X}from"./add-bUp1q7DN.js";import{R as ue}from"./refresh-l-BsjCMQ.js";import{S as de}from"./search-Jp_syMCz.js";import{D as Y}from"./delete-KjMN84f2.js";import{p as pe}from"./product.service-5HBX8LW8.js";import{S as me,E as _e}from"./exit--pM2v71d.js";import{b as Q}from"./NumberFormat-N2x_sffK.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const S="/stock-entries";class fe{all(e){let l=e!=null&&e.text?"?text="+e.text:"";return C.get(S+"/all"+l).then(g=>g)}create(e){return C.post(S+"/create",e).then(l=>l)}update(e,l){return C.patch(S+`/update/${e}`,l).then(g=>g)}getOne(e){return C.get(S+`/getById/${e}`).then(l=>l)}getBrandsByCategory(e){return C.get(S+`/getBrandsByCat/${e}`).then(l=>l)}delete(e){return C.delete(S+`/delete/${e}`).then(l=>l)}}const F=new fe,ve={class:"flex justify-between items-center mb-4"},ge={class:"text-xl font-semibold"},he={class:"flex gap-2"},ye={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xe=s("th",null,"#",-1),we={__name:"Form",emits:["create","close"],setup(V,{emit:e}){const{t:l,locale:g}=G(),P=e,q=J(),z=v(null),h=v(!1),y=v([]),c=v({comment:"",datetime:new Date().getTime(),entries:[]});K(async()=>{try{const r=await pe.all();y.value=r}catch(r){console.error("Product load error:",r)}});const _=()=>c.value.entries.push({product_id:null,price:0,quantity:1,total:0}),N=r=>c.value.entries.splice(r,1),k=r=>{const u=c.value.entries[r];u.total=(u.price||0)*(u.quantity||0)},U=(r,u)=>{const m=y.value.find(t=>t.id===r);if(m){const t=c.value.entries[u];t.price=m.price,t.total=m.price*(t.quantity||0)}},E=async()=>{try{if(h.value=!0,c.value.entries.length===0)return q.warning("Mahsulot tanlanmagan");const r=c.value.entries.map(u=>({product_id:u.product_id,quantity:u.quantity,type:"in",note:c.value.comment}));for(const u of r)await F.create(u);q.success("Saqlash muvaffaqiyatli"),P("create",r)}catch(r){console.error("Saqlashda xatolik",r),q.error("Saqlashda xatolik")}finally{h.value=!1}},R=()=>P("close");return W(()=>c.value.entries,()=>{c.value.entries.forEach(r=>{r.total=r.price*r.quantity})}),(r,u)=>{const m=p("n-icon"),t=p("n-button"),i=p("n-date-picker"),I=p("n-form-item"),M=p("n-input"),T=p("n-select"),L=p("n-input-number"),x=p("n-table"),Z=p("n-spin"),ee=p("n-form");return D(),te(ee,{ref_key:"formRef",ref:z,model:c.value},{default:o(()=>[n(Z,{show:h.value},{default:o(()=>[s("div",ve,[s("p",ge,d(a(l)("prixod")),1),s("div",he,[n(t,{onClick:E,type:"success",disabled:h.value},{icon:o(()=>[n(m,null,{default:o(()=>[n(a(me))]),_:1})]),default:o(()=>[B(" "+d(a(l)("save")),1)]),_:1},8,["disabled"]),n(t,{onClick:R,type:"warning"},{icon:o(()=>[n(m,null,{default:o(()=>[n(a(_e))]),_:1})]),default:o(()=>[B(" "+d(a(l)("exit")),1)]),_:1})])]),s("div",ye,[n(I,{label:a(l)("datetime")},{default:o(()=>[n(i,{value:c.value.datetime,disabled:!0},null,8,["value"])]),_:1},8,["label"]),n(I,{label:a(l)("comment")},{default:o(()=>[n(M,{value:c.value.comment,"onUpdate:value":u[0]||(u[0]=f=>c.value.comment=f),clearable:""},null,8,["value"])]),_:1},8,["label"]),n(I,null,{default:o(()=>[n(t,{type:"success",onClick:_},{icon:o(()=>[n(m,null,{default:o(()=>[n(a(X))]),_:1})]),default:o(()=>[B(" "+d(a(l)("product")+" "+a(l)("add").toLocaleLowerCase()),1)]),_:1})]),_:1})]),n(x,{bordered:!0,size:"small"},{default:o(()=>[s("thead",null,[s("tr",null,[xe,s("th",null,d(a(l)("product")),1),s("th",null,d(a(l)("price")),1),s("th",null,d(a(l)("quantity")),1),s("th",null,d(a(l)("total")),1),s("th",null,d(a(l)("action")),1)])]),s("tbody",null,[(D(!0),j(ne,null,ae(c.value.entries,(f,$)=>(D(),j("tr",{key:$},[s("td",null,d($+1),1),s("td",null,[n(T,{style:{width:"200px"},options:y.value,"label-field":"title_"+a(g),"value-field":"id",value:f.product_id,"onUpdate:value":[w=>f.product_id=w,w=>U(w,$)]},null,8,["options","label-field","value","onUpdate:value"])]),s("td",null,d(a(Q)(f.price)),1),s("td",null,[n(L,{value:f.quantity,"onUpdate:value":[w=>f.quantity=w,w=>k($)],min:1},null,8,["value","onUpdate:value"])]),s("td",null,d(a(Q)(f.total)),1),s("td",null,[n(t,{size:"small",type:"error",onClick:w=>N($)},{icon:o(()=>[n(m,null,{default:o(()=>[n(a(Y))]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1},8,["show"])]),_:1},8,["model"])}}},be={class:"p-2 space-y-2"},ke={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ce={class:"text-xl font-bold"},Se={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},qe=s("span",{class:"ml-1 text-xs"},"Shift+R",-1),Ie=s("span",{class:"ml-1 text-xs"},"Insert",-1),Me={__name:"Index",setup(V){const{t:e}=G(),{insert:l,shift:g,r:P}=ie();oe();const q=le(),z=J(),h=v([]),y=v(!1),c=v({text:""}),b=v({create:!1,update:!1,update_id:null}),_=t=>{y.value=!0,F.all().then(i=>{h.value=i,y.value=!1,t&&(b.value[t]=!1)})},N=se(()=>[{title:"â„–",key:"id",align:"center",width:50,render:(t,i)=>i+1},{title:e("product"),key:"product_id",render(t){var i;return((i=t.product)==null?void 0:i.title_uz)||"-"}},{title:e("quantity"),key:"quantity",align:"center"},{title:e("type"),key:"type",align:"center",render(t){return t.type==="in"?e("kirim"):e("chiqim")}},{title:e("comment"),key:"note"},{title:e("datetime"),key:"createdAt",render(t){return console.log(t.createdAt),new Date(t.createdAt).toLocaleString()}},{title:e("action"),key:"action",align:"center",width:120,render(t){return[H(O,{size:"small",type:"warning",onClick:()=>{q.warning({title:e("warning"),content:e("delete_row"),positiveText:e("yes"),negativeText:e("no"),onPositiveClick:()=>{F.delete(t.id).then(()=>_()).catch(()=>z.error(e("error")))},onNegativeClick:()=>z.success(e("cancel"))})}},{icon:()=>H(A,{component:Y})})]}}]),k=re({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:t=>k.page=t,onUpdatePageSize:t=>{k.pageSize=t,k.page=1}}),U=()=>({style:"cursor: pointer;"}),E=()=>_(),R=()=>_(),r=()=>b.value.create=!0,u=t=>b.value[t]=!1,m=t=>_(t);return W(l,t=>t&&r()),ce(()=>{g.value&&P.value&&_()}),K(()=>_()),(t,i)=>{const I=p("n-input"),M=p("n-data-table"),T=p("n-card"),L=p("n-modal");return D(),j("div",be,[s("div",ke,[s("h2",Ce,d(a(e)("prixod")),1),s("div",Se,[n(I,{value:c.value.text,"onUpdate:value":i[0]||(i[0]=x=>c.value.text=x),onInput:E,placeholder:a(e)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:o(()=>[n(a(A),null,{default:o(()=>[n(a(de))]),_:1})]),_:1},8,["value","placeholder"]),n(a(O),{type:"warning",onClick:R},{icon:o(()=>[n(a(A),null,{default:o(()=>[n(a(ue))]),_:1})]),default:o(()=>[B(" "+d(a(e)("update"))+" ",1),qe]),_:1}),n(a(O),{type:"success",onClick:r},{icon:o(()=>[n(a(A),null,{default:o(()=>[n(a(X))]),_:1})]),default:o(()=>[B(" "+d(a(e)("add"))+" ",1),Ie]),_:1})])]),n(M,{"row-props":U,pagination:k,loading:y.value,columns:N.value,data:h.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1100,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),n(L,{"transform-origin":"center",show:b.value.create,"onUpdate:show":i[3]||(i[3]=x=>b.value.create=x)},{default:o(()=>[n(T,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:o(()=>[n(we,{onClose:i[1]||(i[1]=x=>u("create")),onCreate:i[2]||(i[2]=x=>m("create")),type:"create"})]),_:1})]),_:1},8,["show"])])}}};export{Me as default};
