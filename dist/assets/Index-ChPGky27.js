import{O as $,d as J,n as Y,r as k,h as Q,l as c,q as L,o as G,k as l,j as e,a as p,x as w,t as s,G as I,s as ee,e as te,H as ae,f as le,g as ne,m as h,I as oe,J as se,L as A,N as E,p as ie,M as re,w as ue,C as de,c as ce}from"./index-DpTnkf6l.js";import{u as pe,S as me}from"./index-DeFxf9IP.js";import{A as _e}from"./add-DOl-DoQe.js";import{R as fe}from"./refresh-DY6Q7-u-.js";import{P as ge}from"./pen-hL1xDDjU.js";import{D as ve}from"./delete-DA5j-UsH.js";import{u as H}from"./upload.service-hZWnX2eZ.js";import{S as we,E as xe}from"./exit-BNblnILt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B="/offers";class ye{all(t){let r=t!=null&&t.text?"?text="+t.text:"";return $.get(B+"/all"+r).then(S=>S)}create(t){return $.post(B+"/create",t).then(r=>r)}update(t,r){return $.patch(B+`/update/${t}`,r).then(S=>S)}getOne(t){return $.get(B+`/getById/${t}`).then(r=>r)}delete(t){return $.delete(B+`/delete/${t}`).then(r=>r)}}const D=new ye,he={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},ke={class:"text-xl font-semibold"},be={class:"flex gap-2"},Se={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2"},Ue={class:"md:col-span-2"},ze={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},Z={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(M,{emit:t}){const{t:r,locale:S}=J(),O=Y("fileUrl"),f=M,R=t,K=k(null),U=k(!1),P=k(null),u=k({title_uz:"",title_ru:"",title_ko:"",title_en:"",link:"",image:""}),g=i=>({required:!0,trigger:"blur",validator:(a,_)=>{if(!_)return new Error(r(i==="image"?"require_image":"require_name"))}}),z={title_uz:g("title_uz"),title_ko:g("title_ko"),title_ru:g("title_ru"),title_en:g("title_en"),image:g("image")};Q(async()=>{if(f.type==="update"&&f.id)try{const i=await D.getOne(f.id);u.value=i}catch(i){console.error("Ma'lumot yuklashda xatolik:",i)}setTimeout(()=>{var i;(i=P.value)==null||i.focus()},100)});const m=async()=>{var i;try{if(await((i=K.value)==null?void 0:i.validate()),U.value=!0,f.type==="create"){const a=await D.create(u.value);R("create",a)}else if(f.type==="update"){const a=await D.update(f.id,u.value);R("update",a)}}catch(a){console.warn("Form not valid or failed",a)}finally{U.value=!1}},x=()=>R("close"),F=async i=>{if(i)try{await H.delFile(i)}catch(a){console.warn("Faylni o‘chirishda xatolik:",a)}},C=async i=>{if(i.length>0){const a=new FormData;a.append("file",i[0].file);try{const _=await H.uploadFile(a);await F(u.value.image),u.value.image=_.file}catch(_){console.error("Yuklashda xatolik:",_)}}},T=()=>{F(u.value.image),u.value.image=""},b=i=>{i.code==="Enter"&&m()};return(i,a)=>{const _=c("n-icon"),N=c("n-button"),o=c("n-text"),n=c("n-p"),V=c("n-upload-dragger"),q=c("n-upload"),j=c("n-image"),y=c("n-input"),d=c("n-form-item"),W=c("n-spin"),X=c("n-form");return G(),L(X,{ref_key:"formRef",ref:K,model:u.value,rules:z},{default:l(()=>[e(W,{show:U.value},{default:l(()=>[p("div",he,[p("p",ke,w(s(r)("offer"))+" "+w(f.type=="create"?s(r)("add").toLowerCase():s(r)("change").toLowerCase()),1),p("div",be,[e(N,{onClick:m,type:"success",disabled:U.value,class:"min-w-[120px]"},{icon:l(()=>[e(_,null,{default:l(()=>[e(s(we))]),_:1})]),default:l(()=>[I(" "+w(s(r)("save"))+" ",1),a[5]||(a[5]=p("span",{class:"text-xs ml-1"},"Enter",-1))]),_:1,__:[5]},8,["disabled"]),e(N,{onClick:x,type:"warning",class:"min-w-[120px]"},{icon:l(()=>[e(_,null,{default:l(()=>[e(s(xe))]),_:1})]),default:l(()=>[I(" "+w(s(r)("exit"))+" ",1),a[6]||(a[6]=p("span",{class:"text-xs ml-1"},"Esc",-1))]),_:1,__:[6]})])]),p("div",Se,[p("div",Ue,[e(q,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":C,onRemove:T},{default:l(()=>[e(V,{accept:"image/png, image/jpeg"},{default:l(()=>[e(o,{class:"text-base"},{default:l(()=>[I(w(i.$t("upload_image")),1)]),_:1}),e(n,{depth:"3",class:"mt-2"},{default:l(()=>[I(w(i.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})]),p("div",null,[u.value.image?(G(),L(j,{key:0,src:s(O)+u.value.image,width:"120",height:"80",class:"rounded"},null,8,["src"])):ee("",!0)])]),p("div",ze,[e(d,{label:s(r)("title")+" UZB",path:"title_uz"},{default:l(()=>[e(y,{ref_key:"inputInstRef",ref:P,onKeydown:b,value:u.value.title_uz,"onUpdate:value":a[0]||(a[0]=v=>u.value.title_uz=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(d,{label:s(r)("title")+" KOR",path:"title_ko"},{default:l(()=>[e(y,{onKeydown:b,value:u.value.title_ko,"onUpdate:value":a[1]||(a[1]=v=>u.value.title_ko=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(d,{label:s(r)("title")+" RUS",path:"title_ru"},{default:l(()=>[e(y,{onKeydown:b,value:u.value.title_ru,"onUpdate:value":a[2]||(a[2]=v=>u.value.title_ru=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(d,{label:s(r)("title")+" ENG",path:"title_en"},{default:l(()=>[e(y,{onKeydown:b,value:u.value.title_en,"onUpdate:value":a[3]||(a[3]=v=>u.value.title_en=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])]),e(d,{label:s(r)("link"),path:"link"},{default:l(()=>[e(y,{onKeydown:b,value:u.value.link,"onUpdate:value":a[4]||(a[4]=v=>u.value.link=v),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["show"])]),_:1},8,["model"])}}},Ce={class:"p-2 space-y-2 bg-white rounded-xl shadow-md overflow-x-auto"},Ie={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Re={class:"text-xl font-bold"},Ne={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Me={__name:"Index",setup(M){const{t}=J(),{insert:r,shift:S,r:O}=pe(),f=ie(),R=te(),K=ae(),U=le(),P=Y("fileUrl"),u=k([]),g=k(!1),z=k({text:""}),m=k({create:!1,update:!1,update_id:null}),x=o=>{g.value=!0,D.all(z.value).then(n=>{u.value=n,g.value=!1,o&&(m.value[o]=!1)})},F=ne(()=>[{title:"№",key:"id",align:"center",width:50,render:(o,n)=>n+1},{title:t("title")+" UZB",key:"title_uz",render(o){return console.log(o.category),h("div",{class:"flex items-center"},[o.image?h(oe,{src:P+o.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):h(se,{size:"small",style:{marginRight:"8px"}}),h("span",{class:"font-semibold"},o.title_uz)])}},{title:t("title")+" KOR",key:"title_ko"},{title:t("title")+" RUS",key:"title_ru"},{title:t("title")+" ENG",key:"title_en"},{title:t("link"),key:"link"},{title:t("action"),key:"action",align:"center",fixed:"right",width:120,render(o){return[h(A,{size:"small",type:"success",onClick:n=>{m.value.update_id=o.id,m.value.update=!0},style:{marginRight:"8px"}},{icon:()=>h(E,{component:ge,size:22})}),h(A,{size:"small",type:"warning",onClick:()=>{R.warning({title:t("warning"),content:t("delete_row"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{D.delete(o.id).then(()=>x()).catch(n=>{U.errorPage=n.data,f.push({name:"error page"})})},onNegativeClick:()=>K.success(t("cancel"))})}},{icon:()=>h(E,{component:ve,size:22})})]}}]),C=re({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:o=>C.page=o,onUpdatePageSize:o=>{C.pageSize=o,C.page=1}}),T=o=>({style:"cursor: pointer;"}),b=()=>x(),i=()=>{z.value.text="",x()},a=()=>m.value.create=!0,_=o=>m.value[o]=!1,N=o=>x(o);return ue(r,o=>o&&a()),de(()=>{S.value&&O.value&&x()}),Q(()=>x()),(o,n)=>{const V=c("n-input"),q=c("n-data-table"),j=c("n-card"),y=c("n-modal");return G(),ce("div",Ce,[p("div",Ie,[p("h2",Re,w(s(t)("offers")),1),p("div",Ne,[e(V,{value:z.value.text,"onUpdate:value":n[0]||(n[0]=d=>z.value.text=d),onInput:b,placeholder:s(t)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:l(()=>[e(s(E),null,{default:l(()=>[e(s(me))]),_:1})]),_:1},8,["value","placeholder"]),e(s(A),{type:"warning",onClick:i},{icon:l(()=>[e(s(E),null,{default:l(()=>[e(s(fe))]),_:1})]),default:l(()=>[I(" "+w(s(t)("update"))+" ",1),n[7]||(n[7]=p("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),e(s(A),{type:"success",onClick:a},{icon:l(()=>[e(s(E),null,{default:l(()=>[e(s(_e))]),_:1})]),default:l(()=>[I(" "+w(s(t)("add"))+" ",1),n[8]||(n[8]=p("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),e(q,{"row-props":T,pagination:C,loading:g.value,columns:F.value,data:u.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e(y,{"transform-origin":"center",show:m.value.create,"onUpdate:show":n[3]||(n[3]=d=>m.value.create=d)},{default:l(()=>[e(j,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:l(()=>[e(Z,{onClose:n[1]||(n[1]=d=>_("create")),onCreate:n[2]||(n[2]=d=>N("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e(y,{"transform-origin":"center",show:m.value.update,"onUpdate:show":n[6]||(n[6]=d=>m.value.update=d)},{default:l(()=>[e(j,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:l(()=>[e(Z,{type:"update",id:m.value.update_id,onClose:n[4]||(n[4]=d=>_("update")),onUpdate:n[5]||(n[5]=d=>N("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Me as default};
