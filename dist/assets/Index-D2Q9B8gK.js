import{d as Q,r as w,H as W,n as X,f as Y,h as Z,l as u,c as ee,o as O,j as t,k as o,a as c,x as g,G as C,t as i,q as ae,s as le,e as ne,g as oe,m as f,I as se,J as re,K as ie,L as j,N,p as ue,M as de,w as ce,C as pe}from"./index-mXaGZWKH.js";import{u as me,S as fe}from"./index-Bmx6EFcZ.js";import{A as ge}from"./add-Kh_RL34q.js";import{R as ve}from"./refresh-DIHAZP8H.js";import{P as _e}from"./pen-havnqXHC.js";import{D as we}from"./delete-Bpd1-14p.js";import{M as $}from"./users.service-Dh4ijLTd.js";import{u as H}from"./upload.service-Dvp1cceP.js";import{S as he,E as xe}from"./exit-CdLCex98.js";import{u as ye}from"./NumberFormat-Dorb8or7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"p-1"},ke={class:"space-y-6"},Ce={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},$e={class:"text-lg font-semibold"},Se={class:"flex flex-col sm:flex-row gap-2"},Ue={class:"space-y-4"},Ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},J={__name:"Form",props:["type","id"],emits:["create","update","close"],setup(G,{emit:s}){const{locale:R,t:S}=Q(),v=G,D=s,P=w(null),h=w(!1),q=W(),A=X("fileUrl"),L=Y(),r=w({phone:"998",image:"",fullname:"",status:!0,role:"Admin",password:"123456",lang:R}),U={phone:{required:!0,trigger:"blur",validator:(a,n)=>{if(n.length<12)return new Error(S("require_phone"))}},fullname:{required:!0,trigger:"blur",validator:(a,n)=>{if(!n)return new Error(S("require_fullname"))}},password:{required:!0,trigger:"blur",validator:(a,n)=>{if(n&&n.length<6)return new Error(S("require_password"))}}};Z(()=>{v.type==="update"&&$.getOne(v.id).then(a=>{r.value=a})});const B=async()=>{var a;try{await((a=P.value)==null?void 0:a.validate()),h.value=!0,(v.type==="create"?$.create(r.value):$.update(v.id,r.value)).then(_=>D(v.type,_)).catch(()=>h.value=!1)}catch{}},b=()=>D("close"),d=a=>a&&H.delFile(a),m=a=>{if(a.length>0){const n=new FormData;n.append("file",a[0].file),H.uploadFile(n).then(_=>{d(r.value.image),r.value.image=_.file})}},V=()=>{d(r.value.image),r.value.image=""},k=a=>{const n=!a||/^\d+$/.test(a);return n||q.warning("Iltimos raqam kiriting"),n},K=a=>a.key==="Enter"&&B();return(a,n)=>{const _=u("n-icon"),I=u("n-button"),F=u("n-text"),M=u("n-p"),e=u("n-upload-dragger"),l=u("n-upload"),z=u("n-image"),E=u("n-input"),x=u("n-form-item"),T=u("n-select"),p=u("n-spin"),te=u("n-form");return O(),ee("div",be,[t(te,{ref_key:"formRef",ref:P,model:r.value,rules:U},{default:o(()=>[t(p,{show:h.value},{default:o(()=>[c("div",ke,[c("div",Ce,[c("p",$e,g(a.$t("admin_one"))+" "+g(v.type==="create"?a.$t("add").toLowerCase():a.$t("change").toLowerCase()),1),c("div",Se,[t(I,{onClick:B,type:"success",disabled:h.value,class:"min-w-[120px]"},{icon:o(()=>[t(_,null,{default:o(()=>[t(i(he))]),_:1})]),default:o(()=>[C(" "+g(a.$t("save"))+" ",1),n[4]||(n[4]=c("span",{class:"ml-1 text-xs"},"Enter",-1))]),_:1,__:[4]},8,["disabled"]),t(I,{onClick:b,type:"warning",class:"min-w-[120px]"},{icon:o(()=>[t(_,null,{default:o(()=>[t(i(xe))]),_:1})]),default:o(()=>[C(" "+g(a.$t("exit"))+" ",1),n[5]||(n[5]=c("span",{class:"ml-1 text-xs"},"Esc",-1))]),_:1,__:[5]})])]),c("div",Ue,[t(l,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":m,onRemove:V},{default:o(()=>[t(e,null,{default:o(()=>[t(F,{class:"text-base"},{default:o(()=>[C(g(a.$t("upload_image")),1)]),_:1}),t(M,{class:"text-sm mt-2"},{default:o(()=>[C(g(a.$t("drop_image")),1)]),_:1})]),_:1})]),_:1}),r.value.image?(O(),ae(z,{key:0,src:i(A)+r.value.image,width:"120",height:"120",class:"rounded"},null,8,["src"])):le("",!0)]),c("div",Ie,[t(x,{label:a.$t("fullname"),path:"fullname"},{default:o(()=>[t(E,{value:r.value.fullname,"onUpdate:value":n[0]||(n[0]=y=>r.value.fullname=y),maxlength:"50","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(x,{label:a.$t("phone"),path:"phone"},{default:o(()=>[t(E,{onKeydown:K,"allow-input":k,value:r.value.phone,"onUpdate:value":n[1]||(n[1]=y=>r.value.phone=y),maxlength:"12",minlength:"12","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(x,{label:a.$t("password"),path:"password"},{default:o(()=>[t(E,{type:"password","show-password-on":"mousedown",value:r.value.password,"onUpdate:value":n[2]||(n[2]=y=>r.value.password=y),minlength:"3","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(x,{label:a.$t("role"),path:"role"},{default:o(()=>[t(T,{options:i(L).roleOption,"value-field":"key","label-field":"name_"+i(R),value:r.value.role,"onUpdate:value":n[3]||(n[3]=y=>r.value.role=y),filterable:""},null,8,["options","label-field","value"])]),_:1},8,["label"])])])]),_:1},8,["show"])]),_:1},8,["model"])])}}},ze={class:"p-2 space-y-2"},Ee={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ne={class:"text-xl font-bold"},Re={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Ke={__name:"Index",setup(G){const{t:s,locale:R}=Q(),{insert:S,shift:v,r:D}=me(),P=ue(),h=ne(),q=W(),A=Y(),L=X("fileUrl"),r=w([]),U=w(!1),B=w(!1),b=w({text:""}),d=w({create:!1,update:!1,update_id:null}),m=e=>{U.value=!0,$.all(b.value).then(l=>{r.value=l,U.value=!1,e&&(d.value[e]=!1)})},V=oe(()=>[{title:"â„–",key:"id",align:"center",width:50,render:(e,l)=>l+1},{title:s("fullname"),key:"fullname",render(e){return f("div",{class:"flex items-center"},[e.image?f(se,{src:L+e.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):f(re,{size:"small",style:{marginRight:"8px"}}),f("span",{class:"font-semibold"},e.fullname)])}},{title:s("phone"),key:"phone",render:e=>ye(e.phone)},{title:s("role"),key:"role",render:e=>{var l;return(l=A.roleOption.find(z=>z.key===e.role))==null?void 0:l[`name_${R.value}`]}},{title:s("active"),key:"status",align:"center",fixed:"right",width:100,render(e){return f(ie,{value:e.status,loading:B.value,round:!0,onUpdateValue:()=>{h.warning({title:s("warning"),content:s("change_active"),positiveText:s("yes"),negativeText:s("no"),onPositiveClick:()=>{e.status=!e.status,$.updateStatus(e.id,e).then(()=>m())},onNegativeClick:()=>q.success(s("cancel"))})}})}},{title:s("action"),key:"action",align:"center",width:120,render(e){return[f(j,{size:"small",type:"success",onClick:l=>{d.value.update_id=e.id,d.value.update=!0},style:{marginRight:"8px"}},{icon:()=>f(N,{component:_e,size:22})}),f(j,{size:"small",type:"warning",onClick:()=>{h.warning({title:s("warning"),content:s("delete_row"),positiveText:s("yes"),negativeText:s("no"),onPositiveClick:()=>{$.delete(e.id).then(()=>m()).catch(l=>{A.errorPage=l.data,P.push({name:"error page"})})},onNegativeClick:()=>q.success(s("cancel"))})}},{icon:()=>f(N,{component:we,size:22})})]}}]),k=de({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:e=>k.page=e,onUpdatePageSize:e=>{k.pageSize=e,k.page=1}}),K=e=>({style:"cursor: pointer;"}),a=e=>e.status?"":"bg-red-50",n=()=>m(),_=()=>{b.value.text="",m()},I=()=>d.value.create=!0,F=e=>d.value[e]=!1,M=e=>m(e);return ce(S,e=>e&&I()),pe(()=>{v.value&&D.value&&m()}),Z(()=>m()),(e,l)=>{const z=u("n-input"),E=u("n-data-table"),x=u("n-card"),T=u("n-modal");return O(),ee("div",ze,[c("div",Ee,[c("h2",Ne,g(i(s)("admin")),1),c("div",Re,[t(z,{value:b.value.text,"onUpdate:value":l[0]||(l[0]=p=>b.value.text=p),onInput:n,placeholder:i(s)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:o(()=>[t(i(N),null,{default:o(()=>[t(i(fe))]),_:1})]),_:1},8,["value","placeholder"]),t(i(j),{type:"warning",onClick:_},{icon:o(()=>[t(i(N),null,{default:o(()=>[t(i(ve))]),_:1})]),default:o(()=>[C(" "+g(i(s)("update"))+" ",1),l[7]||(l[7]=c("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),t(i(j),{type:"success",onClick:I},{icon:o(()=>[t(i(N),null,{default:o(()=>[t(i(ge))]),_:1})]),default:o(()=>[C(" "+g(i(s)("add"))+" ",1),l[8]||(l[8]=c("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),t(E,{"row-props":K,pagination:k,loading:U.value,columns:V.value,data:r.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)","row-class-name":a},null,8,["pagination","loading","columns","data"]),t(T,{"transform-origin":"center",show:d.value.create,"onUpdate:show":l[3]||(l[3]=p=>d.value.create=p)},{default:o(()=>[t(x,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:o(()=>[t(J,{onClose:l[1]||(l[1]=p=>F("create")),onCreate:l[2]||(l[2]=p=>M("create")),type:"create"})]),_:1})]),_:1},8,["show"]),t(T,{"transform-origin":"center",show:d.value.update,"onUpdate:show":l[6]||(l[6]=p=>d.value.update=p)},{default:o(()=>[t(x,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:o(()=>[t(J,{type:"update",id:d.value.update_id,onClose:l[4]||(l[4]=p=>F("update")),onUpdate:l[5]||(l[5]=p=>M("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Ke as default};
