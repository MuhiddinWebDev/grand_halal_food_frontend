import{R as rt}from"./refresh-BKpmACs9.js";import{D as it}from"./delete-BGCVjkDP.js";import{y as _,d as ut,f as ct,J as dt,r as w,n as E,h as pt,w as mt,c as g,a as t,j as u,s as ht,x as a,t as s,l as S,T as F,k as c,O as G,p as _t,o as d,I as p,N as L,R as B,S as D,q as X,U as gt}from"./index-FS3_M0KW.js";import{c as vt}from"./clients.service-C677i5Lf.js";import{c as $}from"./NumberFormat-BDrUmd0_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const v="/order";class ft{all(e){return _.post(v+"/all",e).then(r=>r)}statusOption(){return _.get(v+"/status").then(e=>e)}create(e){return _.post(v+"/",e).then(r=>r)}update(e,r){return _.patch(v+`/update${e}`,r).then(f=>f)}updateStatus(e,r){return _.patch(v+`/updateStatus/${e}`,r).then(f=>f)}updatePaid(e){return _.patch(v+`/paid/${e}`).then(r=>r)}getOne(e){return _.get(v+`/${e}`).then(r=>r)}delete(e){return _.delete(v+`/delete/${e}`).then(r=>r)}}const M=new ft,yt={class:"space-y-2 p-2"},bt={class:"flex justify-between flex-wrap items-center gap-2"},xt={class:"flex gap-2 items-center flex-wrap"},wt={class:"text-2xl font-bold"},kt={class:"grid gap-2 grid-cols-[repeat(auto-fill,minmax(320px,1fr))] md:grid-cols-[repeat(auto-fill,minmax(620px,1fr))]"},St={class:"flex justify-between items-center mb-2"},Ot={class:"text-lg font-semibold text-gray-800"},Mt={class:"text-sm space-y-1 text-gray-700"},Ct=["href"],Ut=["href"],$t=["href"],jt={class:"flex items-center gap-2"},Nt={key:1,class:"text-gray-400 italic"},It={class:"flex items-center gap-3 mt-2"},zt={class:"text-sm"},Bt={class:"mt-4 space-y-1"},Dt={class:"font-semibold text-base"},qt={class:"min-w-full text-sm border border-gray-200 rounded overflow-hidden"},Pt={class:"bg-gray-100"},Tt={class:"p-2 text-left"},Rt={class:"p-2 text-right"},Vt={class:"p-2 text-right"},Yt={class:"p-2 text-right"},Ht={class:"p-2 text-center"},Jt={class:"p-2"},At={class:"p-2 text-right"},Et={class:"p-2 text-right"},Ft={class:"p-2 text-right"},Gt={class:"flex justify-end mt-4"},Lt={key:0,class:"flex flex-col items-center justify-center p-6 bg-gray-100 rounded-2xl border border-dashed border-gray-300 shadow-sm"},Xt={class:"text-gray-600 text-lg font-medium"},ae={__name:"Index",setup(K){const{t:e,locale:r}=ut();ct(),_t();const f=dt(),j=w([]),N=w(!1),I=E("dayJS"),Q=E("fileUrl"),O=w("waiting"),q=w([]),y=w([]),P=w({}),k=w({range:[I().subtract(6,"day").startOf("day").valueOf(),I().endOf("day").valueOf()],status:"waiting"}),m=async()=>{N.value=!0;try{j.value=await M.all(k.value)}finally{N.value=!1}},W=async()=>{try{const o=await vt.all();q.value=o.map(l=>{const b=l.fullname?l.fullname.trim():"",C=l.phone_number?l.phone_number.trim():"",U=l.mail?l.mail.trim():"",x=[];b&&x.push(b),C&&x.push(`📞 ${C}`),U&&x.push(`✉️ ${U}`);const z=x.length>0?x.join(" | "):"";return{...l,label:z}})}catch(o){console.error("Client fetch error:",o)}},Z=async()=>{var o;try{let l=await M.statusOption();P.value=l,y.value=l[r.value],((o=y.value)==null?void 0:o.length)>0&&(O.value=y.value[0].label,T(O.value))}catch(l){console.error(l)}},tt=async(o,l)=>{try{await M.updateStatus(o,{status:l}),f.success(e("updated status")),m()}catch{f.error("Xatolik yuz berdi")}},et=async o=>{try{await M.updatePaid(o),m()}catch{f.error("Xatolik yuz berdi")}},T=o=>{let l=y.value.find(b=>b.label==o);k.value.status=l.value,O.value=o,m()},at=o=>{console.log(o),M.delete(o).then(l=>{console.log(l),m()})};return pt(()=>{W(),m(),Z()}),mt(()=>r.value,o=>{y.value=P.value[o]},{immediate:!0}),(o,l)=>{const b=S("n-date-picker"),C=S("n-image"),U=S("n-switch"),x=S("n-scrollbar"),z=S("n-tab-pane"),st=S("n-tabs");return d(),g("div",yt,[t("div",bt,[t("div",xt,[t("h2",wt,a(s(e)("orders")),1),u(b,{style:{"min-width":"300px"},value:k.value.range,"onUpdate:value":[l[0]||(l[0]=h=>k.value.range=h),m],type:"daterange"},null,8,["value"]),t("div",null,[u(s(F),{options:q.value,value:k.value.client_id,"onUpdate:value":[l[1]||(l[1]=h=>k.value.client_id=h),m],placeholder:"Mijozni tanlang",filterable:"",clearable:"","label-field":"label","value-field":"id"},null,8,["options","value"])])]),u(s(G),{type:"warning",onClick:m},{icon:c(()=>[u(s(L),null,{default:c(()=>[u(s(rt))]),_:1})]),default:c(()=>[p(" "+a(s(e)("update")),1)]),_:1})]),u(st,{type:"line",animated:"",value:O.value,"onUpdate:value":[l[2]||(l[2]=h=>O.value=h),T]},{default:c(()=>[(d(!0),g(B,null,D(y.value,(h,lt)=>(d(),X(z,{key:lt,name:h.label,tab:h.label},{default:c(()=>[t("div",kt,[(d(!0),g(B,null,D(j.value,(n,nt)=>{var R,V,Y,H;return d(),g("div",{key:n.id,class:gt(["rounded-xl border-2 p-4 mb-6 transition-all duration-200 shadow-sm hover:shadow-md",n.paid?"border-green-400 bg-green-50":"border-red-300 bg-red-50 hover:bg-red-100"])},[t("div",St,[t("h2",Ot,a(s(e)("order"))+" #"+a(nt+1)+" "+a(((R=n.client)==null?void 0:R.first_name)||"")+" "+a(((V=n.client)==null?void 0:V.last_name)||""),1),u(s(F),{style:{"max-width":"200px"},value:n.status,"onUpdate:value":[i=>n.status=i,i=>tt(n.id,i)],options:y.value,"label-field":"label",size:"small"},null,8,["value","onUpdate:value","options"])]),t("div",Mt,[t("p",null,[t("strong",null,a(s(e)("datetime"))+":",1),p(" "+a(s(I)(n.datetime).format("YYYY-MM-DD HH:mm:ss")),1)]),t("p",null,[t("strong",null,a(s(e)("phone"))+":",1),t("a",{href:"tel:"+((Y=n.client)==null?void 0:Y.phone_number),class:"text-blue-500 underline"},a((H=n.client)==null?void 0:H.phone_number),9,Ct)]),t("p",null,[t("strong",null,a(s(e)("additional phone number"))+":",1),t("a",{href:"tel:"+n.phone2,class:"text-blue-500 underline"},a(n.phone2),9,Ut)]),t("p",null,[t("strong",null,a(s(e)("address"))+":",1),p(" "+a(n.address),1)]),t("p",null,[t("strong",null,a(s(e)("location"))+":",1),t("a",{class:"text-blue-500 underline",href:`https://www.google.com/maps?q=${n.lat},${n.lon}`,target:"_blank"}," 📍 Google Map ",8,$t)]),t("p",null,[t("strong",null,a(s(e)("comment"))+":",1),p(" "+a(n.comment),1)]),t("p",null,[t("strong",null,a(s(e)("pay_type"))+":",1),p(" "+a(n.payment_type),1)]),t("p",null,[t("strong",null,a(s(e)("total"))+" "+a(s(e)("summa").toLowerCase())+":",1),p(" "+a(s($)(n.total_price)),1)]),t("p",null,[t("strong",null,a(s(e)("delivery_summa"))+":",1),p(" "+a(s($)(n.delivery_summa)),1)]),t("div",jt,[t("strong",null,a(s(e)("payment image"))+":",1),n.payment_image?(d(),X(C,{key:0,width:"100",src:s(Q)+n.payment_image},null,8,["src"])):(d(),g("span",Nt,a(s(e)("image not found")),1))]),t("div",It,[t("strong",zt,a(s(e)("payment"))+":",1),u(U,{value:n.paid,"onUpdate:value":i=>et(n.id)},{checked:c(()=>[p(a(s(e)("paid")),1)]),unchecked:c(()=>[p(a(s(e)("unpaid")),1)]),_:2},1032,["value","onUpdate:value"])])]),t("div",Bt,[t("h3",Dt,a(s(e)("products"))+":",1),u(x,{style:{"max-height":"300px","max-width":"100%"}},{default:c(()=>[t("table",qt,[t("thead",Pt,[t("tr",null,[l[3]||(l[3]=t("th",{class:"p-2 text-center w-10"},"№",-1)),t("th",Tt,a(s(e)("product")),1),t("th",Rt,a(s(e)("quantity")),1),t("th",Vt,a(s(e)("price")),1),t("th",Yt,a(s(e)("total"))+" "+a(s(e)("summa")),1)])]),t("tbody",null,[(d(!0),g(B,null,D(n.products,(i,ot)=>{var J,A;return d(),g("tr",{key:i.id,class:"hover:bg-gray-50"},[t("td",Ht,a(ot+1),1),t("td",Jt,a((J=i.product)==null?void 0:J["title_"+s(r)]),1),t("td",At,a(i.quantity)+" "+a(s(e)((A=i.product)==null?void 0:A.unit)),1),t("td",Et,a(s($)(i.price)),1),t("td",Ft,a(s($)(i.price*i.quantity)),1)])}),128))])])]),_:2},1024)]),t("div",Gt,[u(s(G),{size:"small",type:"error",onClick:i=>at(n.id)},{icon:c(()=>[u(s(L),null,{default:c(()=>[u(s(it))]),_:1})]),default:c(()=>[p(" "+a(s(e)("delete")),1)]),_:2},1032,["onClick"])])],2)}),128))])]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),!N.value&&j.value.length===0?(d(),g("div",Lt,[l[4]||(l[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3h18M3 7h18M5 11h14M7 15h10M9 19h6"})],-1)),t("p",Xt,a(s(e)("order not available")),1)])):ht("",!0)])}}};export{ae as default};
