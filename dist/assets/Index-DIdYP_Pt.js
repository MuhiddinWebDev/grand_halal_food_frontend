import{c as P,o as I,b as fe,f as oe,n as J,d as se,r as y,h as ie,l as m,q as W,k as o,j as t,a as g,x,t as n,G as $,Q as ge,R as be,s as he,e as ye,H as we,g as xe,m as d,I as G,J as H,K as X,L as q,N as M,p as ke,M as Ue,w as ze,C as Se}from"./index-BkkmJgWg.js";import{u as Ce,S as Re}from"./index-Cgcq1nI7.js";import{A as Ke}from"./add-dc-c3G9A.js";import{R as Ie}from"./refresh-DtjYAjoi.js";import{P as $e}from"./pen-Q6q8DIA4.js";import{D as Ne}from"./delete-Bo7FBPv5.js";import{p as U}from"./product.service-BDoj61m3.js";import{c as Ae}from"./category.service-DbdBssxL.js";import{b as Be}from"./brand.service-BAAqNORG.js";import{u as ee}from"./upload.service-BxzdnRwe.js";import{S as De,E as Me}from"./exit-DaC2qT7A.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as te,b as ae,c as le}from"./NumberFormat-Dorb8or7.js";const Fe={},Ve={class:"main-icons"};function qe(j,r){return I(),P("div",Ve,r[0]||(r[0]=[fe('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-12"></path><path d="M9 7V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3"></path></g></svg>',1)]))}const Pe=Ee(Fe,[["render",qe]]),je={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},Te={class:"text-xl font-semibold"},Oe={class:"flex gap-2"},Le={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},Ye={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-2"},Ge={class:"md:col-span-2"},He={class:"grid grid-cols-1 md:grid-cols-6 gap-2 mt-2"},ne={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(j,{emit:r}){const z=oe(),T=J("fileUrl"),{t:u,locale:N}=se(),w=j,A=r,E=y(null),S=y(!1),C=y(null),F=y([]),B=y([]),a=y({title_uz:"",title_ru:"",title_ko:"",title_en:"",category_id:null,brand_id:null,unit:"piece",price:0,discount:0,description_uz:"",description_ru:"",description_ko:"",description_en:"",is_active:!0,top:!1,photos:[]}),R=()=>{Ae.all().then(s=>{F.value=s})},b=()=>{Be.getBrandsByCategory(a.value.category_id).then(s=>{B.value=s})},f=s=>({required:!0,trigger:"blur",validator:(e,l)=>{if(!l)return new Error(u(s))}}),O={title_uz:f("input require"),title_ko:f("input require"),title_ru:f("input require"),title_en:f("input require"),category_id:f("choose require"),brand_id:f("choose require")};ie(async()=>{if(R(),w.type==="update"&&w.id)try{const s=await U.getOne(w.id);a.value=s,s.photos||(a.value.photos=[]),b()}catch(s){console.error("Ma'lumot yuklashda xatolik:",s)}setTimeout(()=>{var s;(s=C.value)==null||s.focus()},100)});const k=async()=>{var s;try{if(await((s=E.value)==null?void 0:s.validate()),S.value=!0,w.type==="create"){const e=await U.create(a.value);A("create",e)}else if(w.type==="update"){a.value.photos||(a.value.photos=[]);const e=await U.update(w.id,a.value);A("update",e)}}catch(e){console.warn("Form not valid or failed",e)}finally{S.value=!1}},L=()=>A("close"),Y=s=>{s&&(a.value.brand_id=null,a.value.category_id=s,b())},v=s=>{s.code==="Enter"&&k()},V=async s=>{if(s&&s.length>0){const e=s[s.length-1];if(e&&e.file){const l=new FormData;l.append("file",e.file);try{const c=await ee.uploadFile(l);a.value.photos.push({name:c.file})}catch(c){console.error("Yuklashda xatolik:",c)}}}},D=async s=>{try{await ee.delFile(s.name),a.value.photos=a.value.photos.filter(e=>e.name!==s.name)}catch(e){console.warn("Faylni o‘chirishda xatolik:",e)}};return(s,e)=>{const l=m("n-icon"),c=m("n-button"),_=m("n-input"),p=m("n-form-item"),K=m("n-select"),h=m("n-input-number"),Z=m("n-space"),Q=m("n-switch"),re=m("n-text"),ue=m("n-p"),de=m("n-upload-dragger"),ce=m("n-upload"),pe=m("n-image"),me=m("n-spin"),ve=m("n-form");return I(),W(ve,{ref_key:"formRef",ref:E,model:a.value,rules:O},{default:o(()=>[t(me,{show:S.value},{default:o(()=>[g("div",je,[g("p",Te,x(n(u)("product"))+" "+x(w.type=="create"?n(u)("add").toLowerCase():n(u)("change").toLowerCase()),1),g("div",Oe,[t(c,{onClick:k,type:"success",disabled:S.value,class:"min-w-[120px]"},{icon:o(()=>[t(l,null,{default:o(()=>[t(n(De))]),_:1})]),default:o(()=>[$(" "+x(n(u)("save"))+" ",1),e[15]||(e[15]=g("span",{class:"text-xs ml-1"},"Enter",-1))]),_:1,__:[15]},8,["disabled"]),t(c,{onClick:L,type:"warning",class:"min-w-[120px]"},{icon:o(()=>[t(l,null,{default:o(()=>[t(n(Me))]),_:1})]),default:o(()=>[$(" "+x(n(u)("exit"))+" ",1),e[16]||(e[16]=g("span",{class:"text-xs ml-1"},"Esc",-1))]),_:1,__:[16]})])]),g("div",Le,[t(p,{label:n(u)("name")+" UZB",path:"title_uz"},{default:o(()=>[t(_,{ref_key:"inputInstRef",ref:C,onKeydown:v,value:a.value.title_uz,"onUpdate:value":e[0]||(e[0]=i=>a.value.title_uz=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:n(u)("name")+" KOR",path:"title_ko"},{default:o(()=>[t(_,{onKeydown:v,value:a.value.title_ko,"onUpdate:value":e[1]||(e[1]=i=>a.value.title_ko=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:n(u)("name")+" RUS",path:"title_ru"},{default:o(()=>[t(_,{onKeydown:v,value:a.value.title_ru,"onUpdate:value":e[2]||(e[2]=i=>a.value.title_ru=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:n(u)("name")+" ENG",path:"title_en"},{default:o(()=>[t(_,{onKeydown:v,value:a.value.title_en,"onUpdate:value":e[3]||(e[3]=i=>a.value.title_en=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:n(u)("category"),path:"category_id"},{default:o(()=>[t(K,{options:F.value,fitlerable:"",clearable:"",onKeydown:v,value:a.value.category_id,"onUpdate:value":[e[4]||(e[4]=i=>a.value.category_id=i),Y],"label-field":"title_"+n(N),"value-field":"id"},null,8,["options","value","label-field"])]),_:1},8,["label"]),t(p,{label:n(u)("brand"),path:"brand_id"},{default:o(()=>[t(K,{options:B.value,fitlerable:"",clearable:"",onKeydown:v,value:a.value.brand_id,"onUpdate:value":e[5]||(e[5]=i=>a.value.brand_id=i),"label-field":"title_"+n(N),"value-field":"id"},null,8,["options","value","label-field"])]),_:1},8,["label"]),t(Z,null,{default:o(()=>[t(p,{label:n(u)("price"),path:"price"},{default:o(()=>[t(h,{onKeydown:v,value:a.value.price,"onUpdate:value":e[6]||(e[6]=i=>a.value.price=i),parse:n(ae),format:n(te),step:1e3,clearable:""},null,8,["value","parse","format"])]),_:1},8,["label"]),t(p,{label:n(u)("unit"),path:"unit"},{default:o(()=>[t(K,{style:{width:"150px"},options:n(z).unitOption,fitlerable:"",onKeydown:v,value:a.value.unit,"onUpdate:value":e[7]||(e[7]=i=>a.value.unit=i),"label-field":"title_"+n(N),"value-field":"element"},null,8,["options","value","label-field"])]),_:1},8,["label"])]),_:1}),t(Z,null,{default:o(()=>[t(p,{label:n(u)("active"),path:"is_active"},{default:o(()=>[t(Q,{onKeydown:v,value:a.value.is_active,"onUpdate:value":e[8]||(e[8]=i=>a.value.is_active=i)},null,8,["value"])]),_:1},8,["label"]),t(p,{label:n(u)("top"),path:"top"},{default:o(()=>[t(Q,{onKeydown:v,value:a.value.top,"onUpdate:value":e[9]||(e[9]=i=>a.value.top=i)},null,8,["value"])]),_:1},8,["label"])]),_:1}),t(p,{label:n(u)("discount"),path:"discount"},{default:o(()=>[t(h,{onKeydown:v,value:a.value.discount,"onUpdate:value":e[10]||(e[10]=i=>a.value.discount=i),parse:n(ae),format:n(te),step:1e3,clearable:""},null,8,["value","parse","format"])]),_:1},8,["label"]),t(p),t(p,{label:n(u)("comment")+" UZB",path:"description_uz"},{default:o(()=>[t(_,{type:"textarea",onKeydown:v,value:a.value.description_uz,"onUpdate:value":e[11]||(e[11]=i=>a.value.description_uz=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:n(u)("comment")+" KOR",path:"description_ko"},{default:o(()=>[t(_,{type:"textarea",onKeydown:v,value:a.value.description_ko,"onUpdate:value":e[12]||(e[12]=i=>a.value.description_ko=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:n(u)("comment")+" RUS",path:"description_ru"},{default:o(()=>[t(_,{type:"textarea",onKeydown:v,value:a.value.description_ru,"onUpdate:value":e[13]||(e[13]=i=>a.value.description_ru=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:n(u)("comment")+" ENG",path:"description_en"},{default:o(()=>[t(_,{type:"textarea",onKeydown:v,value:a.value.description_en,"onUpdate:value":e[14]||(e[14]=i=>a.value.description_en=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])]),g("div",Ye,[g("div",Ge,[t(ce,{max:5,accept:"image/png, image/jpeg","directory-dnd":"","onUpdate:fileList":V,onRemove:D},{default:o(()=>[t(de,{accept:"image/png, image/jpeg"},{default:o(()=>[t(re,{class:"text-base"},{default:o(()=>[$(x(s.$t("upload_image")),1)]),_:1}),t(ue,{depth:"3",class:"mt-2"},{default:o(()=>[$(x(s.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})])]),g("div",He,[(I(!0),P(ge,null,be(a.value.photos,(i,_e)=>(I(),P("div",{key:_e,class:"flex gap-2"},[i.name?(I(),W(pe,{key:0,src:n(T)+i.name,width:"120",height:"80",class:"rounded"},null,8,["src"])):he("",!0),t(c,{type:"error"},{icon:o(()=>[t(l,{size:"30",color:"#fff"},{default:o(()=>[t(n(Pe),{onClick:Xe=>D(i)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1},8,["show"])]),_:1},8,["model"])}}},Je={class:"p-2 space-y-2 bg-white rounded-xl shadow-md overflow-x-auto"},Ze={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Qe={class:"text-xl font-bold"},We={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},mt={__name:"Index",setup(j){const{t:r,locale:z}=se(),{insert:T,shift:u,r:N}=Ce(),w=ke(),A=ye(),E=we(),S=oe(),C=J("fileUrl"),F=J("dayJS"),B=y([]),a=y(!1),R=y({text:""}),b=y({create:!1,update:!1,update_id:null}),f=e=>{a.value=!0,U.all(R.value).then(l=>{B.value=l,a.value=!1,e&&(b.value[e]=!1)})},O=xe(()=>[{title:"№",key:"id",align:"center",width:50,render:(e,l)=>l+1},{title:r("datetime"),key:"datetime",width:150,render(e){return F(e.datetime).format("YYYY-MM-DD HH:mm:ss")}},{title:r("category"),key:"name",render(e){var l,c,_;return d("div",{class:"flex items-center"},[(l=e.category)!=null&&l.image?d(G,{src:C+((c=e.category)==null?void 0:c.image),height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):d(H,{size:"small",style:{marginRight:"8px"}}),d("span",{class:"font-semibold"},(_=e.category)==null?void 0:_["title_"+z.value])])}},{title:r("brand"),key:"brand.title_"+z.value},{title:r("name"),key:"title_"+z.value,render(e){return console.log(e),d("div",{class:"flex items-center"},[e.image?d(G,{src:C+e.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):d(H,{size:"small",style:{marginRight:"8px"}}),d("span",{class:"font-semibold"},e["title_"+z.value])])}},{title:r("price"),align:"right",titleAlign:"left",render(e){return d("span",{class:"font-semibold"},le(e.price))}},{title:r("discount"),align:"right",titleAlign:"left",render(e){return d("span",{class:"font-semibold"},le(e.discount))}},{title:r("limit"),align:"right",titleAlign:"left",render(e){const l=e.limit<=0?"text-red-500":"text-green-500";return d("span",{class:`font-semibold ${l}`},""+e.limit)}},{title:r("active"),align:"center",titleAlign:"left",width:100,render(e){return d(X,{size:"small",value:e.is_active,onUpdateValue:l=>{let c={is_active:!e.is_active,top:e.top};U.updateTools(e.id,c).then(()=>f())}})}},{title:r("top"),align:"center",titleAlign:"left",width:100,render(e){return d(X,{size:"small",value:e.top,onUpdateValue:l=>{let c={is_active:e.is_active,top:!e.top};console.log(c),U.updateTools(e.id,c).then(()=>f())}})}},{title:r("admin_one"),key:"name",render(e){var l,c,_;return d("div",{class:"flex items-center"},[(l=e.user)!=null&&l.image?d(G,{src:C+((c=e.user)==null?void 0:c.image),height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):d(H,{size:"small",style:{marginRight:"8px"}}),d("span",{class:"font-semibold"},(_=e.user)==null?void 0:_.fullname)])}},{title:r("action"),key:"action",align:"center",fixed:"right",width:120,render(e){return[d(q,{size:"small",type:"success",onClick:l=>{b.value.update_id=e.id,b.value.update=!0},style:{marginRight:"8px"}},{icon:()=>d(M,{component:$e,size:22})}),d(q,{size:"small",type:"warning",onClick:()=>{A.warning({title:r("warning"),content:r("delete_row"),positiveText:r("yes"),negativeText:r("no"),onPositiveClick:()=>{U.delete(e.id).then(()=>f()).catch(l=>{S.errorPage=l.data,w.push({name:"error page"})})},onNegativeClick:()=>E.success(r("cancel"))})}},{icon:()=>d(M,{component:Ne,size:22})})]}}]),k=Ue({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:e=>k.page=e,onUpdatePageSize:e=>{k.pageSize=e,k.page=1}}),L=e=>({style:"cursor: pointer;"}),Y=()=>f(),v=()=>{R.value.text="",f()},V=()=>b.value.create=!0,D=e=>b.value[e]=!1,s=e=>f(e);return ze(T,e=>e&&V()),Se(()=>{u.value&&N.value&&f()}),ie(()=>f()),(e,l)=>{const c=m("n-input"),_=m("n-data-table"),p=m("n-card"),K=m("n-modal");return I(),P("div",Je,[g("div",Ze,[g("h2",Qe,x(n(r)("products")),1),g("div",We,[t(c,{value:R.value.text,"onUpdate:value":l[0]||(l[0]=h=>R.value.text=h),onInput:Y,placeholder:n(r)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:o(()=>[t(n(M),null,{default:o(()=>[t(n(Re))]),_:1})]),_:1},8,["value","placeholder"]),t(n(q),{type:"warning",onClick:v},{icon:o(()=>[t(n(M),null,{default:o(()=>[t(n(Ie))]),_:1})]),default:o(()=>[$(" "+x(n(r)("update"))+" ",1),l[7]||(l[7]=g("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),t(n(q),{type:"success",onClick:V},{icon:o(()=>[t(n(M),null,{default:o(()=>[t(n(Ke))]),_:1})]),default:o(()=>[$(" "+x(n(r)("add"))+" ",1),l[8]||(l[8]=g("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),t(_,{"row-props":L,pagination:k,loading:a.value,columns:O.value,data:B.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),t(K,{"transform-origin":"center",show:b.value.create,"onUpdate:show":l[3]||(l[3]=h=>b.value.create=h)},{default:o(()=>[t(p,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:o(()=>[t(ne,{onClose:l[1]||(l[1]=h=>D("create")),onCreate:l[2]||(l[2]=h=>s("create")),type:"create"})]),_:1})]),_:1},8,["show"]),t(K,{"transform-origin":"center",show:b.value.update,"onUpdate:show":l[6]||(l[6]=h=>b.value.update=h)},{default:o(()=>[t(p,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:o(()=>[t(ne,{type:"update",id:b.value.update_id,onClose:l[4]||(l[4]=h=>D("update")),onUpdate:l[5]||(l[5]=h=>s("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{mt as default};
