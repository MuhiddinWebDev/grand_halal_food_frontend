import{R as ae}from"./refresh-CQhCvjBv.js";import{D as le}from"./delete-BnMv029S.js";import{o as w}from"./order.service-CheXL7ad.js";import{c as ne}from"./clients.service-CrmP7mhz.js";import{c as M}from"./NumberFormat-BDrUmd0_.js";import{b as oe,H as ie,r as y,m as P,g as re,c as _,a as e,i as r,q as ce,v as s,s as t,k as b,T as R,j as c,L as A,o as u,G as d,N as F,R as B,S as q,p as G,U as ue}from"./index-GwBpnSVU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"space-y-2 p-2"},pe={class:"flex justify-between flex-wrap items-center gap-2"},me={class:"flex gap-2 items-center flex-wrap"},_e={class:"text-2xl font-bold"},he={class:"grid gap-2 grid-cols-[repeat(auto-fill,minmax(320px,1fr))] md:grid-cols-[repeat(auto-fill,minmax(620px,1fr))]"},ge={class:"flex justify-between items-center mb-2"},ve={class:"text-lg font-semibold text-gray-800"},fe={class:"text-sm space-y-1 text-gray-700"},ye=["href"],be=["href"],xe=["href"],we={class:"flex items-center gap-2"},ke={key:1,class:"text-gray-400 italic"},Ce={class:"flex items-center gap-3 mt-2"},Me={class:"text-sm"},Se={class:"mt-4 space-y-1"},Oe={class:"font-semibold text-base"},Ue={class:"min-w-full text-sm border border-gray-200 rounded overflow-hidden"},je={class:"bg-gray-100"},Ne={class:"p-2 text-left"},ze={class:"p-2 text-right"},Be={class:"p-2 text-right"},qe={class:"p-2 text-right"},De={class:"p-2 text-center"},Ie={class:"p-2"},$e={class:"p-2 text-right"},He={class:"p-2 text-right"},Te={class:"p-2 text-right"},Ve={class:"flex justify-end mt-4"},Ye={key:0,class:"flex flex-col items-center justify-center p-6 bg-gray-100 rounded-2xl border border-dashed border-gray-300 shadow-sm"},Le={class:"text-gray-600 text-lg font-medium"},Ke={__name:"Index",setup(Pe){const{t:a,locale:S}=oe(),O=ie(),U=y([]),j=y(!1),N=P("dayJS"),J=P("fileUrl"),x=y("waiting"),D=y([]),v=y([]),f=y({range:[N().subtract(6,"day").startOf("day").valueOf(),N().endOf("day").valueOf()],status:"waiting"}),p=async()=>{j.value=!0;try{U.value=await w.all(f.value)}finally{j.value=!1}},X=async()=>{try{const o=await ne.all();D.value=o.map(l=>{const h=l.fullname?l.fullname.trim():"",k=l.phone_number?l.phone_number.trim():"",C=l.mail?l.mail.trim():"",g=[];h&&g.push(h),k&&g.push(`📞 ${k}`),C&&g.push(`✉️ ${C}`);const z=g.length>0?g.join(" | "):"";return{...l,label:z}})}catch(o){console.error("Client fetch error:",o)}},E=async()=>{var o;try{v.value=await w.statusOption(),((o=v.value)==null?void 0:o.length)>0&&(x.value=v.value[0].value,I(x.value))}catch(l){console.error(l)}},K=async(o,l)=>{try{await w.updateStatus(o,{status:l}),O.success(a("updated status")),p()}catch{O.error("Xatolik yuz berdi")}},Q=async o=>{try{await w.updatePaid(o),p()}catch{O.error("Xatolik yuz berdi")}},I=o=>{let l=v.value.find(h=>h.value==o);f.value.status=l.value,x.value=o,p()},W=o=>{w.delete(o).then(l=>{console.log(l),p()})};return re(()=>{X(),p(),E()}),(o,l)=>{const h=b("n-date-picker"),k=b("n-image"),C=b("n-switch"),g=b("n-scrollbar"),z=b("n-tab-pane"),Z=b("n-tabs");return u(),_("div",de,[e("div",pe,[e("div",me,[e("h2",_e,s(t(a)("orders")),1),r(h,{style:{"min-width":"300px"},value:f.value.range,"onUpdate:value":[l[0]||(l[0]=m=>f.value.range=m),p],type:"daterange"},null,8,["value"]),e("div",null,[r(t(R),{options:D.value,value:f.value.client_id,"onUpdate:value":[l[1]||(l[1]=m=>f.value.client_id=m),p],placeholder:"Mijozni tanlang",filterable:"",clearable:"","label-field":"label","value-field":"id"},null,8,["options","value"])])]),r(t(A),{type:"warning",onClick:p},{icon:c(()=>[r(t(F),null,{default:c(()=>[r(t(ae))]),_:1})]),default:c(()=>[d(" "+s(t(a)("update")),1)]),_:1})]),r(Z,{type:"line",animated:"",value:x.value,"onUpdate:value":[l[2]||(l[2]=m=>x.value=m),I]},{default:c(()=>[(u(!0),_(B,null,q(v.value,(m,ee)=>(u(),G(z,{key:ee,name:m.value,tab:m["label_"+t(S)]},{default:c(()=>[e("div",he,[(u(!0),_(B,null,q(U.value,(n,te)=>{var $,H,T,V;return u(),_("div",{key:n.id,class:ue(["rounded-xl border-2 p-4 mb-6 transition-all duration-200 shadow-sm hover:shadow-md",n.paid?"border-green-400 bg-green-50":"border-red-300 bg-red-50 hover:bg-red-100"])},[e("div",ge,[e("h2",ve,s(t(a)("order"))+" #"+s(te+1)+" "+s((($=n.client)==null?void 0:$.first_name)||"")+" "+s(((H=n.client)==null?void 0:H.last_name)||""),1),r(t(R),{style:{"max-width":"200px"},value:n.status,"onUpdate:value":[i=>n.status=i,i=>K(n.id,i)],options:v.value,"label-field":"label_"+t(S),size:"small"},null,8,["value","onUpdate:value","options","label-field"])]),e("div",fe,[e("p",null,[e("strong",null,s(t(a)("datetime"))+":",1),d(" "+s(t(N)(n.datetime).format("YYYY-MM-DD HH:mm:ss")),1)]),e("p",null,[e("strong",null,s(t(a)("phone"))+":",1),e("a",{href:"tel:"+((T=n.client)==null?void 0:T.phone_number),class:"text-blue-500 underline"},s((V=n.client)==null?void 0:V.phone_number),9,ye)]),e("p",null,[e("strong",null,s(t(a)("additional phone number"))+":",1),e("a",{href:"tel:"+n.phone2,class:"text-blue-500 underline"},s(n.phone2),9,be)]),e("p",null,[e("strong",null,s(t(a)("address"))+":",1),d(" "+s(n.address),1)]),e("p",null,[e("strong",null,s(t(a)("location"))+":",1),e("a",{class:"text-blue-500 underline",href:`https://www.google.com/maps?q=${n.lat},${n.lon}`,target:"_blank"}," 📍 Google Map ",8,xe)]),e("p",null,[e("strong",null,s(t(a)("comment"))+":",1),d(" "+s(n.comment),1)]),e("p",null,[e("strong",null,s(t(a)("pay_type"))+":",1),d(" "+s(n.payment_type),1)]),e("p",null,[e("strong",null,s(t(a)("total"))+" "+s(t(a)("summa").toLowerCase())+":",1),d(" "+s(t(M)(n.total_price)),1)]),e("p",null,[e("strong",null,s(t(a)("delivery_summa"))+":",1),d(" "+s(t(M)(n.delivery_summa)),1)]),e("div",we,[e("strong",null,s(t(a)("payment image"))+":",1),n.payment_image?(u(),G(k,{key:0,width:"100",src:t(J)+n.payment_image},null,8,["src"])):(u(),_("span",ke,s(t(a)("image not found")),1))]),e("div",Ce,[e("strong",Me,s(t(a)("payment"))+":",1),r(C,{value:n.paid,"onUpdate:value":i=>Q(n.id)},{checked:c(()=>[d(s(t(a)("paid")),1)]),unchecked:c(()=>[d(s(t(a)("unpaid")),1)]),_:2},1032,["value","onUpdate:value"])])]),e("div",Se,[e("h3",Oe,s(t(a)("products"))+":",1),r(g,{style:{"max-height":"300px","max-width":"100%"}},{default:c(()=>[e("table",Ue,[e("thead",je,[e("tr",null,[l[3]||(l[3]=e("th",{class:"p-2 text-center w-10"},"№",-1)),e("th",Ne,s(t(a)("product")),1),e("th",ze,s(t(a)("quantity")),1),e("th",Be,s(t(a)("price")),1),e("th",qe,s(t(a)("total"))+" "+s(t(a)("summa")),1)])]),e("tbody",null,[(u(!0),_(B,null,q(n.products,(i,se)=>{var Y,L;return u(),_("tr",{key:i.id,class:"hover:bg-gray-50"},[e("td",De,s(se+1),1),e("td",Ie,s((Y=i.product)==null?void 0:Y["title_"+t(S)]),1),e("td",$e,s(i.quantity)+" "+s(t(a)((L=i.product)==null?void 0:L.unit)),1),e("td",He,s(t(M)(i.price)),1),e("td",Te,s(t(M)(i.price*i.quantity)),1)])}),128))])])]),_:2},1024)]),e("div",Ve,[r(t(A),{size:"small",type:"error",onClick:i=>W(n.id)},{icon:c(()=>[r(t(F),null,{default:c(()=>[r(t(le))]),_:1})]),default:c(()=>[d(" "+s(t(a)("delete")),1)]),_:2},1032,["onClick"])])],2)}),128))])]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),!j.value&&U.value.length===0?(u(),_("div",Ye,[l[4]||(l[4]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3h18M3 7h18M5 11h14M7 15h10M9 19h6"})],-1)),e("p",Le,s(t(a)("order not available")),1)])):ce("",!0)])}}};export{Ke as default};
