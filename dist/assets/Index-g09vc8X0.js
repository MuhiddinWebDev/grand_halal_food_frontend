import{d as Q,r as h,H as W,v as X,h as Y,j as Z,k as u,o as O,c as ee,l as t,m as l,a as c,t as g,p as i,G as $,n as ae,q as le,e as ne,g as oe,i as se,I as re,w as ie,C as ue,N as E,J as j,x as f,K as de,L as ce,M as pe}from"./index-cPQIZp5h.js";import{u as me}from"./index-4O8ra6re.js";import{A as fe}from"./add-MkuVr4Ss.js";import{R as ge}from"./refresh-HJby1V2m.js";import{P as ve}from"./pen-DnfYYN33.js";import{S as _e}from"./search-tnmrM_yG.js";import{D as he}from"./delete-WaA4XgRx.js";import{M as S}from"./users.service-6P_1uWIA.js";import{u as H}from"./upload.service-5CQchHv8.js";import{S as we,E as xe}from"./exit-GBDA2x5z.js";import{u as ye}from"./NumberFormat-N2x_sffK.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const be={class:"p-1"},ke={class:"space-y-6"},Ce={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},$e={class:"text-lg font-semibold"},Se={class:"flex flex-col sm:flex-row gap-2"},Ue=c("span",{class:"ml-1 text-xs"},"Enter",-1),Ie=c("span",{class:"ml-1 text-xs"},"Esc",-1),Re={class:"space-y-4"},ze={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},J={__name:"Form",props:["type","id"],emits:["create","update","close"],setup(G,{emit:s}){const{locale:D,t:U}=Q(),v=G,P=s,q=h(null),w=h(!1),A=W(),b=X("fileUrl"),L=Y(),r=h({phone:"998",image:"",fullname:"",status:!0,role:"Admin",password:"123456",lang:D}),I={phone:{required:!0,trigger:"blur",validator:(a,o)=>{if(o.length<12)return new Error(U("require_phone"))}},fullname:{required:!0,trigger:"blur",validator:(a,o)=>{if(!o)return new Error(U("require_fullname"))}},password:{required:!0,trigger:"blur",validator:(a,o)=>{if(o&&o.length<6)return new Error(U("require_password"))}}};Z(()=>{v.type==="update"&&S.getOne(v.id).then(a=>{r.value=a})});const B=async()=>{var a;try{await((a=q.value)==null?void 0:a.validate()),w.value=!0,(v.type==="create"?S.create(r.value):S.update(v.id,r.value)).then(_=>P(v.type,_)).catch(()=>w.value=!1)}catch{}},k=()=>P("close"),d=a=>a&&H.delFile(a),m=a=>{if(a.length>0){const o=new FormData;o.append("file",a[0].file),H.uploadFile(o).then(_=>{d(r.value.image),r.value.image=_.file})}},V=()=>{d(r.value.image),r.value.image=""},C=a=>{const o=!a||/^\d+$/.test(a);return o||A.warning("Iltimos raqam kiriting"),o},K=a=>a.key==="Enter"&&B();return(a,o)=>{const _=u("n-icon"),R=u("n-button"),F=u("n-text"),M=u("n-p"),e=u("n-upload-dragger"),n=u("n-upload"),z=u("n-image"),N=u("n-input"),x=u("n-form-item"),T=u("n-select"),p=u("n-spin"),te=u("n-form");return O(),ee("div",be,[t(te,{ref_key:"formRef",ref:q,model:r.value,rules:I},{default:l(()=>[t(p,{show:w.value},{default:l(()=>[c("div",ke,[c("div",Ce,[c("p",$e,g(a.$t("admin_one"))+" "+g(v.type==="create"?a.$t("add").toLowerCase():a.$t("change").toLowerCase()),1),c("div",Se,[t(R,{onClick:B,type:"success",disabled:w.value,class:"min-w-[120px]"},{icon:l(()=>[t(_,null,{default:l(()=>[t(i(we))]),_:1})]),default:l(()=>[$(" "+g(a.$t("save"))+" ",1),Ue]),_:1},8,["disabled"]),t(R,{onClick:k,type:"warning",class:"min-w-[120px]"},{icon:l(()=>[t(_,null,{default:l(()=>[t(i(xe))]),_:1})]),default:l(()=>[$(" "+g(a.$t("exit"))+" ",1),Ie]),_:1})])]),c("div",Re,[t(n,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":m,onRemove:V},{default:l(()=>[t(e,null,{default:l(()=>[t(F,{class:"text-base"},{default:l(()=>[$(g(a.$t("upload_image")),1)]),_:1}),t(M,{class:"text-sm mt-2"},{default:l(()=>[$(g(a.$t("drop_image")),1)]),_:1})]),_:1})]),_:1}),r.value.image?(O(),ae(z,{key:0,src:i(b)+r.value.image,width:"120",height:"120",class:"rounded"},null,8,["src"])):le("",!0)]),c("div",ze,[t(x,{label:a.$t("fullname"),path:"fullname"},{default:l(()=>[t(N,{value:r.value.fullname,"onUpdate:value":o[0]||(o[0]=y=>r.value.fullname=y),maxlength:"50","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(x,{label:a.$t("phone"),path:"phone"},{default:l(()=>[t(N,{onKeydown:K,"allow-input":C,value:r.value.phone,"onUpdate:value":o[1]||(o[1]=y=>r.value.phone=y),maxlength:"12",minlength:"12","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(x,{label:a.$t("password"),path:"password"},{default:l(()=>[t(N,{type:"password","show-password-on":"mousedown",value:r.value.password,"onUpdate:value":o[2]||(o[2]=y=>r.value.password=y),minlength:"3","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(x,{label:a.$t("role"),path:"role"},{default:l(()=>[t(T,{options:i(L).roleOption,"value-field":"key","label-field":"name_"+i(D),value:r.value.role,"onUpdate:value":o[3]||(o[3]=y=>r.value.role=y),filterable:""},null,8,["options","label-field","value"])]),_:1},8,["label"])])])]),_:1},8,["show"])]),_:1},8,["model"])])}}},Ne={class:"p-2 space-y-2"},Ee={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},De={class:"text-xl font-bold"},Pe={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},qe=c("span",{class:"ml-1 text-xs"},"Shift+R",-1),Ae=c("span",{class:"ml-1 text-xs"},"Insert",-1),Qe={__name:"Index",setup(G){const{t:s,locale:D}=Q(),{insert:U,shift:v,r:P}=me(),q=ne(),w=oe(),A=W(),b=Y(),L=X("fileUrl"),r=h([]),I=h(!1),B=h(!1),k=h({text:""}),d=h({create:!1,update:!1,update_id:null}),m=e=>{I.value=!0,S.all(k.value).then(n=>{r.value=n,I.value=!1,e&&(d.value[e]=!1)})},V=se(()=>[{title:"â„–",key:"id",align:"center",width:50,render:(e,n)=>n+1},{title:s("fullname"),key:"fullname",render(e){return f("div",{class:"flex items-center"},[e.image?f(de,{src:L+e.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):f(ce,{size:"small",style:{marginRight:"8px"}}),f("span",{class:"font-semibold"},e.fullname)])}},{title:s("phone"),key:"phone",render:e=>ye(e.phone)},{title:s("role"),key:"role",render:e=>{var n;return(n=b.roleOption.find(z=>z.key===e.role))==null?void 0:n[`name_${D.value}`]}},{title:s("active"),key:"status",align:"center",width:100,render(e){return f(pe,{value:e.status,loading:B.value,round:!0,onUpdateValue:()=>{w.warning({title:s("warning"),content:s("change_active"),positiveText:s("yes"),negativeText:s("no"),onPositiveClick:()=>{e.status=!e.status,S.updateStatus(e.id,e).then(()=>m())},onNegativeClick:()=>A.success(s("cancel"))})}})}},{title:s("action"),key:"action",align:"center",width:120,render(e){return[f(j,{size:"small",type:"success",disabled:!b.allowRole.update,onClick:n=>{d.value.update_id=e.id,d.value.update=!0},style:{marginRight:"8px"}},{icon:()=>f(E,{component:ve,size:22})}),f(j,{size:"small",type:"warning",disabled:!b.allowRole.delete,onClick:()=>{w.warning({title:s("warning"),content:s("delete_row"),positiveText:s("yes"),negativeText:s("no"),onPositiveClick:()=>{S.delete(e.id).then(()=>m()).catch(n=>{b.errorPage=n.data,q.push({name:"error page"})})},onNegativeClick:()=>A.success(s("cancel"))})}},{icon:()=>f(E,{component:he,size:22})})]}}]),C=re({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:e=>C.page=e,onUpdatePageSize:e=>{C.pageSize=e,C.page=1}}),K=e=>({style:"cursor: pointer;"}),a=e=>e.status?"":"bg-red-50",o=()=>m(),_=()=>{k.value.text="",m()},R=()=>d.value.create=!0,F=e=>d.value[e]=!1,M=e=>m(e);return ie(U,e=>e&&R()),ue(()=>{v.value&&P.value&&m()}),Z(()=>m()),(e,n)=>{const z=u("n-input"),N=u("n-data-table"),x=u("n-card"),T=u("n-modal");return O(),ee("div",Ne,[c("div",Ee,[c("h2",De,g(i(s)("admin")),1),c("div",Pe,[t(z,{value:k.value.text,"onUpdate:value":n[0]||(n[0]=p=>k.value.text=p),onInput:o,placeholder:i(s)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:l(()=>[t(i(E),null,{default:l(()=>[t(i(_e))]),_:1})]),_:1},8,["value","placeholder"]),t(i(j),{type:"warning",onClick:_},{icon:l(()=>[t(i(E),null,{default:l(()=>[t(i(ge))]),_:1})]),default:l(()=>[$(" "+g(i(s)("update"))+" ",1),qe]),_:1}),t(i(j),{type:"success",onClick:R},{icon:l(()=>[t(i(E),null,{default:l(()=>[t(i(fe))]),_:1})]),default:l(()=>[$(" "+g(i(s)("add"))+" ",1),Ae]),_:1})])]),t(N,{"row-props":K,pagination:C,loading:I.value,columns:V.value,data:r.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)","row-class-name":a},null,8,["pagination","loading","columns","data"]),t(T,{"transform-origin":"center",show:d.value.create,"onUpdate:show":n[3]||(n[3]=p=>d.value.create=p)},{default:l(()=>[t(x,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:l(()=>[t(J,{onClose:n[1]||(n[1]=p=>F("create")),onCreate:n[2]||(n[2]=p=>M("create")),type:"create"})]),_:1})]),_:1},8,["show"]),t(T,{"transform-origin":"center",show:d.value.update,"onUpdate:show":n[6]||(n[6]=p=>d.value.update=p)},{default:l(()=>[t(x,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:l(()=>[t(J,{type:"update",id:d.value.update_id,onClose:n[4]||(n[4]=p=>F("update")),onUpdate:n[5]||(n[5]=p=>M("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Qe as default};
