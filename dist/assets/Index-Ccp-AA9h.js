import{d as Z,r as w,n as J,h as Y,l as u,q as T,o as G,k as t,j as e,a as c,x as v,t as s,G as R,s as Q,e as W,H as X,f as ee,g as te,m as y,I as ae,J as le,L as A,N as E,p as oe,M as ne,w as se,C as ie,c as re}from"./index-mXaGZWKH.js";import{u as ue,S as ce}from"./index-Bmx6EFcZ.js";import{A as de}from"./add-Kh_RL34q.js";import{R as pe}from"./refresh-DIHAZP8H.js";import{P as me}from"./pen-havnqXHC.js";import{D as _e}from"./delete-Bpd1-14p.js";import{c as $}from"./category.service-D_7Su30w.js";import{u as O}from"./upload.service-Dvp1cceP.js";import{S as fe,E as ge}from"./exit-CdLCex98.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},we={class:"text-xl font-semibold"},xe={class:"flex gap-2"},ye={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2"},he={class:"md:col-span-2"},be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},H={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(L,{emit:r}){const{t:p}=Z(),f=L,I=r,B=w(null),C=w(!1),D=w(null),M=J("fileUrl"),i=w({title_uz:"",title_ru:"",title_ko:"",title_en:"",image:""}),h=o=>({required:!0,trigger:"blur",validator:(l,_)=>{if(!_)return new Error(p(o==="image"?"require_image":"require_name"))}}),F={title_uz:h("title_uz"),title_ko:h("title_ko"),title_ru:h("title_ru"),title_en:h("title_en"),image:h("image")};Y(async()=>{if(f.type==="update"&&f.id)try{const o=await $.getOne(f.id);i.value=o}catch(o){console.error("Ma'lumot yuklashda xatolik:",o)}setTimeout(()=>{var o;(o=D.value)==null||o.focus()},100)});const S=async()=>{var o;try{if(await((o=B.value)==null?void 0:o.validate()),C.value=!0,f.type==="create"){const l=await $.create(i.value);I("create",l)}else if(f.type==="update"){const l=await $.update(f.id,i.value);I("update",l)}}catch(l){console.warn("Form not valid or failed",l)}finally{C.value=!1}},U=()=>I("close"),d=async o=>{if(o)try{await O.delFile(o)}catch(l){console.warn("Faylni o‘chirishda xatolik:",l)}},x=async o=>{if(o.length>0){const l=new FormData;l.append("file",o[0].file);try{const _=await O.uploadFile(l);await d(i.value.image),i.value.image=_.file}catch(_){console.error("Yuklashda xatolik:",_)}}},V=()=>{d(i.value.image),i.value.image=""},g=o=>{o.code==="Enter"&&S()};return(o,l)=>{const _=u("n-icon"),N=u("n-button"),K=u("n-text"),P=u("n-p"),n=u("n-upload-dragger"),a=u("n-upload"),q=u("n-image"),z=u("n-input"),b=u("n-form-item"),j=u("n-spin"),m=u("n-form");return G(),T(m,{ref_key:"formRef",ref:B,model:i.value,rules:F},{default:t(()=>[e(j,{show:C.value},{default:t(()=>[c("div",ve,[c("p",we,v(s(p)("category"))+" "+v(f.type=="create"?s(p)("add").toLowerCase():s(p)("change").toLowerCase()),1),c("div",xe,[e(N,{onClick:S,type:"success",disabled:C.value,class:"min-w-[120px]"},{icon:t(()=>[e(_,null,{default:t(()=>[e(s(fe))]),_:1})]),default:t(()=>[R(" "+v(s(p)("save"))+" ",1),l[4]||(l[4]=c("span",{class:"text-xs ml-1"},"Enter",-1))]),_:1,__:[4]},8,["disabled"]),e(N,{onClick:U,type:"warning",class:"min-w-[120px]"},{icon:t(()=>[e(_,null,{default:t(()=>[e(s(ge))]),_:1})]),default:t(()=>[R(" "+v(s(p)("exit"))+" ",1),l[5]||(l[5]=c("span",{class:"text-xs ml-1"},"Esc",-1))]),_:1,__:[5]})])]),c("div",ye,[c("div",he,[e(a,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":x,onRemove:V},{default:t(()=>[e(n,{accept:"image/png, image/jpeg"},{default:t(()=>[e(K,{class:"text-base"},{default:t(()=>[R(v(o.$t("upload_image")),1)]),_:1}),e(P,{depth:"3",class:"mt-2"},{default:t(()=>[R(v(o.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})]),c("div",null,[i.value.image?(G(),T(q,{key:0,src:s(M)+i.value.image,width:"120",height:"80",class:"rounded"},null,8,["src"])):Q("",!0)])]),c("div",be,[e(b,{label:s(p)("title")+" UZB",path:"title_uz"},{default:t(()=>[e(z,{ref_key:"inputInstRef",ref:D,onKeydown:g,value:i.value.title_uz,"onUpdate:value":l[0]||(l[0]=k=>i.value.title_uz=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:s(p)("title")+" KOR",path:"title_ko"},{default:t(()=>[e(z,{onKeydown:g,value:i.value.title_ko,"onUpdate:value":l[1]||(l[1]=k=>i.value.title_ko=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:s(p)("title")+" RUS",path:"title_ru"},{default:t(()=>[e(z,{onKeydown:g,value:i.value.title_ru,"onUpdate:value":l[2]||(l[2]=k=>i.value.title_ru=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:s(p)("title")+" ENG",path:"title_en"},{default:t(()=>[e(z,{onKeydown:g,value:i.value.title_en,"onUpdate:value":l[3]||(l[3]=k=>i.value.title_en=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])])]),_:1},8,["show"])]),_:1},8,["model"])}}},ke={class:"p-4 space-y-4 bg-white rounded-xl shadow-md overflow-x-auto"},Ce={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Se={class:"text-xl font-bold"},Ue={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Pe={__name:"Index",setup(L){const{t:r,locale:p}=Z(),{insert:f,shift:I,r:B}=ue(),C=oe(),D=W(),M=X(),i=ee(),h=J("fileUrl"),F=w([]),S=w(!1);w(!1);const U=w({text:""}),d=w({create:!1,update:!1,update_id:null}),x=n=>{S.value=!0,$.all(U.value).then(a=>{F.value=a,S.value=!1,n&&(d.value[n]=!1)})},V=te(()=>[{title:"№",key:"id",align:"center",width:50,render:(n,a)=>a+1},{title:r("title")+" UZB",key:"title",render(n){return y("div",{class:"flex items-center"},[n.image?y(ae,{src:h+n.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):y(le,{size:"small",style:{marginRight:"8px"}}),y("span",{class:"font-semibold"},n.title_uz)])}},{title:r("title")+" KOR",key:"title_ko"},{title:r("title")+" RUS",key:"title_ru"},{title:r("title")+" ENG",key:"title_en"},{title:r("action"),key:"action",align:"center",fixed:"right",width:120,render(n){return[y(A,{size:"small",type:"success",onClick:a=>{d.value.update_id=n.id,d.value.update=!0},style:{marginRight:"8px"}},{icon:()=>y(E,{component:me,size:22})}),y(A,{size:"small",type:"warning",onClick:()=>{D.warning({title:r("warning"),content:r("delete_row"),positiveText:r("yes"),negativeText:r("no"),onPositiveClick:()=>{$.delete(n.id).then(()=>x()).catch(a=>{i.errorPage=a.data,C.push({name:"error page"})})},onNegativeClick:()=>M.success(r("cancel"))})}},{icon:()=>y(E,{component:_e,size:22})})]}}]),g=ne({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:n=>g.page=n,onUpdatePageSize:n=>{g.pageSize=n,g.page=1}}),o=n=>({style:"cursor: pointer;"}),l=()=>x(),_=()=>{U.value.text="",x()},N=()=>d.value.create=!0,K=n=>d.value[n]=!1,P=n=>x(n);return se(f,n=>n&&N()),ie(()=>{I.value&&B.value&&x()}),Y(()=>x()),(n,a)=>{const q=u("n-input"),z=u("n-data-table"),b=u("n-card"),j=u("n-modal");return G(),re("div",ke,[c("div",Ce,[c("h2",Se,v(s(r)("category")),1),c("div",Ue,[e(q,{value:U.value.text,"onUpdate:value":a[0]||(a[0]=m=>U.value.text=m),onInput:l,placeholder:s(r)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:t(()=>[e(s(E),null,{default:t(()=>[e(s(ce))]),_:1})]),_:1},8,["value","placeholder"]),e(s(A),{type:"warning",onClick:_},{icon:t(()=>[e(s(E),null,{default:t(()=>[e(s(pe))]),_:1})]),default:t(()=>[R(" "+v(s(r)("update"))+" ",1),a[7]||(a[7]=c("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),e(s(A),{type:"success",onClick:N},{icon:t(()=>[e(s(E),null,{default:t(()=>[e(s(de))]),_:1})]),default:t(()=>[R(" "+v(s(r)("add"))+" ",1),a[8]||(a[8]=c("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),e(z,{"row-props":o,pagination:g,loading:S.value,columns:V.value,data:F.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e(j,{"transform-origin":"center",show:d.value.create,"onUpdate:show":a[3]||(a[3]=m=>d.value.create=m)},{default:t(()=>[e(b,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:t(()=>[e(H,{onClose:a[1]||(a[1]=m=>K("create")),onCreate:a[2]||(a[2]=m=>P("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e(j,{"transform-origin":"center",show:d.value.update,"onUpdate:show":a[6]||(a[6]=m=>d.value.update=m)},{default:t(()=>[e(b,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:t(()=>[e(H,{type:"update",id:d.value.update_id,onClose:a[4]||(a[4]=m=>K("update")),onUpdate:a[5]||(a[5]=m=>P("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Pe as default};
