import{c as P,o as R,b as fe,f as oe,n as G,d as se,r as h,h as ie,l as c,q as Z,k as n,j as t,a as g,x,t as l,G as K,Q as ge,R as be,s as ye,e as he,H as we,g as xe,m as _,I as Q,J as W,K as X,L as q,N as M,p as ke,M as Ue,w as Se,C as ze}from"./index-BWBAs6zc.js";import{u as Ce,S as Re}from"./index-B4fZ0LMt.js";import{A as Ke}from"./add-CAzPqIR4.js";import{R as Ie}from"./refresh-D81EacrB.js";import{P as Ne}from"./pen-vbqtZnW-.js";import{D as $e}from"./delete-C5917DAC.js";import{p as U}from"./product.service-D1_KSO5i.js";import{c as Be}from"./category.service-DDUKffBI.js";import{b as Ae}from"./brand.service-OxTmq8rV.js";import{u as ee}from"./upload.service-BljpxHJv.js";import{S as De,E as Me}from"./exit-BPRoqyYy.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as te,b as ae,c as le}from"./NumberFormat-Dorb8or7.js";const Fe={},Ve={class:"main-icons"};function qe(j,r){return R(),P("div",Ve,r[0]||(r[0]=[fe('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-12"></path><path d="M9 7V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3"></path></g></svg>',1)]))}const Pe=Ee(Fe,[["render",qe]]),je={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},Te={class:"text-xl font-semibold"},Oe={class:"flex gap-2"},Le={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},Ye={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-2"},Ge={class:"md:col-span-2"},He={class:"grid grid-cols-1 md:grid-cols-6 gap-2 mt-2"},ne={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(j,{emit:r}){const I=oe(),T=G("fileUrl"),{t:u,locale:N}=se(),w=j,$=r,E=h(null),S=h(!1),B=h(null),F=h([]),A=h([]),a=h({title_uz:"",title_ru:"",title_ko:"",title_en:"",category_id:null,brand_id:null,unit:"piece",price:0,discount:0,description_uz:"",description_ru:"",description_ko:"",description_en:"",is_active:!0,top:!1,photos:[]}),z=()=>{Be.all().then(s=>{F.value=s})},b=()=>{Ae.getBrandsByCategory(a.value.category_id).then(s=>{A.value=s})},f=s=>({required:!0,trigger:"blur",validator:(e,o)=>{if(!o)return new Error(u(s))}}),O={title_uz:f("input require"),title_ko:f("input require"),title_ru:f("input require"),title_en:f("input require"),category_id:f("choose require"),brand_id:f("choose require")};ie(async()=>{if(z(),w.type==="update"&&w.id)try{const s=await U.getOne(w.id);a.value=s,s.photos||(a.value.photos=[]),b()}catch(s){console.error("Ma'lumot yuklashda xatolik:",s)}setTimeout(()=>{var s;(s=B.value)==null||s.focus()},100)});const k=async()=>{var s;try{if(await((s=E.value)==null?void 0:s.validate()),S.value=!0,w.type==="create"){const e=await U.create(a.value);$("create",e)}else if(w.type==="update"){a.value.photos||(a.value.photos=[]);const e=await U.update(w.id,a.value);$("update",e)}}catch(e){console.warn("Form not valid or failed",e)}finally{S.value=!1}},L=()=>$("close"),Y=s=>{s&&(a.value.brand_id=null,a.value.category_id=s,b())},m=s=>{s.code==="Enter"&&k()},V=async s=>{if(s&&s.length>0){const e=s[s.length-1];if(e&&e.file){const o=new FormData;o.append("file",e.file);try{const d=await ee.uploadFile(o);a.value.photos.push({name:d.file})}catch(d){console.error("Yuklashda xatolik:",d)}}}},D=async s=>{try{await ee.delFile(s.name),a.value.photos=a.value.photos.filter(e=>e.name!==s.name)}catch(e){console.warn("Faylni o‘chirishda xatolik:",e)}};return(s,e)=>{const o=c("n-icon"),d=c("n-button"),v=c("n-input"),p=c("n-form-item"),C=c("n-select"),y=c("n-input-number"),H=c("n-space"),J=c("n-switch"),re=c("n-text"),ue=c("n-p"),de=c("n-upload-dragger"),pe=c("n-upload"),ce=c("n-image"),me=c("n-spin"),ve=c("n-form");return R(),Z(ve,{ref_key:"formRef",ref:E,model:a.value,rules:O},{default:n(()=>[t(me,{show:S.value},{default:n(()=>[g("div",je,[g("p",Te,x(l(u)("product"))+" "+x(w.type=="create"?l(u)("add").toLowerCase():l(u)("change").toLowerCase()),1),g("div",Oe,[t(d,{onClick:k,type:"success",disabled:S.value,class:"min-w-[120px]"},{icon:n(()=>[t(o,null,{default:n(()=>[t(l(De))]),_:1})]),default:n(()=>[K(" "+x(l(u)("save"))+" ",1),e[15]||(e[15]=g("span",{class:"text-xs ml-1"},"Enter",-1))]),_:1,__:[15]},8,["disabled"]),t(d,{onClick:L,type:"warning",class:"min-w-[120px]"},{icon:n(()=>[t(o,null,{default:n(()=>[t(l(Me))]),_:1})]),default:n(()=>[K(" "+x(l(u)("exit"))+" ",1),e[16]||(e[16]=g("span",{class:"text-xs ml-1"},"Esc",-1))]),_:1,__:[16]})])]),g("div",Le,[t(p,{label:l(u)("name")+" UZB",path:"title_uz"},{default:n(()=>[t(v,{ref_key:"inputInstRef",ref:B,onKeydown:m,value:a.value.title_uz,"onUpdate:value":e[0]||(e[0]=i=>a.value.title_uz=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:l(u)("name")+" KOR",path:"title_ko"},{default:n(()=>[t(v,{onKeydown:m,value:a.value.title_ko,"onUpdate:value":e[1]||(e[1]=i=>a.value.title_ko=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:l(u)("name")+" RUS",path:"title_ru"},{default:n(()=>[t(v,{onKeydown:m,value:a.value.title_ru,"onUpdate:value":e[2]||(e[2]=i=>a.value.title_ru=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:l(u)("name")+" ENG",path:"title_en"},{default:n(()=>[t(v,{onKeydown:m,value:a.value.title_en,"onUpdate:value":e[3]||(e[3]=i=>a.value.title_en=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:l(u)("category"),path:"category_id"},{default:n(()=>[t(C,{options:F.value,fitlerable:"",clearable:"",onKeydown:m,value:a.value.category_id,"onUpdate:value":[e[4]||(e[4]=i=>a.value.category_id=i),Y],"label-field":"title_"+l(N),"value-field":"id"},null,8,["options","value","label-field"])]),_:1},8,["label"]),t(p,{label:l(u)("brand"),path:"brand_id"},{default:n(()=>[t(C,{options:A.value,fitlerable:"",clearable:"",onKeydown:m,value:a.value.brand_id,"onUpdate:value":e[5]||(e[5]=i=>a.value.brand_id=i),"label-field":"title_"+l(N),"value-field":"id"},null,8,["options","value","label-field"])]),_:1},8,["label"]),t(H,null,{default:n(()=>[t(p,{label:l(u)("price"),path:"price"},{default:n(()=>[t(y,{onKeydown:m,value:a.value.price,"onUpdate:value":e[6]||(e[6]=i=>a.value.price=i),parse:l(ae),format:l(te),step:1e3,clearable:""},null,8,["value","parse","format"])]),_:1},8,["label"]),t(p,{label:l(u)("unit"),path:"unit"},{default:n(()=>[t(C,{style:{width:"150px"},options:l(I).unitOption,fitlerable:"",onKeydown:m,value:a.value.unit,"onUpdate:value":e[7]||(e[7]=i=>a.value.unit=i),"label-field":"title_"+l(N),"value-field":"element"},null,8,["options","value","label-field"])]),_:1},8,["label"])]),_:1}),t(H,null,{default:n(()=>[t(p,{label:l(u)("active"),path:"is_active"},{default:n(()=>[t(J,{onKeydown:m,value:a.value.is_active,"onUpdate:value":e[8]||(e[8]=i=>a.value.is_active=i)},null,8,["value"])]),_:1},8,["label"]),t(p,{label:l(u)("top"),path:"top"},{default:n(()=>[t(J,{onKeydown:m,value:a.value.top,"onUpdate:value":e[9]||(e[9]=i=>a.value.top=i)},null,8,["value"])]),_:1},8,["label"])]),_:1}),t(p,{label:l(u)("discount"),path:"discount"},{default:n(()=>[t(y,{onKeydown:m,value:a.value.discount,"onUpdate:value":e[10]||(e[10]=i=>a.value.discount=i),parse:l(ae),format:l(te),step:1e3,clearable:""},null,8,["value","parse","format"])]),_:1},8,["label"]),t(p),t(p,{label:l(u)("comment")+" UZB",path:"description_uz"},{default:n(()=>[t(v,{type:"textarea",onKeydown:m,value:a.value.description_uz,"onUpdate:value":e[11]||(e[11]=i=>a.value.description_uz=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:l(u)("comment")+" KOR",path:"description_ko"},{default:n(()=>[t(v,{type:"textarea",onKeydown:m,value:a.value.description_ko,"onUpdate:value":e[12]||(e[12]=i=>a.value.description_ko=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:l(u)("comment")+" RUS",path:"description_ru"},{default:n(()=>[t(v,{type:"textarea",onKeydown:m,value:a.value.description_ru,"onUpdate:value":e[13]||(e[13]=i=>a.value.description_ru=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(p,{label:l(u)("comment")+" ENG",path:"description_en"},{default:n(()=>[t(v,{type:"textarea",onKeydown:m,value:a.value.description_en,"onUpdate:value":e[14]||(e[14]=i=>a.value.description_en=i),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])]),g("div",Ye,[g("div",Ge,[t(pe,{max:5,accept:"image/png, image/jpeg","directory-dnd":"","onUpdate:fileList":V,onRemove:D},{default:n(()=>[t(de,{accept:"image/png, image/jpeg"},{default:n(()=>[t(re,{class:"text-base"},{default:n(()=>[K(x(s.$t("upload_image")),1)]),_:1}),t(ue,{depth:"3",class:"mt-2"},{default:n(()=>[K(x(s.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})])]),g("div",He,[(R(!0),P(ge,null,be(a.value.photos,(i,_e)=>(R(),P("div",{key:_e,class:"flex gap-2"},[i.name?(R(),Z(ce,{key:0,src:l(T)+i.name,width:"120",height:"80",class:"rounded"},null,8,["src"])):ye("",!0),t(d,{type:"error"},{icon:n(()=>[t(o,{size:"30",color:"#fff"},{default:n(()=>[t(l(Pe),{onClick:Xe=>D(i)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1},8,["show"])]),_:1},8,["model"])}}},Je={class:"p-2 space-y-2"},Ze={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Qe={class:"text-xl font-bold"},We={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},mt={__name:"Index",setup(j){const{t:r,locale:I}=se(),{insert:T,shift:u,r:N}=Ce(),w=ke(),$=he(),E=we(),S=oe(),B=G("fileUrl"),F=G("dayJS"),A=h([]),a=h(!1),z=h({text:""}),b=h({create:!1,update:!1,update_id:null}),f=e=>{a.value=!0,U.all(z.value).then(o=>{A.value=o,a.value=!1,e&&(b.value[e]=!1)})},O=xe(()=>[{title:"№",key:"id",align:"center",width:50,render:(e,o)=>o+1},{title:r("datetime"),key:"datetime",width:150,render(e){return F(e.datetime).format("YYYY-MM-DD HH:mm:ss")}},{title:r("category"),key:"name",render(e){var o,d,v;return _("div",{class:"flex items-center"},[(o=e.category)!=null&&o.image?_(Q,{src:B+((d=e.category)==null?void 0:d.image),height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):_(W,{size:"small",style:{marginRight:"8px"}}),_("span",{class:"font-semibold"},(v=e.category)==null?void 0:v["title_"+I.value])])}},{title:r("brand"),key:"brand.title_"+I.value},{title:r("name"),key:"title_"+I.value},{title:r("price"),align:"right",titleAlign:"left",render(e){return _("span",{class:"font-semibold"},le(e.price))}},{title:r("discount"),align:"right",titleAlign:"left",render(e){return _("span",{class:"font-semibold"},le(e.discount))}},{title:r("active"),align:"center",titleAlign:"left",width:100,render(e){return _(X,{size:"small",value:e.is_active,onUpdateValue:o=>{let d={is_active:!e.is_active,top:e.top};U.updateTools(e.id,d).then(()=>f())}})}},{title:r("top"),align:"center",titleAlign:"left",width:100,render(e){return _(X,{size:"small",value:e.top,onUpdateValue:o=>{let d={is_active:e.is_active,top:!e.top};console.log(d),U.updateTools(e.id,d).then(()=>f())}})}},{title:r("admin_one"),key:"name",render(e){var o,d,v;return _("div",{class:"flex items-center"},[(o=e.user)!=null&&o.image?_(Q,{src:B+((d=e.user)==null?void 0:d.image),height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):_(W,{size:"small",style:{marginRight:"8px"}}),_("span",{class:"font-semibold"},(v=e.user)==null?void 0:v.fullname)])}},{title:r("action"),key:"action",align:"center",fixed:"right",width:120,render(e){return[_(q,{size:"small",type:"success",onClick:o=>{b.value.update_id=e.id,b.value.update=!0},style:{marginRight:"8px"}},{icon:()=>_(M,{component:Ne,size:22})}),_(q,{size:"small",type:"warning",onClick:()=>{$.warning({title:r("warning"),content:r("delete_row"),positiveText:r("yes"),negativeText:r("no"),onPositiveClick:()=>{U.delete(e.id).then(()=>f()).catch(o=>{S.errorPage=o.data,w.push({name:"error page"})})},onNegativeClick:()=>E.success(r("cancel"))})}},{icon:()=>_(M,{component:$e,size:22})})]}}]),k=Ue({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:e=>k.page=e,onUpdatePageSize:e=>{k.pageSize=e,k.page=1}}),L=e=>({style:"cursor: pointer;"}),Y=()=>f(),m=()=>{z.value.text="",f()},V=()=>b.value.create=!0,D=e=>b.value[e]=!1,s=e=>f(e);return Se(T,e=>e&&V()),ze(()=>{u.value&&N.value&&f()}),ie(()=>f()),(e,o)=>{const d=c("n-input"),v=c("n-data-table"),p=c("n-card"),C=c("n-modal");return R(),P("div",Je,[g("div",Ze,[g("h2",Qe,x(l(r)("products")),1),g("div",We,[t(d,{value:z.value.text,"onUpdate:value":o[0]||(o[0]=y=>z.value.text=y),onInput:Y,placeholder:l(r)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:n(()=>[t(l(M),null,{default:n(()=>[t(l(Re))]),_:1})]),_:1},8,["value","placeholder"]),t(l(q),{type:"warning",onClick:m},{icon:n(()=>[t(l(M),null,{default:n(()=>[t(l(Ie))]),_:1})]),default:n(()=>[K(" "+x(l(r)("update"))+" ",1),o[7]||(o[7]=g("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),t(l(q),{type:"success",onClick:V},{icon:n(()=>[t(l(M),null,{default:n(()=>[t(l(Ke))]),_:1})]),default:n(()=>[K(" "+x(l(r)("add"))+" ",1),o[8]||(o[8]=g("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),t(v,{"row-props":L,pagination:k,loading:a.value,columns:O.value,data:A.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),t(C,{"transform-origin":"center",show:b.value.create,"onUpdate:show":o[3]||(o[3]=y=>b.value.create=y)},{default:n(()=>[t(p,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:n(()=>[t(ne,{onClose:o[1]||(o[1]=y=>D("create")),onCreate:o[2]||(o[2]=y=>s("create")),type:"create"})]),_:1})]),_:1},8,["show"]),t(C,{"transform-origin":"center",show:b.value.update,"onUpdate:show":o[6]||(o[6]=y=>b.value.update=y)},{default:n(()=>[t(p,{class:"w-full max-w-5xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:n(()=>[t(ne,{type:"update",id:b.value.update_id,onClose:o[4]||(o[4]=y=>D("update")),onUpdate:o[5]||(o[5]=y=>s("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{mt as default};
