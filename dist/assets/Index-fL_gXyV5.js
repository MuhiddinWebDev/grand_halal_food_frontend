import{b as O,r as w,m as H,g as Z,k as u,p as G,o as V,j as t,i as e,a as c,v,s,G as S,q as Q,d as W,H as X,e as ee,f as te,l as y,I as ae,J as le,L as K,N,M as oe,w as ne,B as se,c as ie,n as re}from"./index-Bw_DMt4G.js";import{u as ue}from"./index-DTDr-_NB.js";import{A as de}from"./add-c61_CCwb.js";import{R as ce}from"./refresh-CHlhbopm.js";import{P as pe}from"./pen-DW-uAHNt.js";import{S as me}from"./search-DnXDH0b6.js";import{D as _e}from"./delete-PqNj2_rx.js";import{C as E}from"./category.service-BjVz_wRW.js";import{u as L}from"./upload.service-CbWqIqM3.js";import{S as fe}from"./save-DP0lGshP.js";import{E as ge}from"./exit-fcB5Trvy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},we={class:"text-xl font-semibold"},xe={class:"flex gap-2"},ye={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2"},he={class:"md:col-span-2"},be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},T={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(q,{emit:r}){const{t:m}=O(),f=q,R=r,$=w(null),k=w(!1),B=w(null),j=H("fileUrl"),i=w({title_uz:"",title_ru:"",title_ko:"",title_en:"",image:""}),g=o=>({required:!0,trigger:"blur",validator:(a,_)=>{if(!_)return new Error(m(o==="image"?"require_image":"require_name"))}}),C={title_uz:g("title_uz"),title_ko:g("title_ko"),title_ru:g("title_ru"),title_en:g("title_en"),image:g("image")};Z(async()=>{if(f.type==="update"&&f.id)try{const o=await E.getOne(f.id);i.value=o}catch(o){console.error("Ma'lumot yuklashda xatolik:",o)}setTimeout(()=>{var o;(o=B.value)==null||o.focus()},100)});const p=async()=>{var o;try{if(await((o=$.value)==null?void 0:o.validate()),k.value=!0,f.type==="create"){const a=await E.create(i.value);R("create",a)}else if(f.type==="update"){const a=await E.update(f.id,i.value);R("update",a)}}catch(a){console.warn("Form not valid or failed",a)}finally{k.value=!1}},x=()=>R("close"),D=async o=>{if(o)try{await L.delFile(o)}catch(a){console.warn("Faylni o‘chirishda xatolik:",a)}},U=async o=>{if(o.length>0){const a=new FormData;a.append("file",o[0].file);try{const _=await L.uploadFile(a);await D(i.value.image),i.value.image=_.file}catch(_){console.error("Yuklashda xatolik:",_)}}},A=()=>{D(i.value.image),i.value.image=""},z=o=>{o.code==="Enter"&&p()};return(o,a)=>{const _=u("n-icon"),I=u("n-button"),n=u("n-text"),l=u("n-p"),P=u("n-upload-dragger"),M=u("n-upload"),F=u("n-image"),h=u("n-input"),d=u("n-form-item"),J=u("n-spin"),Y=u("n-form");return V(),G(Y,{ref_key:"formRef",ref:$,model:i.value,rules:C},{default:t(()=>[e(J,{show:k.value},{default:t(()=>[c("div",ve,[c("p",we,v(s(m)("category"))+" "+v(f.type=="create"?s(m)("add").toLowerCase():s(m)("change").toLowerCase()),1),c("div",xe,[e(I,{onClick:p,type:"success",disabled:k.value,class:"min-w-[120px]"},{icon:t(()=>[e(_,null,{default:t(()=>[e(s(fe))]),_:1})]),default:t(()=>[S(" "+v(s(m)("save"))+" ",1),a[4]||(a[4]=c("span",{class:"text-xs ml-1"},"Enter",-1))]),_:1,__:[4]},8,["disabled"]),e(I,{onClick:x,type:"warning",class:"min-w-[120px]"},{icon:t(()=>[e(_,null,{default:t(()=>[e(s(ge))]),_:1})]),default:t(()=>[S(" "+v(s(m)("exit"))+" ",1),a[5]||(a[5]=c("span",{class:"text-xs ml-1"},"Esc",-1))]),_:1,__:[5]})])]),c("div",ye,[c("div",he,[e(M,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":U,onRemove:A},{default:t(()=>[e(P,{accept:"image/png, image/jpeg"},{default:t(()=>[e(n,{class:"text-base"},{default:t(()=>[S(v(o.$t("upload_image")),1)]),_:1}),e(l,{depth:"3",class:"mt-2"},{default:t(()=>[S(v(o.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})]),c("div",null,[i.value.image?(V(),G(F,{key:0,src:s(j)+i.value.image,width:"120",height:"80",class:"rounded"},null,8,["src"])):Q("",!0)])]),c("div",be,[e(d,{label:s(m)("title")+" UZB",path:"title_uz"},{default:t(()=>[e(h,{ref_key:"inputInstRef",ref:B,onKeydown:z,value:i.value.title_uz,"onUpdate:value":a[0]||(a[0]=b=>i.value.title_uz=b),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(d,{label:s(m)("title")+" KOR",path:"title_ko"},{default:t(()=>[e(h,{onKeydown:z,value:i.value.title_ko,"onUpdate:value":a[1]||(a[1]=b=>i.value.title_ko=b),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(d,{label:s(m)("title")+" RUS",path:"title_ru"},{default:t(()=>[e(h,{onKeydown:z,value:i.value.title_ru,"onUpdate:value":a[2]||(a[2]=b=>i.value.title_ru=b),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(d,{label:s(m)("title")+" ENG",path:"title_en"},{default:t(()=>[e(h,{onKeydown:z,value:i.value.title_en,"onUpdate:value":a[3]||(a[3]=b=>i.value.title_en=b),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])])]),_:1},8,["show"])]),_:1},8,["model"])}}},ke={class:"p-2 space-y-2 bg-white rounded-xl shadow-md overflow-x-auto"},Ce={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ue={class:"text-xl font-bold"},ze={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Pe={__name:"Index",setup(q){const{t:r,locale:m}=O(),{insert:f,shift:R,r:$}=ue();re();const k=W(),B=X();ee();const j=H("fileUrl"),i=w([]),g=w(!1);w(!1);const C=w({text:""}),p=w({create:!1,update:!1,update_id:null}),x=n=>{g.value=!0,E.all(C.value).then(l=>{i.value=l,g.value=!1,n&&(p.value[n]=!1)})},D=te(()=>[{title:"№",key:"id",align:"center",width:50,render:(n,l)=>l+1},{title:r("title")+" UZB",key:"title",render(n){return y("div",{class:"flex items-center"},[n.image?y(ae,{src:j+n.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):y(le,{size:"small",style:{marginRight:"8px"}}),y("span",{class:"font-semibold"},n.title_uz)])}},{title:r("title")+" KOR",key:"title_ko"},{title:r("title")+" RUS",key:"title_ru"},{title:r("title")+" ENG",key:"title_en"},{title:r("action"),key:"action",align:"center",fixed:"right",width:120,render(n){return[y(K,{size:"small",type:"success",onClick:l=>{p.value.update_id=n.id,p.value.update=!0},style:{marginRight:"8px"}},{icon:()=>y(N,{component:pe,size:22})}),y(K,{size:"small",type:"warning",onClick:()=>{k.warning({title:r("warning"),content:r("delete_row"),positiveText:r("yes"),negativeText:r("no"),onPositiveClick:()=>{E.delete(n.id).then(()=>x())},onNegativeClick:()=>B.success(r("cancel"))})}},{icon:()=>y(N,{component:_e,size:22})})]}}]),U=oe({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:n=>U.page=n,onUpdatePageSize:n=>{U.pageSize=n,U.page=1}}),A=n=>({style:"cursor: pointer;"}),z=()=>x(),o=()=>{C.value.text="",x()},a=()=>p.value.create=!0,_=n=>p.value[n]=!1,I=n=>x(n);return ne(f,n=>n&&a()),se(()=>{R.value&&$.value&&x()}),Z(()=>x()),(n,l)=>{const P=u("n-input"),M=u("n-data-table"),F=u("n-card"),h=u("n-modal");return V(),ie("div",ke,[c("div",Ce,[c("h2",Ue,v(s(r)("category")),1),c("div",ze,[e(P,{value:C.value.text,"onUpdate:value":l[0]||(l[0]=d=>C.value.text=d),onInput:z,placeholder:s(r)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:t(()=>[e(s(N),null,{default:t(()=>[e(s(me))]),_:1})]),_:1},8,["value","placeholder"]),e(s(K),{type:"warning",onClick:o},{icon:t(()=>[e(s(N),null,{default:t(()=>[e(s(ce))]),_:1})]),default:t(()=>[S(" "+v(s(r)("update"))+" ",1),l[7]||(l[7]=c("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),e(s(K),{type:"success",onClick:a},{icon:t(()=>[e(s(N),null,{default:t(()=>[e(s(de))]),_:1})]),default:t(()=>[S(" "+v(s(r)("add"))+" ",1),l[8]||(l[8]=c("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),e(M,{"row-props":A,pagination:U,loading:g.value,columns:D.value,data:i.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e(h,{"transform-origin":"center",show:p.value.create,"onUpdate:show":l[3]||(l[3]=d=>p.value.create=d)},{default:t(()=>[e(F,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:t(()=>[e(T,{onClose:l[1]||(l[1]=d=>_("create")),onCreate:l[2]||(l[2]=d=>I("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e(h,{"transform-origin":"center",show:p.value.update,"onUpdate:show":l[6]||(l[6]=d=>p.value.update=d)},{default:t(()=>[e(F,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:t(()=>[e(T,{type:"update",id:p.value.update_id,onClose:l[4]||(l[4]=d=>_("update")),onUpdate:l[5]||(l[5]=d=>I("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Pe as default};
