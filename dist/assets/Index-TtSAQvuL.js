import{v as N,u as Y,r as h,q as Q,h as W,i as u,o as L,l as H,k as a,j as e,a as d,t as v,m as o,F as I,n as X,b as ee,e as te,G as ae,f as le,g as ne,H as oe,w as se,B as ie,c as re,N as E,I as O,s as w,J as ce,K as ue}from"./index-akkEPHo5.js";import{u as de,S as pe}from"./index-O6cQfjmS.js";import{S as me,E as _e,u as Z,A as ge,P as fe,D as ve}from"./upload.service-0IM-_ChD.js";import{R as he}from"./refresh-Y4iRoJLo.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const B="/categories";class xe{all(t){let r=t!=null&&t.text?"?text="+t.text:"";return N.get(B+"/all"+r).then(p=>p)}create(t){return N.post(B+"/create",t).then(r=>r)}update(t,r){return N.patch(B+`/update/${t}`,r).then(p=>p)}getOne(t){return N.get(B+`/getById/${t}`).then(r=>r)}delete(t){return N.delete(B+`/delete/${t}`).then(r=>r)}}const D=new xe,we={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},ye={class:"text-xl font-semibold"},be={class:"flex gap-2"},ke=d("span",{class:"text-xs ml-1"},"Enter",-1),Se=d("span",{class:"text-xs ml-1"},"Esc",-1),Ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2"},ze={class:"md:col-span-2"},Ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},J={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(T,{emit:t}){const{t:r}=Y(),p=T,R=t,F=h(null),S=h(!1),K=h(null),V=Q("fileUrl"),c=h({title_uz:"",title_ru:"",title_kr:"",title_en:"",image:""}),y=l=>({required:!0,trigger:"blur",validator:(i,g)=>{if(!g)return new Error(r(l==="image"?"require_image":"require_name"))}}),P={title_uz:y("title_uz"),title_kr:y("title_kr"),title_ru:y("title_ru"),title_en:y("title_en"),image:y("image")};W(async()=>{if(p.type==="update"&&p.id)try{const l=await D.getOne(p.id);c.value=l}catch(l){console.error("Ma'lumot yuklashda xatolik:",l)}setTimeout(()=>{var l;(l=K.value)==null||l.focus()},100)});const U=async()=>{var l;try{if(await((l=F.value)==null?void 0:l.validate()),S.value=!0,p.type==="create"){const i=await D.create(c.value);R("create",i)}else if(p.type==="update"){const i=await D.update(p.id,c.value);R("update",i)}}catch(i){console.warn("Form not valid or failed",i)}finally{S.value=!1}},z=()=>R("close"),m=async l=>{if(l)try{await Z.delFile(l)}catch(i){console.warn("Faylni o‘chirishda xatolik:",i)}},x=async l=>{if(l.length>0){const i=new FormData;i.append("file",l[0].file);try{const g=await Z.uploadFile(i);await m(c.value.image),c.value.image=g.file}catch(g){console.error("Yuklashda xatolik:",g)}}},q=()=>{m(c.value.image),c.value.image=""},f=l=>{l.code==="Enter"&&U()};return(l,i)=>{const g=u("n-icon"),$=u("n-button"),j=u("n-text"),A=u("n-p"),n=u("n-upload-dragger"),s=u("n-upload"),G=u("n-image"),C=u("n-input"),b=u("n-form-item"),M=u("n-spin"),_=u("n-form");return L(),H(_,{ref_key:"formRef",ref:F,model:c.value,rules:P},{default:a(()=>[e(M,{show:S.value},{default:a(()=>[d("div",we,[d("p",ye,v(o(r)("category"))+" "+v(p.type=="create"?o(r)("add").toLowerCase():o(r)("change").toLowerCase()),1),d("div",be,[e($,{onClick:U,type:"success",disabled:S.value,class:"min-w-[120px]"},{icon:a(()=>[e(g,null,{default:a(()=>[e(o(me))]),_:1})]),default:a(()=>[I(" "+v(o(r)("save"))+" ",1),ke]),_:1},8,["disabled"]),e($,{onClick:z,type:"warning",class:"min-w-[120px]"},{icon:a(()=>[e(g,null,{default:a(()=>[e(o(_e))]),_:1})]),default:a(()=>[I(" "+v(o(r)("exit"))+" ",1),Se]),_:1})])]),d("div",Ue,[d("div",ze,[e(s,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":x,onRemove:q},{default:a(()=>[e(n,{accept:"image/png, image/jpeg"},{default:a(()=>[e(j,{class:"text-base"},{default:a(()=>[I(v(l.$t("upload_image")),1)]),_:1}),e(A,{depth:"3",class:"mt-2"},{default:a(()=>[I(v(l.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})]),d("div",null,[c.value.image?(L(),H(G,{key:0,src:o(V)+c.value.image,width:"120",height:"80",class:"rounded"},null,8,["src"])):X("",!0)])]),d("div",Ce,[e(b,{label:o(r)("name")+" UZB",path:"title_uz"},{default:a(()=>[e(C,{ref_key:"inputInstRef",ref:K,onKeydown:f,value:c.value.title_uz,"onUpdate:value":i[0]||(i[0]=k=>c.value.title_uz=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:o(r)("name")+" KOR",path:"title_kr"},{default:a(()=>[e(C,{onKeydown:f,value:c.value.title_kr,"onUpdate:value":i[1]||(i[1]=k=>c.value.title_kr=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:o(r)("name")+" RUS",path:"title_ru"},{default:a(()=>[e(C,{onKeydown:f,value:c.value.title_ru,"onUpdate:value":i[2]||(i[2]=k=>c.value.title_ru=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:o(r)("name")+" ENG",path:"title_en"},{default:a(()=>[e(C,{onKeydown:f,value:c.value.title_en,"onUpdate:value":i[3]||(i[3]=k=>c.value.title_en=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])])]),_:1},8,["show"])]),_:1},8,["model"])}}},Ie={class:"p-4 space-y-4"},Re={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},$e={class:"text-xl font-bold"},Ne={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Ee=d("span",{class:"ml-1 text-xs"},"Shift+R",-1),Be=d("span",{class:"ml-1 text-xs"},"Insert",-1),Ae={__name:"Index",setup(T){const{t,locale:r}=Y(),{insert:p,shift:R,r:F}=de(),S=ee(),K=te(),V=ae(),c=le(),y=Q("fileUrl"),P=h([]),U=h(!1);h(!1);const z=h({text:""}),m=h({create:!1,update:!1,update_id:null}),x=n=>{U.value=!0,D.all(z.value).then(s=>{P.value=s,U.value=!1,n&&(m.value[n]=!1)})},q=ne(()=>[{title:"№",key:"id",align:"center",width:50,render:(n,s)=>s+1},{title:t("title")+" UZB",key:"title",render(n){return w("div",{class:"flex items-center"},[n.image?w(ce,{src:y+n.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):w(ue,{size:"small",style:{marginRight:"8px"}}),w("span",{class:"font-semibold"},n.title_uz)])}},{title:t("title")+" KOR",key:"title_kr"},{title:t("title")+" RUS",key:"title_ru"},{title:t("title")+" ENG",key:"title_en"},{title:t("action"),key:"action",align:"center",width:120,render(n){return[w(O,{size:"small",type:"success",onClick:s=>{m.value.update_id=n.id,m.value.update=!0},style:{marginRight:"8px"}},{icon:()=>w(E,{component:fe,size:22})}),w(O,{size:"small",type:"warning",onClick:()=>{K.warning({title:t("warning"),content:t("delete_row"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{D.delete(n.id).then(()=>x()).catch(s=>{c.errorPage=s.data,S.push({name:"error page"})})},onNegativeClick:()=>V.success(t("cancel"))})}},{icon:()=>w(E,{component:ve,size:22})})]}}]),f=oe({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:n=>f.page=n,onUpdatePageSize:n=>{f.pageSize=n,f.page=1}}),l=n=>({style:"cursor: pointer;"}),i=()=>x(),g=()=>{z.value.text="",x()},$=()=>m.value.create=!0,j=n=>m.value[n]=!1,A=n=>x(n);return se(p,n=>n&&$()),ie(()=>{R.value&&F.value&&x()}),W(()=>x()),(n,s)=>{const G=u("n-input"),C=u("n-data-table"),b=u("n-card"),M=u("n-modal");return L(),re("div",Ie,[d("div",Re,[d("h2",$e,v(o(t)("category")),1),d("div",Ne,[e(G,{value:z.value.text,"onUpdate:value":s[0]||(s[0]=_=>z.value.text=_),onInput:i,placeholder:o(t)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:a(()=>[e(o(E),null,{default:a(()=>[e(o(pe))]),_:1})]),_:1},8,["value","placeholder"]),e(o(O),{type:"warning",onClick:g},{icon:a(()=>[e(o(E),null,{default:a(()=>[e(o(he))]),_:1})]),default:a(()=>[I(" "+v(o(t)("update"))+" ",1),Ee]),_:1}),e(o(O),{type:"success",onClick:$},{icon:a(()=>[e(o(E),null,{default:a(()=>[e(o(ge))]),_:1})]),default:a(()=>[I(" "+v(o(t)("add"))+" ",1),Be]),_:1})])]),e(C,{"row-props":l,pagination:f,loading:U.value,columns:q.value,data:P.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e(M,{"transform-origin":"center",show:m.value.create,"onUpdate:show":s[3]||(s[3]=_=>m.value.create=_)},{default:a(()=>[e(b,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:a(()=>[e(J,{onClose:s[1]||(s[1]=_=>j("create")),onCreate:s[2]||(s[2]=_=>A("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e(M,{"transform-origin":"center",show:m.value.update,"onUpdate:show":s[6]||(s[6]=_=>m.value.update=_)},{default:a(()=>[e(b,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:a(()=>[e(J,{type:"update",id:m.value.update_id,onClose:s[4]||(s[4]=_=>j("update")),onUpdate:s[5]||(s[5]=_=>A("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Ae as default};
