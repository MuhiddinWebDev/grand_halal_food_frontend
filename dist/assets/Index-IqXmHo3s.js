import{u as Z,r as w,s as J,i as Y,j as c,o as M,m as q,l as t,k as e,a as u,t as v,n as o,G as R,p as Q,d as W,f as X,H as ee,g as te,h as ae,I as le,w as oe,C as ne,c as se,N as $,J as A,v as h,K as ie,L as re}from"./index-T3OpxodD.js";import{u as ce,S as ue}from"./index-kVvJLiRa.js";import{S as de,E as pe,A as me,P as _e,D as fe}from"./delete-4TfHpRPI.js";import{R as ge}from"./refresh-rsWKEIMH.js";import{c as E}from"./category.service-iRLEXOwY.js";import{u as O}from"./upload.service-Q1vQpSqD.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const ve={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-4 sm:space-y-0"},we={class:"text-xl font-semibold"},xe={class:"flex gap-2"},he=u("span",{class:"text-xs ml-1"},"Enter",-1),ye=u("span",{class:"text-xs ml-1"},"Esc",-1),be={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2"},ke={class:"md:col-span-2"},Ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},H={__name:"Form",props:{type:String,id:[String,Number]},emits:["create","update","close"],setup(T,{emit:r}){const{t:p}=Z(),f=T,I=r,B=w(null),C=w(!1),D=w(null),V=J("fileUrl"),i=w({title_uz:"",title_ru:"",title_ko:"",title_en:"",image:""}),y=a=>({required:!0,trigger:"blur",validator:(s,_)=>{if(!_)return new Error(p(a==="image"?"require_image":"require_name"))}}),K={title_uz:y("title_uz"),title_ko:y("title_ko"),title_ru:y("title_ru"),title_en:y("title_en"),image:y("image")};Y(async()=>{if(f.type==="update"&&f.id)try{const a=await E.getOne(f.id);i.value=a}catch(a){console.error("Ma'lumot yuklashda xatolik:",a)}setTimeout(()=>{var a;(a=D.value)==null||a.focus()},100)});const S=async()=>{var a;try{if(await((a=B.value)==null?void 0:a.validate()),C.value=!0,f.type==="create"){const s=await E.create(i.value);I("create",s)}else if(f.type==="update"){const s=await E.update(f.id,i.value);I("update",s)}}catch(s){console.warn("Form not valid or failed",s)}finally{C.value=!1}},U=()=>I("close"),d=async a=>{if(a)try{await O.delFile(a)}catch(s){console.warn("Faylni o‘chirishda xatolik:",s)}},x=async a=>{if(a.length>0){const s=new FormData;s.append("file",a[0].file);try{const _=await O.uploadFile(s);await d(i.value.image),i.value.image=_.file}catch(_){console.error("Yuklashda xatolik:",_)}}},G=()=>{d(i.value.image),i.value.image=""},g=a=>{a.code==="Enter"&&S()};return(a,s)=>{const _=c("n-icon"),N=c("n-button"),F=c("n-text"),P=c("n-p"),l=c("n-upload-dragger"),n=c("n-upload"),L=c("n-image"),z=c("n-input"),b=c("n-form-item"),j=c("n-spin"),m=c("n-form");return M(),q(m,{ref_key:"formRef",ref:B,model:i.value,rules:K},{default:t(()=>[e(j,{show:C.value},{default:t(()=>[u("div",ve,[u("p",we,v(o(p)("category"))+" "+v(f.type=="create"?o(p)("add").toLowerCase():o(p)("change").toLowerCase()),1),u("div",xe,[e(N,{onClick:S,type:"success",disabled:C.value,class:"min-w-[120px]"},{icon:t(()=>[e(_,null,{default:t(()=>[e(o(de))]),_:1})]),default:t(()=>[R(" "+v(o(p)("save"))+" ",1),he]),_:1},8,["disabled"]),e(N,{onClick:U,type:"warning",class:"min-w-[120px]"},{icon:t(()=>[e(_,null,{default:t(()=>[e(o(pe))]),_:1})]),default:t(()=>[R(" "+v(o(p)("exit"))+" ",1),ye]),_:1})])]),u("div",be,[u("div",ke,[e(n,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":x,onRemove:G},{default:t(()=>[e(l,{accept:"image/png, image/jpeg"},{default:t(()=>[e(F,{class:"text-base"},{default:t(()=>[R(v(a.$t("upload_image")),1)]),_:1}),e(P,{depth:"3",class:"mt-2"},{default:t(()=>[R(v(a.$t("drop_image")),1)]),_:1})]),_:1})]),_:1})]),u("div",null,[i.value.image?(M(),q(L,{key:0,src:o(V)+i.value.image,width:"120",height:"80",class:"rounded"},null,8,["src"])):Q("",!0)])]),u("div",Ce,[e(b,{label:o(p)("title")+" UZB",path:"title_uz"},{default:t(()=>[e(z,{ref_key:"inputInstRef",ref:D,onKeydown:g,value:i.value.title_uz,"onUpdate:value":s[0]||(s[0]=k=>i.value.title_uz=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:o(p)("title")+" KOR",path:"title_ko"},{default:t(()=>[e(z,{onKeydown:g,value:i.value.title_ko,"onUpdate:value":s[1]||(s[1]=k=>i.value.title_ko=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:o(p)("title")+" RUS",path:"title_ru"},{default:t(()=>[e(z,{onKeydown:g,value:i.value.title_ru,"onUpdate:value":s[2]||(s[2]=k=>i.value.title_ru=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),e(b,{label:o(p)("title")+" ENG",path:"title_en"},{default:t(()=>[e(z,{onKeydown:g,value:i.value.title_en,"onUpdate:value":s[3]||(s[3]=k=>i.value.title_en=k),"show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"])])]),_:1},8,["show"])]),_:1},8,["model"])}}},Se={class:"p-4 space-y-4"},Ue={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},ze={class:"text-xl font-bold"},Re={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Ie=u("span",{class:"ml-1 text-xs"},"Shift+R",-1),Ne=u("span",{class:"ml-1 text-xs"},"Insert",-1),je={__name:"Index",setup(T){const{t:r,locale:p}=Z(),{insert:f,shift:I,r:B}=ce(),C=W(),D=X(),V=ee(),i=te(),y=J("fileUrl"),K=w([]),S=w(!1);w(!1);const U=w({text:""}),d=w({create:!1,update:!1,update_id:null}),x=l=>{S.value=!0,E.all(U.value).then(n=>{K.value=n,S.value=!1,l&&(d.value[l]=!1)})},G=ae(()=>[{title:"№",key:"id",align:"center",width:50,render:(l,n)=>n+1},{title:r("title")+" UZB",key:"title",render(l){return h("div",{class:"flex items-center"},[l.image?h(ie,{src:y+l.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):h(re,{size:"small",style:{marginRight:"8px"}}),h("span",{class:"font-semibold"},l.title_uz)])}},{title:r("title")+" KOR",key:"title_ko"},{title:r("title")+" RUS",key:"title_ru"},{title:r("title")+" ENG",key:"title_en"},{title:r("action"),key:"action",align:"center",width:120,render(l){return[h(A,{size:"small",type:"success",onClick:n=>{d.value.update_id=l.id,d.value.update=!0},style:{marginRight:"8px"}},{icon:()=>h($,{component:_e,size:22})}),h(A,{size:"small",type:"warning",onClick:()=>{D.warning({title:r("warning"),content:r("delete_row"),positiveText:r("yes"),negativeText:r("no"),onPositiveClick:()=>{E.delete(l.id).then(()=>x()).catch(n=>{i.errorPage=n.data,C.push({name:"error page"})})},onNegativeClick:()=>V.success(r("cancel"))})}},{icon:()=>h($,{component:fe,size:22})})]}}]),g=le({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:l=>g.page=l,onUpdatePageSize:l=>{g.pageSize=l,g.page=1}}),a=l=>({style:"cursor: pointer;"}),s=()=>x(),_=()=>{U.value.text="",x()},N=()=>d.value.create=!0,F=l=>d.value[l]=!1,P=l=>x(l);return oe(f,l=>l&&N()),ne(()=>{I.value&&B.value&&x()}),Y(()=>x()),(l,n)=>{const L=c("n-input"),z=c("n-data-table"),b=c("n-card"),j=c("n-modal");return M(),se("div",Se,[u("div",Ue,[u("h2",ze,v(o(r)("category")),1),u("div",Re,[e(L,{value:U.value.text,"onUpdate:value":n[0]||(n[0]=m=>U.value.text=m),onInput:s,placeholder:o(r)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:t(()=>[e(o($),null,{default:t(()=>[e(o(ue))]),_:1})]),_:1},8,["value","placeholder"]),e(o(A),{type:"warning",onClick:_},{icon:t(()=>[e(o($),null,{default:t(()=>[e(o(ge))]),_:1})]),default:t(()=>[R(" "+v(o(r)("update"))+" ",1),Ie]),_:1}),e(o(A),{type:"success",onClick:N},{icon:t(()=>[e(o($),null,{default:t(()=>[e(o(me))]),_:1})]),default:t(()=>[R(" "+v(o(r)("add"))+" ",1),Ne]),_:1})])]),e(z,{"row-props":a,pagination:g,loading:S.value,columns:G.value,data:K.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)"},null,8,["pagination","loading","columns","data"]),e(j,{"transform-origin":"center",show:d.value.create,"onUpdate:show":n[3]||(n[3]=m=>d.value.create=m)},{default:t(()=>[e(b,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:t(()=>[e(H,{onClose:n[1]||(n[1]=m=>F("create")),onCreate:n[2]||(n[2]=m=>P("create")),type:"create"})]),_:1})]),_:1},8,["show"]),e(j,{"transform-origin":"center",show:d.value.update,"onUpdate:show":n[6]||(n[6]=m=>d.value.update=m)},{default:t(()=>[e(b,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:t(()=>[e(H,{type:"update",id:d.value.update_id,onClose:n[4]||(n[4]=m=>F("update")),onUpdate:n[5]||(n[5]=m=>P("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{je as default};
