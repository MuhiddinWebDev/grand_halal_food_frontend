import{d as J,r as w,J as Q,n as W,f as X,h as Y,l as u,c as Z,o as O,j as t,k as o,a as d,x as v,I as $,t as i,q as ae,s as le,e as ne,g as oe,m as g,K as se,L as re,M as ie,O as A,N,P as ue,w as de,D as ce,p as pe}from"./index-DWxUX1dU.js";import{u as me}from"./index-BuwZsw5p.js";import{A as fe}from"./add-XzjOS7Dh.js";import{R as ge}from"./refresh-C64adBlx.js";import{P as ve}from"./pen-Bx9jLVDb.js";import{S as _e}from"./search-B-6qYulp.js";import{D as we}from"./delete-BDP5JkF-.js";import{M as S}from"./users.service-DxTU8RZw.js";import{u as G}from"./upload.service-CFdtViKD.js";import{S as he,E as xe}from"./exit-yk3TINHu.js";import{u as ye}from"./NumberFormat-BDrUmd0_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"p-1"},ke={class:"space-y-6"},Ce={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},$e={class:"text-lg font-semibold"},Se={class:"flex flex-col sm:flex-row gap-2"},Ue={class:"space-y-4"},Ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"},H={__name:"Form",props:["type","id"],emits:["create","update","close"],setup(K,{emit:r}){const{locale:R,t:U}=J(),_=K,D=r,I=w(null),h=w(!1),B=Q(),F=W("fileUrl"),P=X(),s=w({phone:"998",image:"",fullname:"",status:!0,role:"Admin",password:"123456",lang:R}),M={phone:{required:!0,trigger:"blur",validator:(a,l)=>{if(l.length<12)return new Error(U("require_phone"))}},fullname:{required:!0,trigger:"blur",validator:(a,l)=>{if(!l)return new Error(U("require_fullname"))}},password:{required:!0,trigger:"blur",validator:(a,l)=>{if(l&&l.length<6)return new Error(U("require_password"))}}};Y(()=>{_.type==="update"&&S.getOne(_.id).then(a=>{s.value=a})});const x=async()=>{var a;try{await((a=I.value)==null?void 0:a.validate()),h.value=!0,(_.type==="create"?S.create(s.value):S.update(_.id,s.value)).then(f=>D(_.type,f)).catch(()=>h.value=!1)}catch{}},c=()=>D("close"),m=a=>a&&G.delFile(a),T=a=>{if(a.length>0){const l=new FormData;l.append("file",a[0].file),G.uploadFile(l).then(f=>{m(s.value.image),s.value.image=f.file})}},k=()=>{m(s.value.image),s.value.image=""},j=a=>{const l=!a||/^\d+$/.test(a);return l||B.warning("Iltimos raqam kiriting"),l},L=a=>a.key==="Enter"&&x();return(a,l)=>{const f=u("n-icon"),z=u("n-button"),q=u("n-text"),e=u("n-p"),n=u("n-upload-dragger"),E=u("n-upload"),V=u("n-image"),C=u("n-input"),y=u("n-form-item"),p=u("n-select"),ee=u("n-spin"),te=u("n-form");return O(),Z("div",be,[t(te,{ref_key:"formRef",ref:I,model:s.value,rules:M},{default:o(()=>[t(ee,{show:h.value},{default:o(()=>[d("div",ke,[d("div",Ce,[d("p",$e,v(a.$t("admin_one"))+" "+v(_.type==="create"?a.$t("add").toLowerCase():a.$t("change").toLowerCase()),1),d("div",Se,[t(z,{onClick:x,type:"success",disabled:h.value,class:"min-w-[120px]"},{icon:o(()=>[t(f,null,{default:o(()=>[t(i(he))]),_:1})]),default:o(()=>[$(" "+v(a.$t("save"))+" ",1),l[4]||(l[4]=d("span",{class:"ml-1 text-xs"},"Enter",-1))]),_:1,__:[4]},8,["disabled"]),t(z,{onClick:c,type:"warning",class:"min-w-[120px]"},{icon:o(()=>[t(f,null,{default:o(()=>[t(i(xe))]),_:1})]),default:o(()=>[$(" "+v(a.$t("exit"))+" ",1),l[5]||(l[5]=d("span",{class:"ml-1 text-xs"},"Esc",-1))]),_:1,__:[5]})])]),d("div",Ue,[t(E,{max:1,accept:"image/png, image/jpeg","list-type":"image","directory-dnd":"","onUpdate:fileList":T,onRemove:k},{default:o(()=>[t(n,null,{default:o(()=>[t(q,{class:"text-base"},{default:o(()=>[$(v(a.$t("upload_image")),1)]),_:1}),t(e,{class:"text-sm mt-2"},{default:o(()=>[$(v(a.$t("drop_image")),1)]),_:1})]),_:1})]),_:1}),s.value.image?(O(),ae(V,{key:0,src:i(F)+s.value.image,width:"120",height:"120",class:"rounded"},null,8,["src"])):le("",!0)]),d("div",Ie,[t(y,{label:a.$t("fullname"),path:"fullname"},{default:o(()=>[t(C,{value:s.value.fullname,"onUpdate:value":l[0]||(l[0]=b=>s.value.fullname=b),maxlength:"50","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(y,{label:a.$t("phone"),path:"phone"},{default:o(()=>[t(C,{onKeydown:L,"allow-input":j,value:s.value.phone,"onUpdate:value":l[1]||(l[1]=b=>s.value.phone=b),maxlength:"12",minlength:"12","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(y,{label:a.$t("password"),path:"password"},{default:o(()=>[t(C,{type:"password","show-password-on":"mousedown",value:s.value.password,"onUpdate:value":l[2]||(l[2]=b=>s.value.password=b),minlength:"3","show-count":"",clearable:""},null,8,["value"])]),_:1},8,["label"]),t(y,{label:a.$t("role"),path:"role"},{default:o(()=>[t(p,{options:i(P).roleOption,"value-field":"key","label-field":"name_"+i(R),value:s.value.role,"onUpdate:value":l[3]||(l[3]=b=>s.value.role=b),filterable:""},null,8,["options","label-field","value"])]),_:1},8,["label"])])])]),_:1},8,["show"])]),_:1},8,["model"])])}}},ze={class:"p-2 space-y-2 bg-white rounded-xl shadow-md overflow-x-auto"},Ee={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ne={class:"text-xl font-bold"},Re={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Ke={__name:"Index",setup(K){const{t:r,locale:R}=J(),{insert:U,shift:_,r:D}=me();pe();const I=ne(),h=Q(),B=X(),F=W("fileUrl"),P=w([]),s=w(!1),M=w(!1),x=w({text:""}),c=w({create:!1,update:!1,update_id:null}),m=e=>{s.value=!0,S.all(x.value).then(n=>{P.value=n,s.value=!1,e&&(c.value[e]=!1)})},T=oe(()=>[{title:"â„–",key:"id",align:"center",width:50,render:(e,n)=>n+1},{title:r("fullname"),key:"fullname",render(e){return g("div",{class:"flex items-center"},[e.image?g(se,{src:F+e.image,height:35,width:50,style:{borderRadius:"35px",marginRight:"8px"},lazy:!0,previewDisabled:!0}):g(re,{size:"small",style:{marginRight:"8px"}}),g("span",{class:"font-semibold"},e.fullname)])}},{title:r("phone"),key:"phone",render:e=>ye(e.phone)},{title:r("role"),key:"role",render:e=>{var n;return(n=B.roleOption.find(E=>E.key===e.role))==null?void 0:n[`name_${R.value}`]}},{title:r("active"),key:"status",align:"center",fixed:"right",width:100,render(e){return g(ie,{value:e.status,loading:M.value,round:!0,onUpdateValue:()=>{I.warning({title:r("warning"),content:r("change_active"),positiveText:r("yes"),negativeText:r("no"),onPositiveClick:()=>{e.status=!e.status,S.updateStatus(e.id,e).then(()=>m())},onNegativeClick:()=>h.success(r("cancel"))})}})}},{title:r("action"),key:"action",align:"center",width:120,render(e){return[g(A,{size:"small",type:"success",onClick:n=>{c.value.update_id=e.id,c.value.update=!0},style:{marginRight:"8px"}},{icon:()=>g(N,{component:ve,size:22})}),g(A,{size:"small",type:"warning",onClick:()=>{I.warning({title:r("warning"),content:r("delete_row"),positiveText:r("yes"),negativeText:r("no"),onPositiveClick:()=>{S.delete(e.id).then(()=>m())},onNegativeClick:()=>h.success(r("cancel"))})}},{icon:()=>g(N,{component:we,size:22})})]}}]),k=ue({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20],onChange:e=>k.page=e,onUpdatePageSize:e=>{k.pageSize=e,k.page=1}}),j=e=>({style:"cursor: pointer;"}),L=e=>e.status?"":"bg-red-50",a=()=>m(),l=()=>{x.value.text="",m()},f=()=>c.value.create=!0,z=e=>c.value[e]=!1,q=e=>m(e);return de(U,e=>e&&f()),ce(()=>{_.value&&D.value&&m()}),Y(()=>m()),(e,n)=>{const E=u("n-input"),V=u("n-data-table"),C=u("n-card"),y=u("n-modal");return O(),Z("div",ze,[d("div",Ee,[d("h2",Ne,v(i(r)("admin")),1),d("div",Re,[t(E,{value:x.value.text,"onUpdate:value":n[0]||(n[0]=p=>x.value.text=p),onInput:a,placeholder:i(r)("search"),clearable:"",class:"w-full sm:w-80"},{prefix:o(()=>[t(i(N),null,{default:o(()=>[t(i(_e))]),_:1})]),_:1},8,["value","placeholder"]),t(i(A),{type:"warning",onClick:l},{icon:o(()=>[t(i(N),null,{default:o(()=>[t(i(ge))]),_:1})]),default:o(()=>[$(" "+v(i(r)("update"))+" ",1),n[7]||(n[7]=d("span",{class:"ml-1 text-xs"},"Shift+R",-1))]),_:1,__:[7]}),t(i(A),{type:"success",onClick:f},{icon:o(()=>[t(i(N),null,{default:o(()=>[t(i(fe))]),_:1})]),default:o(()=>[$(" "+v(i(r)("add"))+" ",1),n[8]||(n[8]=d("span",{class:"ml-1 text-xs"},"Insert",-1))]),_:1,__:[8]})])]),t(V,{"row-props":j,pagination:k,loading:s.value,columns:T.value,data:P.value,bordered:!0,"single-line":!1,size:"small","scroll-x":1300,"max-height":"calc(100vh - 315px)","row-class-name":L},null,8,["pagination","loading","columns","data"]),t(y,{"transform-origin":"center",show:c.value.create,"onUpdate:show":n[3]||(n[3]=p=>c.value.create=p)},{default:o(()=>[t(C,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:o(()=>[t(H,{onClose:n[1]||(n[1]=p=>z("create")),onCreate:n[2]||(n[2]=p=>q("create")),type:"create"})]),_:1})]),_:1},8,["show"]),t(y,{"transform-origin":"center",show:c.value.update,"onUpdate:show":n[6]||(n[6]=p=>c.value.update=p)},{default:o(()=>[t(C,{class:"w-full max-w-3xl",bordered:!1,role:"dialog","aria-modal":"true"},{default:o(()=>[t(H,{type:"update",id:c.value.update_id,onClose:n[4]||(n[4]=p=>z("update")),onUpdate:n[5]||(n[5]=p=>q("update"))},null,8,["id"])]),_:1})]),_:1},8,["show"])])}}};export{Ke as default};
